import{r as m}from"./validators-be8c4c00.js";import{r as f,ah as S,a1 as F,c as B,b as e,e as t,a2 as M,E as G,n as J,o as L,a3 as b,M as V,s as r,d as c,Z as T,x as O,C as P,D as Z,ai as z}from"./main-e84ce0a6.js";import{_ as H}from"./AppTextarea-3559f584.js";import{_ as K}from"./AppSelect-bd457cdc.js";import{_ as Q}from"./AppDateTimePicker-b73077cf.js";import{_ as W}from"./AppTextField-cfb27a57.js";import{_ as X}from"./AppAutocomplete-02a87663.js";import{u as U}from"./useApi-7dd63682.js";import{c as C}from"./createUrl-f896560b.js";import{$ as Y}from"./api-6638b469.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import{V as re}from"./VForm-b81ac70c.js";import{V as ae}from"./VSnackbar-d8c396a7.js";import{V as w}from"./VRow-d22e34f5.js";import{V as i}from"./VCol-a817eccc.js";import{V as te}from"./VCard-fe1def77.js";import{V as le}from"./VCardText-c43c5a35.js";import"./VTextField-bed2e038.js";import"./VImg-291e1ee2.js";import"./forwardRefs-6ea3df5c.js";import"./VSelect-0f27dc1c.js";import"./VList-31615f1a.js";import"./VAvatar-b9338bff.js";import"./VDivider-a6507b5e.js";import"./VOverlay-3c60a455.js";import"./VMenu-4db2c15b.js";import"./filter-7bde97a1.js";import"./index-9c720871.js";import"./useAbility-d056d777.js";const $=v=>(P("data-v-a022234c"),v=v(),Z(),v),oe=$(()=>c("div",{class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},[c("div",{class:"d-flex flex-column justify-center"},[c("h4",{class:"text-h4 font-weight-medium"}," Mettre à jour un CAT ")])],-1)),se={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},ie=$(()=>c("div",{class:"d-flex flex-column justify-center"},null,-1)),de={class:"d-flex gap-4 align-center flex-wrap"},ne={__name:"[id]",async setup(v){let _,g;const N=G(),y=J(),h=f(!1),q=f(""),x=f(),A=()=>({notification_id:"",credit_number:"",sector:"",first_deadline:"",last_deadline:"",source_of_reimbursement:"",instructions_from_the_risk_and_credit_department:"",outstanding_number_ready_to_settle:"",other_expenses:"",teg:""}),{data:E}=([_,g]=S(()=>U(C("/notification",{query:{paginate:0,with_verbal_trial:1,has_upload_completed:1,has_cat:0}}))),_=await _,g(),_),{data:R}=([_,g]=S(()=>U(C(`/cat/${y.params.id}`,{query:{with_verbal_trial:1}}))),_=await _,g(),_),j=()=>{var o;(o=x.value)==null||o.validate().then(async({valid:l})=>{if(l){const k={notification_id:a.value.notification_id,credit_number:a.value.credit_number,sector:a.value.sector,first_deadline:a.value.first_deadline,last_deadline:a.value.last_deadline,source_of_reimbursement:a.value.source_of_reimbursement,instructions_from_the_risk_and_credit_department:a.value.instructions_from_the_risk_and_credit_department,outstanding_number_ready_to_settle:a.value.outstanding_number_ready_to_settle,other_expenses:a.value.other_expenses,teg:a.value.teg},n=await Y(`cat/${y.params.id}`,{method:"PUT",body:k});if(d.value=A(),n.status==200)N.push({name:"cat-notification"});else if(n.status==403){h.value=!0,q.value="";for(const u in n.errors)n.errors[u].forEach(p=>{q.value+=p+`
`})}else for(const u in n.errors)n.errors[u].forEach(p=>{d.value[u]+=p+`
`});z(()=>{var u;(u=x.value)==null||u.resetValidation()})}})},d=f(A()),D=F(()=>E.value.data);console.log(E.value);var a=f(R.value.data.c_a_t);return E.value.data.push(JSON.parse(JSON.stringify(a.value.notification))),(o,l)=>{const k=X,n=W,u=Q,p=K,I=H;return L(),B("div",null,[oe,e(re,{ref_key:"refForm",ref:x,onSubmit:M(j,["prevent"])},{default:t(()=>[e(w,null,{default:t(()=>[e(i,{cols:"11"},{default:t(()=>[e(b,{"prepend-icon":"tabler-arrow-left",to:{name:"cat-notification"}},{default:t(()=>[V(" CATs ")]),_:1})]),_:1}),e(i,{cols:"1"},{default:t(()=>[e(b,{"prepend-icon":"tabler-eye",to:{name:"cat-notification-id",params:{id:r(y).params.id}}},{default:t(()=>[V(" Voir ")]),_:1},8,["to"])]),_:1})]),_:1}),e(w,null,{default:t(()=>[e(i,{md:"12"},{default:t(()=>[e(te,{class:"mb-6",title:"Information sur CAT"},{default:t(()=>[e(le,null,{default:t(()=>[e(w,null,{default:t(()=>[e(i,{cols:"12",md:"12",lg:"12"},{default:t(()=>[e(k,{modelValue:r(a).notification_id,"onUpdate:modelValue":l[0]||(l[0]=s=>r(a).notification_id=s),items:r(D),"error-messages":d.value.notification_id,label:"Notification",placeholder:"Ex: CFNTG-044-13-12-23-01212",rules:["requiredValidator"in o?o.requiredValidator:r(m)],"item-title":"verbal_trial.label","item-value":"id"},null,8,["modelValue","items","error-messages","rules"])]),_:1}),e(i,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(n,{modelValue:r(a).credit_number,"onUpdate:modelValue":l[1]||(l[1]=s=>r(a).credit_number=s),"error-messages":d.value.credit_number,label:"Numéro du crédit",placeholder:"Ex: 485632",rules:["requiredValidator"in o?o.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(i,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(n,{modelValue:r(a).sector,"onUpdate:modelValue":l[2]||(l[2]=s=>r(a).sector=s),"error-messages":d.value.sector,label:"Secteur",placeholder:"Ex: Agriculture",rules:["requiredValidator"in o?o.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(i,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(u,{modelValue:r(a).first_deadline,"onUpdate:modelValue":l[3]||(l[3]=s=>r(a).first_deadline=s),"error-messages":d.value.first_deadline,label:"Date de première échéance",placeholder:"Ex: 2024-02-02",rules:["requiredValidator"in o?o.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(i,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(u,{modelValue:r(a).last_deadline,"onUpdate:modelValue":l[4]||(l[4]=s=>r(a).last_deadline=s),"error-messages":d.value.last_deadline,label:"Date de dernière échéance",placeholder:"Ex: 2024-02-02",rules:["requiredValidator"in o?o.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(i,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(p,{modelValue:r(a).source_of_reimbursement,"onUpdate:modelValue":l[5]||(l[5]=s=>r(a).source_of_reimbursement=s),items:[{value:"revenue_from_the_activity",title:"Recettes de l’activité"},{value:"final_payer_settlement",title:"Règlement du payeur final"},{value:"resale_of_goods",title:"Reventes des marchandises"}],"error-messages":d.value.source_of_reimbursement,label:"Source du remboursement",placeholder:"Ex: Recettes de l’activité",rules:["requiredValidator"in o?o.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(i,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(n,{modelValue:r(a).outstanding_number_ready_to_settle,"onUpdate:modelValue":l[6]||(l[6]=s=>r(a).outstanding_number_ready_to_settle=s),"error-messages":d.value.outstanding_number_ready_to_settle,label:"Numéro encours prêt à solder",placeholder:"Ex: ",rules:["requiredValidator"in o?o.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(i,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(n,{modelValue:r(a).other_expenses,"onUpdate:modelValue":l[7]||(l[7]=s=>r(a).other_expenses=s),"error-messages":d.value.other_expenses,label:"Autres frais",placeholder:"Ex: ",rules:["requiredValidator"in o?o.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(i,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(n,{modelValue:r(a).teg,"onUpdate:modelValue":l[8]||(l[8]=s=>r(a).teg=s),"error-messages":d.value.teg,label:"TEG",placeholder:"Ex: 15000600",rules:["requiredValidator"in o?o.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(i,{cols:"12",md:"12",lg:"12"},{default:t(()=>[e(I,{modelValue:r(a).instructions_from_the_risk_and_credit_department,"onUpdate:modelValue":l[9]||(l[9]=s=>r(a).instructions_from_the_risk_and_credit_department=s),"error-messages":d.value.instructions_from_the_risk_and_credit_department,label:"Instructions du département risque et crédit",placeholder:"Ex: ",rules:["requiredValidator"in o?o.requiredValidator:r(m)],clearable:"",counter:""},null,8,["modelValue","error-messages","rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(i,{cols:"12"},{default:t(()=>[c("div",se,[ie,c("div",de,[e(b,{type:"reset",variant:"tonal",color:"primary"},{default:t(()=>[e(T,{start:"",icon:"tabler-circle-minus"}),V(" Effacer ")]),_:1}),e(b,{type:"submit",class:"me-3"},{default:t(()=>[V(" Enregistrer "),e(T,{end:"",icon:"tabler-checkbox"})]),_:1})])])]),_:1})]),_:1})]),_:1},512),e(ae,{modelValue:h.value,"onUpdate:modelValue":l[10]||(l[10]=s=>h.value=s),transition:"scroll-y-reverse-transition",location:"bottom end",color:"error"},{default:t(()=>[V(O(q.value),1)]),_:1},8,["modelValue"])])}}},Be=ee(ne,[["__scopeId","data-v-a022234c"]]);export{Be as default};
