import{_ as W}from"./DialogCloseBtn-675f2a41.js";import{_ as X}from"./AppTextField-a55c9046.js";import{_ as Y}from"./AppSelect-b4aecc07.js";import{V as ee,p as te,a as ae}from"./paginationMeta-07ed5d9a.js";import{J as oe}from"./js-file-downloader-a589705c.js";import{$ as le}from"./api-250e6840.js";import{u as ne}from"./useApi-c189fb4c.js";import{c as re}from"./createUrl-6209637a.js";import{r as m,ah as ie,a1 as I,o as d,c as M,b as e,e as t,s as l,$ as v,a as se,d as f,a3 as p,M as r,f as _,N as u,Z as i,x as E,z as j,aa as de,C as ce,D as pe}from"./main-46a0c5a9.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";import{V as N}from"./VCard-8818643c.js";import{V as me}from"./VDialog-921babe5.js";import{V as b}from"./VCardText-f76baed7.js";import{V as R}from"./VRow-488997f5.js";import{V as _e}from"./VCol-da704454.js";import{V as P}from"./VDivider-ea070f60.js";import{V as fe}from"./VSpacer-ebbfe3e6.js";import{V as ve}from"./VMenu-6d187744.js";import{V as ge,a as g,b as y}from"./VList-139817d9.js";import{V as ye}from"./VBadge-b15c8320.js";import"./VTextField-1e15a30a.js";import"./VImg-1082f317.js";import"./forwardRefs-6ea3df5c.js";import"./VSelect-f97bd02e.js";import"./VOverlay-0594322e.js";import"./VAvatar-de3ccc2c.js";import"./VTable-36ef90f3.js";import"./filter-bf73ada6.js";import"./index-9c720871.js";import"./useAbility-241c7a17.js";const be=V=>(ce("data-v-f0bb6041"),V=V(),pe(),V),Ve=be(()=>f("h2",null," Liste des notifications en attente de CAT ",-1)),he={class:"d-flex flex-wrap gap-4 mx-5"},ke={class:"d-flex align-center"},Ce={class:"d-flex gap-4 flex-wrap align-center"},$e={class:"custom-loader"},we={key:2},xe={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Te={class:"text-sm text-medium-emphasis mb-0"},Be={__name:"historical",async setup(V){let h,U;const c=m(!1),L=m(0),k=m(),C=m(""),$=m([]),w=m(8),s=m(1),J=[{title:"Numéro comitée",key:"verbal_trial.committee_id"},{title:"Admin Crédit",key:"creator.full_name"},{title:"Nom client",key:"verbal_trial.applicant_full_name"},{title:"Type de contrat",key:"type"},{title:"Montant",key:"verbal_trial.amount"},{title:"Actions",key:"actions",sortable:!1}],q={company:"Société",individual_business:"Entreprise Individuel",particular:"Particulier"},{data:S,execute:A}=([h,U]=ie(()=>ne(re("/notification",{query:{search:C,type:k,page:s,with_type_of_credit:1,with_company:1,has_notification:1,has_contract:0,with_individual_business:1,with_creator:1,has_upload_completed:1,has_cat:1,is_simple:1,status:"v"}}))),h=await h,U(),h),O=n=>{$.value[n]=!0,setTimeout(()=>{$.value[n]=!1},1e3)},Q=n=>{s.value=n.page},x=async(n,o)=>{try{new oe({url:n,headers:[{name:"Authorization",value:`Bearer ${de("userToken").value}`},{name:"Accept",value:"application/json"}],nameCallback:function(T){return o}}),A()}catch(T){console.error("Erreur lors du téléchargement:",T)}},Z=async n=>{await le(`contract/${n}`,{method:"DELETE"}),A()},G=I(()=>S.value.data),F=I(()=>S.value.total),z=I(()=>S.value.last_page);return(n,o)=>{const T=Y,H=X,D=se("IconBtn"),K=W;return d(),M("div",null,[e(N,{class:"mb-6"},{default:t(()=>[e(b,null,{default:t(()=>[e(R,null,{default:t(()=>[e(b,null,{default:t(()=>[Ve]),_:1})]),_:1})]),_:1})]),_:1}),e(N,{title:"Filtres",class:"mb-6"},{default:t(()=>[e(b,null,{default:t(()=>[e(R,null,{default:t(()=>[e(_e,{cols:"12",sm:"4"},{default:t(()=>[e(T,{modelValue:l(k),"onUpdate:modelValue":o[0]||(o[0]=a=>v(k)?k.value=a:null),placeholder:"Type de contrat",items:[{value:"company",title:"Société"},{value:"particular",title:"Particulier"},{value:"individual_business",title:"Entreprise Individuel"}],clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(P,{class:"my-4"}),f("div",he,[f("div",ke,[e(H,{modelValue:l(C),"onUpdate:modelValue":o[1]||(o[1]=a=>v(C)?C.value=a:null),placeholder:"Rechercher un contrat",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(fe),f("div",Ce,[e(p,{variant:"tonal",color:"secondary","prepend-icon":"tabler-download"},{default:t(()=>[r(" Export ")]),_:1}),n.$can("create","simple-notification")?(d(),_(p,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"simple-notification-add"}},{default:t(()=>[r(" Ajouter ")]),_:1})):u("",!0),e(p,{loading:l($)[3],disabled:l($)[3],"prepend-icon":"tabler-refresh",onClick:o[2]||(o[2]=a=>{l(A)(),O(3)})},{loader:t(()=>[f("span",$e,[e(i,{icon:"tabler-refresh"})])]),default:t(()=>[r(" Recharger ")]),_:1},8,["loading","disabled"])])]),e(P,{class:"mt-4"}),e(l(ee),{"items-per-page":l(w),"onUpdate:itemsPerPage":o[4]||(o[4]=a=>v(w)?w.value=a:null),page:l(s),"onUpdate:page":o[5]||(o[5]=a=>v(s)?s.value=a:null),headers:J,items:l(G),"items-length":l(F),class:"text-no-wrap","onUpdate:options":Q},{"item.type":t(({item:a})=>[r(E(q[a.type]),1)]),"item.verbal_trial.amount":t(({item:a})=>[r(E(String(a.verbal_trial.amount).replace(/\B(?=(\d{3})+(?!\d))/g," "))+" F CFA ",1)]),"item.actions":t(({item:a})=>[e(D,{to:{name:"contract-id",params:{id:a.id}}},{default:t(()=>[e(i,{icon:"tabler-eye"})]),_:2},1032,["to"]),n.$can("update","contract")?(d(),_(D,{key:0,to:{name:"contract-edit-id",params:{id:a.id}}},{default:t(()=>[e(i,{icon:"tabler-edit"})]),_:2},1032,["to"])):u("",!0),n.$can("delete","contract")?(d(),_(D,{key:1,onClick:B=>{L.value=a.id,c.value=!0}},{default:t(()=>[e(i,{icon:"tabler-trash",color:"error"})]),_:2},1032,["onClick"])):u("",!0),e(p,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:t(()=>[e(i,{size:"24",icon:"tabler-dots-vertical"}),e(ve,{activator:"parent"},{default:t(()=>[e(ge,null,{default:t(()=>[n.$can("read","guarantor")?(d(),_(ye,{key:0,inline:"",content:a.guarantors_count},{default:t(()=>[e(g,{to:{name:"contract-contract_id-guarantor",params:{contract_id:a.id}}},{prepend:t(()=>[e(i,{icon:"tabler-users"})]),default:t(()=>[e(y,null,{default:t(()=>[r(" Voir les Cautions ")]),_:1})]),_:2},1032,["to"])]),_:2},1032,["content"])):u("",!0),n.$can("read","pv")?(d(),_(g,{key:1,to:{name:"pv-id",params:{id:a.verbal_trial.id}}},{prepend:t(()=>[e(i,{icon:"tabler-eye"})]),default:t(()=>[e(y,null,{default:t(()=>[r("Voir le Pv")]),_:1})]),_:2},1032,["to"])):u("",!0),n.$can("download","contract")?(d(),M("div",we,[e(P),e(g,{onClick:B=>x(`/api/contract/download/${a.id}`,`Contrat-${a.verbal_trial.committee_id}.docx`)},{prepend:t(()=>[e(i,{icon:"tabler-download"})]),default:t(()=>[e(y,null,{default:t(()=>[r("Télécharger Contrat non-signé")]),_:1})]),_:2},1032,["onClick"]),a.signed_contract_path?(d(),_(g,{key:0,onClick:B=>x(a.signed_contract_path,`Contrat-${a.signed_contract_path.split("/").slice(-1)[0]}`)},{prepend:t(()=>[e(i,{icon:"tabler-download"})]),default:t(()=>[e(y,null,{default:t(()=>[r("Télécharger Contrat signé")]),_:1})]),_:2},1032,["onClick"])):u("",!0),e(g,{onClick:B=>{x(`/api/contract/promissory-note/download/${a.id}`,`Billet-à-ordre-${a.verbal_trial.committee_id}.docx`)}},{prepend:t(()=>[e(i,{icon:"tabler-download"})]),default:t(()=>[e(y,null,{default:t(()=>[r("Télécharger Billet à ordre non signé")]),_:1})]),_:2},1032,["onClick"]),a.signed_promissory_note_path?(d(),_(g,{key:1,onClick:B=>x(a.signed_promissory_note_path,`Billet-à-ordre-${a.signed_promissory_note_path.split("/").slice(-1)[0]}`)},{prepend:t(()=>[e(i,{icon:"tabler-download"})]),default:t(()=>[e(y,null,{default:t(()=>[r("Télécharger Billet à ordre signé")]),_:1})]),_:2},1032,["onClick"])):u("",!0)])):u("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:t(()=>[e(P),f("div",xe,[f("p",Te,E(l(te)({page:l(s),itemsPerPage:l(w)},l(F))),1),e(ae,{modelValue:l(s),"onUpdate:modelValue":o[3]||(o[3]=a=>v(s)?s.value=a:null),length:l(z),"total-visible":n.$vuetify.display.xs?1:Math.min(l(z),5)},{prev:t(a=>[e(p,j({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[e(i,{start:"",icon:"tabler-arrow-left"}),r(" Précedent ")]),_:2},1040)]),next:t(a=>[e(p,j({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[r(" Suivant "),e(i,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(me,{modelValue:l(c),"onUpdate:modelValue":o[9]||(o[9]=a=>v(c)?c.value=a:null),class:"v-dialog-sm"},{default:t(()=>[e(K,{onClick:o[6]||(o[6]=a=>c.value=!l(c))}),e(N,{title:"Suppression"},{default:t(()=>[e(b,null,{default:t(()=>[r(" Etes vous sûr de vouloir supprimer ce contrat? ")]),_:1}),e(b,{class:"d-flex justify-end gap-3 flex-wrap"},{default:t(()=>[e(p,{color:"secondary",variant:"tonal",onClick:o[7]||(o[7]=a=>c.value=!1)},{default:t(()=>[r(" Annuler ")]),_:1}),e(p,{onClick:o[8]||(o[8]=a=>{Z(l(L)),c.value=!1})},{default:t(()=>[r(" Supprimer ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},nt=ue(Be,[["__scopeId","data-v-f0bb6041"]]);export{nt as default};
