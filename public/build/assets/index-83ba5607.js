import{r,ah as G,a1 as R,c as h,b as e,e as t,s as l,$ as V,E as ce,a as pe,aU as me,o as s,d as m,a3 as y,M as i,f,N as d,Z as p,x as E,v as ve,aa as H,B as fe,z as K,C as _e,D as Ve}from"./main-a1bb8d1c.js";import{_ as ye}from"./AppTextarea-6d6d429f.js";import{_ as ge}from"./DialogCloseBtn-469f552f.js";import{_ as be}from"./AppTextField-6136aa1e.js";import{V as ke,p as he,a as $e}from"./VPagination-c405f961.js";import{_ as Ce}from"./AppAutocomplete-5e56137d.js";import{J as we}from"./js-file-downloader-6f69effd.js";import{$ as W}from"./api-0fd30a7b.js";import{u as X}from"./useApi-ee532938.js";import{c as Y}from"./createUrl-82711664.js";import{_ as xe}from"./_plugin-vue_export-helper-c27b6911.js";import{V as L}from"./VCard-0a0db0fa.js";import{V as Pe}from"./VDialog-206f78ae.js";import{V as $}from"./VCardText-ec067fb4.js";import{V as ee}from"./VRow-4fd62cc5.js";import{V as Te}from"./VCol-c9fbba03.js";import{V as k}from"./VDivider-bdae5753.js";import{V as De}from"./VSpacer-75169579.js";import{V as g}from"./VTooltip-2ee1d7e2.js";import"./VTextField-251e47e8.js";import"./VImg-c3c51305.js";import"./forwardRefs-6ea3df5c.js";import"./VSelect-00885f47.js";import"./VList-63aa9283.js";import"./VAvatar-28a02eb0.js";import"./VOverlay-5a96f554.js";import"./VMenu-e4df9f05.js";import"./VTable-b1027623.js";import"./filter-22cdad36.js";import"./index-9c720871.js";import"./useAbility-c9217b08.js";const Se=C=>(_e("data-v-d6065318"),C=C(),Ve(),C),je=Se(()=>m("h2",null,"Liste des Procès verbaux sans contrat",-1)),Ae={class:"d-flex flex-wrap gap-4 mx-5"},Be={class:"d-flex align-center"},Ue={class:"d-flex gap-4 flex-wrap align-center"},Ie={class:"custom-loader"},Re={key:0},Ee={key:1},ze={key:0},Ne={key:2},Fe={class:"full-width-icon"},Me={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},qe={class:"text-sm text-medium-emphasis mb-0"},Le={__name:"index",async setup(C){let _,w;ce();const x=r();r();const P=r(""),T=r([]),D=r(8),v=r(1),S=r(0),u=r(!1),j=r(""),A=r(""),B=r(""),U=r(),b=r(""),I=r(!1),z=r("waiting"),te=[{title:"Numéro comitée",key:"committee_id"},{title:"client",key:"applicant_full_name"},{title:"Type Credit",key:"type_of_credit.full_name"},{title:"Montant",key:"amount_fr"},{title:"Actions",key:"actions",sortable:!1}],{data:N,execute:F}=([_,w]=G(()=>X(Y("/verbal-trial",{query:{search:P,type_of_credit_id:x,page:v,has_contract:0,has_mortgage:0,with_caf:1,with_type_of_credit:1}}))),_=await _,w(),_),{data:ae}=([_,w]=G(()=>X(Y("/type-of-credit",{query:{paginate:0}}))),_=await _,w(),_),oe=o=>{T.value[o]=!0,setTimeout(()=>{T.value[o]=!1},1e3)},le=o=>{v.value=o.page},ne=async(o,n)=>{const M=H("userToken").value;try{new we({url:o,headers:[{name:"Authorization",value:`Bearer ${M}`},{name:"Accept",value:"application/json"}],nameCallback:function(c){return n}})}catch(c){console.error("Erreur lors du téléchargement:",c)}},ie=async o=>{await W(`verbal-trial/${o}`,{method:"DELETE"}),b.value="",F()},J=async o=>{await W(`verbal-trial/change-status/${o}`,{method:"PUT",body:{status:z.value,comment:b.value}}),b.value="",F()},O=R(()=>N.value.data);console.log(O);const Q=R(()=>N.value.total),Z=R(()=>N.value.last_page),re=R(()=>ae.value.data);return(o,n)=>{const M=be,c=pe("IconBtn"),se=ge,de=ye,ue=me("tooltip");return s(),h("div",null,[e(L,{class:"mb-6"},{default:t(()=>[e($,null,{default:t(()=>[e(ee,null,{default:t(()=>[e($,null,{default:t(()=>[je]),_:1})]),_:1})]),_:1})]),_:1}),e(L,{title:"Filtres",class:"mb-6"},{default:t(()=>[e($,null,{default:t(()=>[e(ee,null,{default:t(()=>[e(Te,{cols:"12",sm:"4"},{default:t(()=>[e(Ce,{modelValue:l(x),"onUpdate:modelValue":n[0]||(n[0]=a=>V(x)?x.value=a:null),placeholder:"Type de crédit","item-title":"full_name","item-value":"id",items:l(re),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),e(k,{class:"my-4"}),m("div",Ae,[m("div",Be,[e(M,{modelValue:l(P),"onUpdate:modelValue":n[1]||(n[1]=a=>V(P)?P.value=a:null),placeholder:"Rechercher un pv",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(De),m("div",Ue,[e(y,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:t(()=>[i(" Export ")]),_:1}),o.$can("create","pv")?(s(),f(y,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"pv-add"}},{default:t(()=>[i(" Ajouter ")]),_:1})):d("",!0),e(y,{loading:l(T)[3],disabled:l(T)[3],"prepend-icon":"tabler-refresh",onClick:n[2]||(n[2]=a=>{l(F)(),oe(3)})},{loader:t(()=>[m("span",Ie,[e(p,{icon:"tabler-refresh"})])]),default:t(()=>[i(" Recharger ")]),_:1},8,["loading","disabled"])])]),e(k,{class:"mt-4"}),e(l(ke),{"items-per-page":l(D),"onUpdate:itemsPerPage":n[4]||(n[4]=a=>V(D)?D.value=a:null),page:l(v),"onUpdate:page":n[5]||(n[5]=a=>V(v)?v.value=a:null),headers:te,items:l(O),"items-length":l(Q),class:"text-no-wrap","onUpdate:options":le},{"item.duration":t(({item:a})=>[i(E(a.duration)+" mois ",1)]),"item.actions":t(({item:a})=>[m("div",null,[o.$can("read","pv")||o.$can("historical","pv")?(s(),f(c,{key:0,to:{name:"pv-id",params:{id:a.id}}},{default:t(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[i("Details")]),_:1}),e(p,{icon:" tabler-eye"})]),_:2},1032,["to"])):d("",!0),o.$can("download","pv")?(s(),f(c,{key:1,onClick:q=>ne(`/api/verbal-trial/download/${a.id}`,`PV-${a.committee_id}.docx`)},{default:t(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:t(()=>[i("Télécharger")]),_:1}),ve(e(p,{icon:"tabler-download"},null,512),[[ue,"Ceci est une icône"]])]),_:2},1032,["onClick"])):d("",!0)]),o.$can("update","pv")||o.$can("delete","pv")?(s(),h("div",Re,[e(k),o.$can("update","pv")?(s(),f(c,{key:0,to:{name:"pv-edit-id",params:{id:a.id}},disabled:a.status=="validated"},{default:t(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[i("Modifier")]),_:1}),e(p,{icon:"tabler-edit"})]),_:2},1032,["to","disabled"])):d("",!0),o.$can("delete","pv")?(s(),f(c,{key:1,disabled:a.status=="validated",onClick:q=>{S.value=a.id,j.value="Supprimer le PV",A.value="Voulez vous vraiment supprimer ce pv?",U.value=ie,B.value="Supprimer",I.value=!1,u.value=!0}},{default:t(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:t(()=>[i("Supprimer")]),_:1}),e(p,{icon:"tabler-trash",color:"error"})]),_:2},1032,["disabled","onClick"])):d("",!0)])):d("",!0),(o.$can("reject","pv")||o.$can("validate","pv"))&&("useCookie"in o?o.useCookie:l(H))("userData").value.role==a.validation_level?(s(),h("div",Ee,[e(k),m("span",{class:fe(a.status=="validated"?"full-width-icon":"")},[o.$can("reject","pv")&&a.status!="rejected"?(s(),f(c,{key:0,onClick:q=>{S.value=a.id,j.value="Rejeter le PV",A.value="Voulez vous vraiment rejeter ce PV?",U.value=J,B.value="Rejeter",I.value=!0,z.value="rejected",u.value=!0}},{default:t(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[i("Rejeter")]),_:1}),e(p,{icon:"tabler-x",color:"error"})]),_:2},1032,["onClick"])):d("",!0)],2),a.status=="waiting"?(s(),h("span",ze,[o.$can("validate","pv")?(s(),f(c,{key:0,onClick:q=>{S.value=a.id,j.value="Valider le PV",A.value="Voulez vous vraiment valider ce PV?",U.value=J,B.value="Valider",I.value=!1,z.value="validated",u.value=!0}},{default:t(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:t(()=>[i("Valider")]),_:1}),e(p,{icon:"tabler-check",color:"success"})]),_:2},1032,["onClick"])):d("",!0)])):d("",!0)])):d("",!0),o.$can("create","contract")?(s(),h("div",Ne,[e(k),m("span",Fe,[o.$can("create","contract")?(s(),f(c,{key:0,to:{name:"contract-add",query:{id:a.id}}},{default:t(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:t(()=>[i("Créer le contrat")]),_:1}),e(p,{icon:"tabler-file-plus",color:"success"})]),_:2},1032,["to"])):d("",!0)])])):d("",!0)]),bottom:t(()=>[e(k),m("div",Me,[m("p",qe,E(l(he)({page:l(v),itemsPerPage:l(D)},l(Q))),1),e($e,{modelValue:l(v),"onUpdate:modelValue":n[3]||(n[3]=a=>V(v)?v.value=a:null),length:l(Z),"total-visible":o.$vuetify.display.xs?1:Math.min(l(Z),5)},{prev:t(a=>[e(y,K({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[e(p,{start:"",icon:"tabler-arrow-left"}),i(" Précedent ")]),_:2},1040)]),next:t(a=>[e(y,K({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[i(" Suivant "),e(p,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(Pe,{modelValue:l(u),"onUpdate:modelValue":n[10]||(n[10]=a=>V(u)?u.value=a:null),class:"v-dialog-sm"},{default:t(()=>[e(se,{onClick:n[6]||(n[6]=a=>u.value=!l(u))}),e(L,{title:l(j)},{default:t(()=>[e($,null,{default:t(()=>[i(E(l(A))+" ",1),l(I)?(s(),f(de,{key:0,class:"mt-3",modelValue:l(b),"onUpdate:modelValue":n[7]||(n[7]=a=>V(b)?b.value=a:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):d("",!0)]),_:1}),e($,{class:"d-flex justify-end gap-3 flex-wrap"},{default:t(()=>[e(y,{color:"secondary",variant:"tonal",onClick:n[8]||(n[8]=a=>u.value=!1)},{default:t(()=>[i(" Annuler ")]),_:1}),e(y,{onClick:n[9]||(n[9]=a=>{l(U)(l(S)),u.value=!1})},{default:t(()=>[i(E(l(B)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}},kt=xe(Le,[["__scopeId","data-v-d6065318"]]);export{kt as default};
