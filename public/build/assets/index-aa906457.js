import{_ as pe}from"./AppTextarea-b3184ca2.js";import{_ as fe}from"./DialogCloseBtn-8e0113e4.js";import{V as _e,p as me,a as ve}from"./paginationMeta-07f697b7.js";import{J as ge}from"./js-file-downloader-5d1fe9aa.js";import{$ as Y}from"./api-025774a6.js";import{E as ye,r,ah as he,a1 as O,o as d,c as U,b as e,e as t,s as o,$,a as Ve,d as p,a3 as y,M as l,f,N as c,Z as s,x as v,z as ee,aa as te,C as be,D as ke}from"./main-224c26e2.js";import{u as we}from"./useApi-8aa31e4b.js";import{c as xe}from"./createUrl-9e31b0a4.js";import{_ as Ce}from"./_plugin-vue_export-helper-c27b6911.js";import{V as q}from"./VCard-128eca41.js";import{V as $e}from"./VDialog-58d76181.js";import{V as F}from"./VCardText-76ac8f5d.js";import{V as Te}from"./VRow-931a5d53.js";import{V as Pe}from"./VSpacer-12421fd2.js";import{V as h}from"./VDivider-903c30f9.js";import{V as Se}from"./VAvatar-357ae3be.js";import{a as je}from"./VSelect-7273c665.js";import{V}from"./VTooltip-128e35fe.js";import{V as Be}from"./VMenu-eab44f87.js";import{V as Ae,a as b,b as k}from"./VList-9fcafd51.js";import{V as Ie}from"./VBadge-fa257201.js";import"./VTextField-5847b58e.js";import"./VImg-ee986579.js";import"./forwardRefs-6ea3df5c.js";import"./VTable-b65d1b91.js";import"./filter-dfda6de8.js";import"./index-9c720871.js";import"./useAbility-bb61d04e.js";import"./VOverlay-2c72c002.js";const ae=T=>(be("data-v-43ac8fae"),T=T(),ke(),T),De=ae(()=>p("h2",null," Liste des notifications ",-1)),Ee={class:"d-flex flex-wrap gap-4 mt-5 mx-5"},Re=ae(()=>p("div",{class:"d-flex align-center"},null,-1)),ze={class:"d-flex gap-4 flex-wrap align-center"},Ne={class:"custom-loader"},Ue={class:"d-flex align-center"},Fe={class:"ms-1 text-no-wrap"},Le=["onInput"],Me={key:2},Je={key:3},Oe={key:1},qe={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Qe={class:"text-sm text-medium-emphasis mb-0"},Ze={__name:"index",async setup(T){let P,Q;const oe=ye(),ne=[{title:"Numéro comitée",key:"verbal_trial.committee_id"},{title:"Admin Crédit",key:"creator.full_name"},{title:"Nom client",key:"verbal_trial.applicant_full_name"},{title:"Type de notification",key:"type"},{title:"Téléphone",key:"representative_phone_number"},{title:"Montant",key:"verbal_trial.amount"},{title:"Statut",key:"head_credit_validation"},{title:"Actions",key:"actions",sortable:!1}],S={particular:{icon:"tabler-user",color:"primary",name:"Particulier"},company:{icon:"tabler-users",color:"success",name:"Société"},individual_business:{icon:"tabler-box-multiple-1",color:"info",name:"Entreprise individuelle"}},ie=r(),le=r(""),Z=r(),G=r("signed_notification"),j=r([]),B=r(8),m=r(1),A=r(0),_=r(!1),I=r(""),D=r(""),E=r(""),R=r(),w=r(""),z=r(!1),N=r("waiting"),{data:L,execute:x}=([P,Q]=he(()=>we(xe("/notification",{query:{search:le,type:ie,page:m,with_type_of_credit:1,with_creator:1,is_simple:0,head_credit_validation:"wr",has_cat:0}}))),P=await P,Q(),P),re=i=>{j.value[i]=!0,setTimeout(()=>{j.value[i]=!1},1e3)},se=i=>{m.value=i.page},M=async(i,n)=>{try{new ge({url:i,headers:[{name:"Authorization",value:`Bearer ${te("userToken").value}`},{name:"Accept",value:"application/json"}],nameCallback:function(u){return n}}),x()}catch(u){console.error("Erreur lors du téléchargement:",u)}},de=async(i,n)=>{const{files:u}=n.target;if(u&&u.length===1){const C=new FileReader;C.onload=async()=>{const J=C.result;try{(await fetch(`/api/notification/upload/${i}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${te("userToken").value}`},body:JSON.stringify({[G.value]:J})})).ok?(console.log("Document envoyé avec succès."),x()):console.error("Échec de l'envoi du document.")}catch(a){console.error("Erreur lors de l'envoi du document:",a)}},C.readAsDataURL(u[0])}else console.error("Veuillez sélectionner un seul fichier.")},ce=async i=>{await Y(`notification/${i}`,{method:"DELETE"}),x()},H=async i=>{await Y(`notification/change-head-credit-status/${i}`,{method:"PUT",body:{head_credit_validation:N.value,head_credit_observation:w.value}}),w.value="",N.value=="validated"&&oe.push("/notification/without-signed-contract"),x()},ue=O(()=>L.value.data),K=O(()=>L.value.total),W=O(()=>L.value.last_page);return(i,n)=>{const u=Ve("IconBtn"),C=fe,J=pe;return d(),U("div",null,[e(q,{class:"mb-6"},{default:t(()=>[e(F,null,{default:t(()=>[e(Te,null,{default:t(()=>[e(F,null,{default:t(()=>[De]),_:1})]),_:1})]),_:1})]),_:1}),e(q,{class:"mb-6"},{default:t(()=>[p("div",Ee,[Re,e(Pe),p("div",ze,[e(y,{variant:"tonal",color:"secondary","prepend-icon":"tabler-download"},{default:t(()=>[l(" Export ")]),_:1}),i.$can("create","notification")?(d(),f(y,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"notification-add"}},{default:t(()=>[l(" Ajouter ")]),_:1})):c("",!0),e(y,{loading:o(j)[3],disabled:o(j)[3],"prepend-icon":"tabler-refresh",onClick:n[0]||(n[0]=a=>{o(x)(),re(3)})},{loader:t(()=>[p("span",Ne,[e(s,{icon:"tabler-refresh"})])]),default:t(()=>[l(" Recharger ")]),_:1},8,["loading","disabled"])])]),e(h,{class:"mt-4"}),e(o(_e),{"items-per-page":o(B),"onUpdate:itemsPerPage":n[3]||(n[3]=a=>$(B)?B.value=a:null),page:o(m),"onUpdate:page":n[4]||(n[4]=a=>$(m)?m.value=a:null),headers:ne,items:o(ue),"items-length":o(K),class:"text-no-wrap","onUpdate:options":se},{"item.type":t(({item:a})=>[p("div",Ue,[e(Se,{size:"26",color:S[a.type].color,variant:"tonal"},{default:t(()=>[e(s,{icon:S[a.type].icon,size:"20",color:S[a.type].color,class:"rounded-0"},null,8,["icon","color"])]),_:2},1032,["color"]),p("span",Fe,v(S[a.type].name),1)])]),"item.verbal_trial.amount":t(({item:a})=>[l(v(String(a.verbal_trial.amount).replace(/\B(?=(\d{3})+(?!\d))/g," "))+" F CFA ",1)]),"item.head_credit_validation":t(({item:a})=>[e(je,{label:"",color:{validated:"success",rejected:"error",waiting:"warning"}[a.head_credit_validation]},{default:t(()=>[a.head_credit_observation?(d(),f(V,{key:0,activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[l("Raison: "+v(a.head_credit_observation),1)]),_:2},1024)):c("",!0),l(" "+v(a.head_credit_validation=="validated"?"Validé":null)+" "+v(a.head_credit_validation=="waiting"?"En attente de validation":null)+" "+v(a.head_credit_validation=="rejected"?"Rejeté":null),1)]),_:2},1032,["color"])]),"item.actions":t(({item:a})=>[p("span",null,[e(u,{to:{name:"notification-id",params:{id:a.id}}},{default:t(()=>[e(V,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[l("Details")]),_:1}),e(s,{icon:"tabler-eye"})]),_:2},1032,["to"]),e(y,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:t(()=>[e(s,{size:"24",icon:"tabler-dots-vertical"}),e(Be,{activator:"parent"},{default:t(()=>[e(Ae,null,{default:t(()=>[p("input",{ref_key:"refInputEl",ref:Z,type:"file",name:"signed_notification",accept:".pdf,.png,.jpg",hidden:"",onInput:g=>de(a.id,g)},null,40,Le),i.$can("read","guarantor")?(d(),f(Ie,{key:0,inline:"",content:a.guarantors_count},{default:t(()=>[e(b,{to:{name:"notification-notification_id-guarantor",params:{notification_id:a.id}}},{prepend:t(()=>[e(s,{icon:"tabler-users"})]),default:t(()=>[e(k,null,{default:t(()=>[l(" Voir les Cautions ")]),_:1})]),_:2},1032,["to"])]),_:2},1032,["content"])):c("",!0),i.$can("read","pv")?(d(),f(b,{key:1,to:{name:"pv-id",params:{id:a.verbal_trial.id}}},{prepend:t(()=>[e(s,{icon:"tabler-eye"})]),default:t(()=>[e(k,null,{default:t(()=>[l("Voir le Pv")]),_:1})]),_:2},1032,["to"])):c("",!0),i.$can("download","notification")?(d(),U("div",Me,[e(h),e(b,{onClick:g=>{M(`/api/notification/download/${a.id}`,`Notification-${a.verbal_trial.committee_id}.docx`)}},{prepend:t(()=>[e(s,{icon:"tabler-download"})]),default:t(()=>[e(k,null,{default:t(()=>[l("Télécharger Notification non signé")]),_:1})]),_:2},1032,["onClick"]),e(b,{onClick:g=>{M(`/api/notification/promissory-note/download/${a.id}`,`Billet-à-ordre-${a.verbal_trial.committee_id}.docx`)}},{prepend:t(()=>[e(s,{icon:"tabler-download"})]),default:t(()=>[e(k,null,{default:t(()=>[l("Télécharger Billet à ordre non signé")]),_:1})]),_:2},1032,["onClick"])])):c("",!0),i.$can("upload","notification")?(d(),U("div",Je,[e(h),a.signed_promissory_note_path==null?(d(),f(b,{key:0,onClick:n[1]||(n[1]=g=>{var X;G.value="signed_promissory_note",(X=o(Z))==null||X.click()})},{prepend:t(()=>[e(s,{icon:"tabler-cloud-upload"})]),default:t(()=>[e(k,null,{default:t(()=>[l("Ajouter billet à ordre signé")]),_:1})]),_:1})):c("",!0),a.signed_promissory_note_path?(d(),f(b,{key:1,onClick:g=>M(a.signed_promissory_note_path,`Billet-à-ordre-${a.signed_promissory_note_path.split("/").slice(-1)[0]}`)},{prepend:t(()=>[e(s,{icon:"tabler-download"})]),default:t(()=>[e(k,null,{default:t(()=>[l("Télécharger Billet à ordre signé")]),_:1})]),_:2},1032,["onClick"])):c("",!0)])):c("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),p("span",null,[e(h),i.$can("update","notification")?(d(),f(u,{key:0,to:{name:"notification-edit-id",params:{id:a.id}}},{default:t(()=>[e(V,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[l("Modifier")]),_:1}),e(s,{icon:"tabler-edit"})]),_:2},1032,["to"])):c("",!0),i.$can("delete","notification")?(d(),f(u,{key:1,onClick:g=>{A.value=a.id,I.value="Supprimer le PV",D.value="Voulez vous vraiment supprimer ce pv?",R.value=ce,E.value="Supprimer",z.value=!1,_.value=!0}},{default:t(()=>[e(V,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:t(()=>[l("Supprimer")]),_:1}),e(s,{icon:"tabler-trash",color:"error"})]),_:2},1032,["onClick"])):c("",!0)]),e(h),i.$can("reject","notification")&&a.head_credit_validation!="rejected"?(d(),f(u,{key:0,onClick:g=>{A.value=a.id,I.value="Rejeter le PV",D.value="Voulez vous vraiment rejeter ce PV?",R.value=H,E.value="Rejeter",z.value=!0,N.value="rejected",_.value=!0}},{default:t(()=>[e(V,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[l("Rejeter")]),_:1}),e(s,{icon:"tabler-x",color:"error"})]),_:2},1032,["onClick"])):c("",!0),a.head_credit_validation=="waiting"?(d(),U("span",Oe,[i.$can("validate","notification")?(d(),f(u,{key:0,onClick:g=>{A.value=a.id,I.value="Valider le PV",D.value="Voulez vous vraiment valider ce PV?",R.value=H,E.value="Valider",z.value=!1,N.value="validated",_.value=!0}},{default:t(()=>[e(V,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:t(()=>[l("Valider")]),_:1}),e(s,{icon:"tabler-check",color:"success"})]),_:2},1032,["onClick"])):c("",!0)])):c("",!0)]),bottom:t(()=>[e(h),p("div",qe,[p("p",Qe,v(o(me)({page:o(m),itemsPerPage:o(B)},o(K))),1),e(ve,{modelValue:o(m),"onUpdate:modelValue":n[2]||(n[2]=a=>$(m)?m.value=a:null),length:o(W),"total-visible":i.$vuetify.display.xs?1:Math.min(o(W),5)},{prev:t(a=>[e(y,ee({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[e(s,{start:"",icon:"tabler-arrow-left"}),l(" Précedent ")]),_:2},1040)]),next:t(a=>[e(y,ee({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[l(" Suivant "),e(s,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e($e,{modelValue:o(_),"onUpdate:modelValue":n[9]||(n[9]=a=>$(_)?_.value=a:null),class:"v-dialog-sm"},{default:t(()=>[e(C,{onClick:n[5]||(n[5]=a=>_.value=!o(_))}),e(q,{title:o(I)},{default:t(()=>[e(F,null,{default:t(()=>[l(v(o(D))+" ",1),o(z)?(d(),f(J,{key:0,class:"mt-3",modelValue:o(w),"onUpdate:modelValue":n[6]||(n[6]=a=>$(w)?w.value=a:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):c("",!0)]),_:1}),e(F,{class:"d-flex justify-end gap-3 flex-wrap"},{default:t(()=>[e(y,{color:"secondary",variant:"tonal",onClick:n[7]||(n[7]=a=>_.value=!1)},{default:t(()=>[l(" Annuler ")]),_:1}),e(y,{onClick:n[8]||(n[8]=a=>{o(R)(o(A)),_.value=!1})},{default:t(()=>[l(v(o(E)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}},wt=Ce(Ze,[["__scopeId","data-v-43ac8fae"]]);export{wt as default};
