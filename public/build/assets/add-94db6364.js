import{r as n}from"./validators-be8c4c00.js";import{r as v,w as k,ah as U,a1 as x,c as A,b as a,e as i,a2 as le,E as te,o as C,s,F as re,A as ie,d as f,a3 as M,M as h,Z as P,C as ue,D as oe,ai as se}from"./main-e84ce0a6.js";import{_ as de}from"./AppSelect-bd457cdc.js";import{_ as ne}from"./AppAutocomplete-02a87663.js";import{_ as me}from"./AppDateTimePicker-b73077cf.js";import{_ as pe}from"./AppTextField-cfb27a57.js";import{c as I}from"./createUrl-f896560b.js";import{u as j}from"./useApi-7dd63682.js";import{_ as _e}from"./GuaranteeEdit-7d08b609.js";import{$ as ce}from"./api-6638b469.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";import{V as L}from"./VRow-d22e34f5.js";import{V as ve}from"./VForm-b81ac70c.js";import{V as o}from"./VCol-a817eccc.js";import{V as D}from"./VCard-fe1def77.js";import{V as F}from"./VCardText-c43c5a35.js";import{V as S}from"./VSlider-538640ca.js";import{V as $}from"./VTextField-bed2e038.js";import"./VSelect-0f27dc1c.js";import"./forwardRefs-6ea3df5c.js";import"./VList-31615f1a.js";import"./VImg-291e1ee2.js";import"./VAvatar-b9338bff.js";import"./VDivider-a6507b5e.js";import"./VOverlay-3c60a455.js";import"./VMenu-4db2c15b.js";import"./filter-7bde97a1.js";import"./index-9c720871.js";import"./AppTextarea-3559f584.js";import"./useAbility-d056d777.js";const N=b=>(ue("data-v-ced9e9cf"),b=b(),oe(),b),Ve=N(()=>f("div",{class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},[f("div",{class:"d-flex flex-column justify-center"},[f("h4",{class:"text-h4 font-weight-medium"},"Ajouter un nouveau PV"),f("span",null,"Procès verbal pour un nouveau crédit")])],-1)),ge={class:"my-4 ma-sm-4"},ye={class:"mt-4 ma-sm-4"},be={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},qe=N(()=>f("div",{class:"d-flex flex-column justify-center"},null,-1)),we={class:"d-flex gap-4 align-center flex-wrap"},Ee={__name:"add",async setup(b){let m,V;const R=te(),g=v(""),c=v(null),q=v(null),y=v(""),e=v({committee_id:"",committee_date:"",caf_id:"",civility:"Mr",applicant_first_name:"",applicant_last_name:"",account_number:"",activity:"",purpose_of_financing:"",type_of_credit_id:"",amount:"",duration:"",periodicity:"mensual",due_amount:"",insurance_premium:"",administrative_fees_percentage:0,tax_fee_interest_rate:14,credit_admin_id:"",guarantees:[{type_of_guarantee_id:1,comment:"..."}]}),B=async()=>{if(y.value){const l=await fetch(`/api/clients/comptes?search=${encodeURIComponent(y.value)}`);if(!l.ok)throw new Error("Erreur lors de la récupération des données");return await l.json()}};k(y,async l=>{var t,d;if(l){q.value=await B();const _=(d=(t=q.value.data)==null?void 0:t.data)==null?void 0:d[0];e.value.applicant_first_name=_.nom_replegal??_.raison_sociale_client,e.value.applicant_last_name=_.nom_replegal??_.prenom_client,e.value.account_number=_.no_compte}else q.value=[]});const T=()=>({committee_id:"",committee_date:"",caf_id:"",civility:"",applicant_first_name:"",applicant_last_name:"",account_number:"",activity:"",purpose_of_financing:"",type_of_credit_id:"",amount:"",duration:"",periodicity:"",due_amount:"",insurance_premium:"",administrative_fees_percentage:"",tax_fee_interest_rate:"",credit_admin_id:""}),u=v(T()),O=[{value:"Mr",title:"Mr"},{value:"Mme",title:"Mme"},{value:"Mlle",title:"Mlle"}],G=[{value:"mensual",title:"Mensuelle"},{value:"quarterly",title:"Trimestrielle"},{value:"semi-annual",title:"Semestrielle"},{value:"annual",title:"Annuelle"},{value:"in-fine",title:"A la fin"}],{data:z}=([m,V]=U(()=>j(I("/type-of-credit",{query:{paginate:0}}))),m=await m,V(),m),H=x(()=>z.value.data),{data:Z}=([m,V]=U(()=>j(I("/user",{query:{paginate:0,profile:"caf"}}))),m=await m,V(),m),J=x(()=>Z.value.data),{data:K}=([m,V]=U(()=>j(I("/user",{query:{paginate:0,profile:"credit_admin"}}))),m=await m,V(),m),Q=x(()=>K.value.data),E=v(),W=()=>{var l;(l=E.value)==null||l.validate().then(async({valid:t})=>{if(t){const d=await ce("/verbal-trial",{method:"POST",body:{committee_id:e.value.committee_id,committee_date:e.value.committee_date,caf_id:e.value.caf_id,civility:e.value.civility,applicant_first_name:e.value.applicant_first_name,applicant_last_name:e.value.applicant_last_name,account_number:e.value.account_number,activity:e.value.activity,purpose_of_financing:e.value.purpose_of_financing,type_of_credit_id:e.value.type_of_credit_id,amount:e.value.amount,duration:e.value.duration,periodicity:e.value.periodicity,due_amount:e.value.due_amount,insurance_premium:e.value.insurance_premium,administrative_fees_percentage:e.value.administrative_fees_percentage,taf:e.value.taf,tax_fee_interest_rate:e.value.tax_fee_interest_rate,guarantees:e.value.guarantees,credit_admin_id:e.value.credit_admin_id}});let _="/pv";if(u.value=T(),d.status==201)e.value.guarantees.forEach(p=>{p.type_of_guarantee_id==9&&(_="/pv/without-notification")}),R.push(_);else for(const p in d.errors)d.errors[p].forEach(w=>{u.value[p]+=w+`
`});se(()=>{var p;(p=E.value)==null||p.resetValidation()})}})},X=l=>{e.value.guarantees.splice(l,1)},Y=()=>{e.value.guarantees.push({type_of_guarantee_id:1,expiration_date:"",value:"",comment:""})},ee=async()=>{if(g.value){const l=await fetch(`/api/clients/prets?search=${encodeURIComponent(g.value)}`);if(!l.ok)throw new Error("Erreur lors de la récupération des données");return await l.json()}};return k(g,async l=>{l?(c.value=await ee(),console.log("dans le wacth",c.value),e.value.amount=c.value.data.data[0].mt_demande,e.value.due_amount=c.value.data.data[0].mt_pret_int,e.value.insurance_premium=c.value.data.data[0].mt_assurance,e.value.duration=c.value.data.data[0].nb_ech_pret,e.value.tax_fee_interest_rate=c.value.data.data[0].tx_int_pret,e.value.committee_id=c.value.data.data[0].ref_comite):q.value=[]}),(l,t)=>{const d=pe,_=me,p=ne,w=de;return C(),A("div",null,[Ve,a(L,null,{default:i(()=>[a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=r=>y.value=r),label:"Numéro du matricule"},null,8,["modelValue"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=r=>g.value=r),label:"Numéro du prêt"},null,8,["modelValue"])]),_:1})]),_:1}),a(ve,{ref_key:"refForm",ref:E,onSubmit:le(W,["prevent"])},{default:i(()=>[a(L,null,{default:i(()=>[a(o,{md:"12"},{default:i(()=>[a(D,{class:"mb-6",title:"Information du pv"},{default:i(()=>[a(F,null,{default:i(()=>[a(L,null,{default:i(()=>[a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:e.value.committee_id,"onUpdate:modelValue":t[2]||(t[2]=r=>e.value.committee_id=r),"error-messages":u.value.committee_id,label:"Numéro du comitée",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(_,{modelValue:e.value.committee_date,"onUpdate:modelValue":t[3]||(t[3]=r=>e.value.committee_date=r),"error-messages":u.value.committee_date,label:"Date du comitée",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(p,{modelValue:e.value.caf_id,"onUpdate:modelValue":t[4]||(t[4]=r=>e.value.caf_id=r),items:s(J),"error-messages":u.value.caf_id,label:"Chargé d'affaire","item-title":"full_name","item-value":"id",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(p,{modelValue:e.value.credit_admin_id,"onUpdate:modelValue":t[5]||(t[5]=r=>e.value.credit_admin_id=r),items:s(Q),"error-messages":u.value.credit_admin_id,label:"Administrateur Crédit","item-title":"full_name","item-value":"id",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(w,{modelValue:e.value.civility,"onUpdate:modelValue":t[6]||(t[6]=r=>e.value.civility=r),items:O,"error-messages":u.value.civility,label:"Civilité",placeholder:"Ex: Mr",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:e.value.applicant_first_name,"onUpdate:modelValue":t[7]||(t[7]=r=>e.value.applicant_first_name=r),"error-messages":u.value.applicant_first_name,label:"Prénom du demandeur",placeholder:"Ex: Cesar",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:e.value.applicant_last_name,"onUpdate:modelValue":t[8]||(t[8]=r=>e.value.applicant_last_name=r),"error-messages":u.value.applicant_last_name,label:"Nom du demandeur",placeholder:"Ex: Endure",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:e.value.account_number,"onUpdate:modelValue":t[9]||(t[9]=r=>e.value.account_number=r),"error-messages":u.value.account_number,label:"Numéro de compte",placeholder:"Ex: 251012345678",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:e.value.activity,"onUpdate:modelValue":t[10]||(t[10]=r=>e.value.activity=r),"error-messages":u.value.activity,label:"Fonction",placeholder:"Ex: Homme d'affaire",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:e.value.purpose_of_financing,"onUpdate:modelValue":t[11]||(t[11]=r=>e.value.purpose_of_financing=r),"error-messages":u.value.purpose_of_financing,label:"Objet du financement",placeholder:"Ex: Achat nouveau locaux",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(p,{modelValue:e.value.type_of_credit_id,"onUpdate:modelValue":t[12]||(t[12]=r=>e.value.type_of_credit_id=r),items:s(H),"error-messages":u.value.type_of_credit_id,label:"Type de credit",placeholder:"Ex: Avance sur salaire","item-title":"full_name","item-value":"id",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:e.value.amount,"onUpdate:modelValue":t[13]||(t[13]=r=>e.value.amount=r),type:"number","error-messages":u.value.amount,label:"Montant",placeholder:"Ex: 15 000 000",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:e.value.due_amount,"onUpdate:modelValue":t[14]||(t[14]=r=>e.value.due_amount=r),type:"number","error-messages":u.value.due_amount,label:"Montant des interêts",placeholder:"Ex: 300 000",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:e.value.duration,"onUpdate:modelValue":t[15]||(t[15]=r=>e.value.duration=r),type:"number","error-messages":u.value.duration,label:"Durée du crédit en mois",placeholder:"Ex: 18","append-inner-icon":"tabler-calendar",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(w,{modelValue:e.value.periodicity,"onUpdate:modelValue":t[16]||(t[16]=r=>e.value.periodicity=r),items:G,"error-messages":u.value.periodicity,label:"Periodicité",placeholder:"Ex: Mensuelle",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12",md:"6",lg:"4"},{default:i(()=>[a(d,{modelValue:e.value.insurance_premium,"onUpdate:modelValue":t[17]||(t[17]=r=>e.value.insurance_premium=r),type:"number","error-messages":u.value.insurance_premium,label:"Prime d'assurance",placeholder:"Ex: 25000",rules:["requiredValidator"in l?l.requiredValidator:s(n)]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12"},{default:i(()=>[a(S,{modelValue:e.value.administrative_fees_percentage,"onUpdate:modelValue":t[19]||(t[19]=r=>e.value.administrative_fees_percentage=r),label:"Frais de dossier(%)","error-messages":u.value.administrative_fees_percentage,"thumb-size":15,"thumb-label":"always",rules:["requiredValidator"in l?l.requiredValidator:s(n)],step:"0.1"},{append:i(()=>[a($,{modelValue:e.value.administrative_fees_percentage,"onUpdate:modelValue":t[18]||(t[18]=r=>e.value.administrative_fees_percentage=r),"error-messages":u.value.administrative_fees_percentage,type:"number",style:{width:"80px"},density:"compact","hide-details":"",variant:"outlined",suffix:"%"},null,8,["modelValue","error-messages"])]),_:1},8,["modelValue","error-messages","rules"])]),_:1}),a(o,{cols:"12"},{default:i(()=>[a(S,{modelValue:e.value.tax_fee_interest_rate,"onUpdate:modelValue":t[21]||(t[21]=r=>e.value.tax_fee_interest_rate=r),label:"Taux d'intérêt HT(%)","error-messages":u.value.tax_fee_interest_rate,"thumb-size":15,"thumb-label":"always",rules:["requiredValidator"in l?l.requiredValidator:s(n)],step:"0.1"},{append:i(()=>[a($,{modelValue:e.value.tax_fee_interest_rate,"onUpdate:modelValue":t[20]||(t[20]=r=>e.value.tax_fee_interest_rate=r),"error-messages":u.value.tax_fee_interest_rate,type:"number",style:{width:"80px"},density:"compact","hide-details":"",variant:"outlined",suffix:"%"},null,8,["modelValue","error-messages"])]),_:1},8,["modelValue","error-messages","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),a(D,{class:"mb-6",title:"Information des garanties"},{default:i(()=>[a(F,{class:"add-products-form"},{default:i(()=>[(C(!0),A(re,null,ie(e.value.guarantees,(r,ae)=>(C(),A("div",ge,[a(_e,{id:ae,data:r,onRemoveGuarantee:X},null,8,["id","data"])]))),256)),f("div",ye,[a(M,{"prepend-icon":"tabler-plus",onClick:Y},{default:i(()=>[h(" Ajouter ")]),_:1})])]),_:1})]),_:1})]),_:1}),a(o,{cols:"12"},{default:i(()=>[f("div",be,[qe,f("div",we,[a(M,{type:"reset",variant:"tonal",color:"primary"},{default:i(()=>[a(P,{start:"",icon:"tabler-circle-minus"}),h(" Effacer ")]),_:1}),a(M,{type:"submit",class:"me-3"},{default:i(()=>[h(" Enregistrer "),a(P,{end:"",icon:"tabler-checkbox"})]),_:1})])])]),_:1})]),_:1})]),_:1},512)])}}},ea=fe(Ee,[["__scopeId","data-v-ced9e9cf"]]);export{ea as default};
