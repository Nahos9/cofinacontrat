import{_ as se}from"./AppTextarea-aba9749f.js";import{_ as re}from"./DialogCloseBtn-50483eba.js";import{_ as ie}from"./AppTextField-27ca1ff4.js";import{V as de,p as ue,a as ce}from"./paginationMeta-d1e1cd78.js";import{J as pe}from"./js-file-downloader-1ac55759.js";import{$ as G}from"./api-0630d56b.js";import{E as me,r as i,ah as ve,a1 as L,o as r,c as g,b as e,e as t,s as n,$ as V,a as fe,d as _,a3 as f,M as s,f as p,N as d,Z as u,x as k,z as H,aa as _e,C as Ve,D as be}from"./main-b79bab7d.js";import{u as ye}from"./useApi-f36f0b4b.js";import{c as ge}from"./createUrl-424af01a.js";import{_ as ke}from"./_plugin-vue_export-helper-c27b6911.js";import{V as F}from"./VCard-ab8a42b0.js";import{V as he}from"./VDialog-e658d4ee.js";import{V as h}from"./VCardText-b8528b45.js";import{V as K}from"./VRow-aaddea0f.js";import{V as $e}from"./VCol-54e0adfb.js";import{V as Ce,a as xe}from"./VSelect-0570748a.js";import{V as $}from"./VDivider-20e200a7.js";import{V as we}from"./VSpacer-86cebbd1.js";import{V as b}from"./VTooltip-81e77da7.js";import{V as Pe}from"./VMenu-b01cd03b.js";import{V as Te,a as W,b as X}from"./VList-4e005a62.js";import"./VTextField-05b92c6c.js";import"./VImg-c7f49976.js";import"./forwardRefs-6ea3df5c.js";import"./VTable-e8667096.js";import"./filter-f4e45105.js";import"./index-9c720871.js";import"./useAbility-26157080.js";import"./VAvatar-f2d16882.js";import"./VOverlay-b15ad492.js";const Se=C=>(Ve("data-v-37eb7382"),C=C(),be(),C),De=Se(()=>_("h2",null," Liste des Report d'échéance en attente ",-1)),je={class:"d-flex flex-wrap gap-4 mx-5"},Re={class:"d-flex align-center"},Ae={class:"d-flex gap-4 flex-wrap align-center"},Ie={class:"custom-loader"},Be={key:0},Ee={key:0},Ue={key:1},ze={key:1},Me={key:2},Ne={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Le={class:"text-sm text-medium-emphasis mb-0"},Fe={__name:"index",async setup(C){let x,q;const Y=me();i();const z=i(),w=i(""),P=i([]),T=i(8),m=i(1),S=i(0),c=i(!1),D=i(""),j=i(""),R=i(""),A=i(),y=i(""),I=i(!1),B=i("waiting"),ee=[{title:"Client",key:"beneficiary_label"},{title:"Montant",key:"loan_amount"},{title:"Numéro Crédit",key:"credit_number"},{title:"Rallonge",key:"extension"},{title:"Echéance",key:"deadline_number"},{title:"Ancienne date",key:"old_date"},{title:"Nouvelle date",key:"new_date"},{title:"Statut",key:"status"},{title:"Actions",key:"actions",sortable:!1}],{data:E,execute:M}=([x,q]=ve(()=>ye(ge("/deadline-postponed",{query:{search:w,page:m,with_caf:1}}))),x=await x,q(),x),te=l=>{P.value[l]=!0,setTimeout(()=>{P.value[l]=!1},1e3)},ae=l=>{m.value=l.page},J=async(l,o)=>{const N=_e("userToken").value;try{new pe({url:l,headers:[{name:"Authorization",value:`Bearer ${N}`},{name:"Accept",value:"application/json"}],nameCallback:function(v){return o}})}catch(v){console.error("Erreur lors du téléchargement:",v)}},le=async l=>{await G(`verbal-trial/${l}`,{method:"DELETE"}),y.value="",M()},O=async l=>{await G(`verbal-trial/change-status/${l}`,{method:"PUT",body:{status:B.value,comment:y.value}}),y.value="",B.value=="validated"&&Y.push(`/contract/add?id=${l}`),M()};console.log(E.value.data);const Q=L(()=>E.value.data);console.log(Q),L(()=>E.value.total);const Z=L(()=>E.value.last_page);return(l,o)=>{const N=ie,v=fe("IconBtn"),oe=re,ne=se;return r(),g("div",null,[e(F,{class:"mb-6"},{default:t(()=>[e(h,null,{default:t(()=>[e(K,null,{default:t(()=>[e(h,null,{default:t(()=>[De]),_:1})]),_:1})]),_:1})]),_:1}),e(F,{title:"Filtres",class:"mb-6"},{default:t(()=>[e(h,null,{default:t(()=>[e(K,null,{default:t(()=>[e($e,{cols:"12",sm:"4"},{default:t(()=>[e(Ce,{modelValue:n(z),"onUpdate:modelValue":o[0]||(o[0]=a=>V(z)?z.value=a:null),placeholder:"Statut",items:[{value:"v",title:"Validé"},{value:"w",title:"En attente"},{value:"r",title:"Rejeté"}],"clear-icon":"tabler-x",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e($,{class:"my-4"}),_("div",je,[_("div",Re,[e(N,{modelValue:n(w),"onUpdate:modelValue":o[1]||(o[1]=a=>V(w)?w.value=a:null),placeholder:"Rechercher un pv",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(we),_("div",Ae,[e(f,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:t(()=>[s(" Export ")]),_:1}),l.$can("create","deadline-postponed")?(r(),p(f,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"deadline-postponed-add"}},{default:t(()=>[s(" Ajouter ")]),_:1})):d("",!0),e(f,{loading:n(P)[3],disabled:n(P)[3],"prepend-icon":"tabler-refresh",onClick:o[2]||(o[2]=a=>{n(M)(),te(3)})},{loader:t(()=>[_("span",Ie,[e(u,{icon:"tabler-refresh"})])]),default:t(()=>[s(" Recharger ")]),_:1},8,["loading","disabled"])])]),e($,{class:"mt-4"}),e(n(de),{"items-per-page":n(T),"onUpdate:itemsPerPage":o[4]||(o[4]=a=>V(T)?T.value=a:null),page:n(m),"onUpdate:page":o[5]||(o[5]=a=>V(m)?m.value=a:null),headers:ee,items:n(Q),"items-length":l.totalPv,class:"text-no-wrap","onUpdate:options":ae},{"item.status":t(({item:a})=>[e(xe,{label:"",color:a.status_fr.color},{default:t(()=>[a.comment?(r(),p(b,{key:0,activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[s("Raison: "+k(a.comment),1)]),_:2},1024)):d("",!0),s(" "+k(a.status_fr.value),1)]),_:2},1032,["color"])]),"item.actions":t(({item:a})=>[_("div",null,[l.$can("read","deadline-postponed")||l.$can("historical","deadline-postponed")?(r(),p(v,{key:0,to:{name:"deadline-postponed-id",params:{id:a.id}}},{default:t(()=>[e(b,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[s("Details")]),_:1}),e(u,{icon:" tabler-eye"})]),_:2},1032,["to"])):d("",!0),e(f,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:t(()=>[e(u,{size:"24",icon:"tabler-dots-vertical"}),e(Pe,{activator:"parent"},{default:t(()=>[e(Te,null,{default:t(()=>[l.$can("download","deadline-postponed")?(r(),g("div",Be,[e(W,{onClick:U=>J(a.request_path,`${a.id}-Demande-${a.beneficiary_label.split("/").slice(-1)[0]}}`)},{prepend:t(()=>[e(u,{icon:"tabler-download"})]),default:t(()=>[e(X,null,{default:t(()=>[s("Télécharger Demande")]),_:1})]),_:2},1032,["onClick"]),a.signed_contract_path?(r(),p(W,{key:0,onClick:U=>J(a.memo_path,`${a.id}-Memo-${a.beneficiary_label.split("/").slice(-1)[0]}}`)},{prepend:t(()=>[e(u,{icon:"tabler-download"})]),default:t(()=>[e(X,null,{default:t(()=>[s("Télécharger Mémo")]),_:1})]),_:2},1032,["onClick"])):d("",!0)])):d("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),l.$can("update","deadline-postponed")||l.$can("delete","deadline-postponed")?(r(),g("div",Ee,[e($),l.$can("update","deadline-postponed")?(r(),p(v,{key:0,to:{name:"deadline-postponed-edit-id",params:{id:a.id}},disabled:a.status=="validated"},{default:t(()=>[e(b,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[s("Modifier")]),_:1}),e(u,{icon:"tabler-edit"})]),_:2},1032,["to","disabled"])):d("",!0),l.$can("delete","deadline-postponed")?(r(),p(v,{key:1,disabled:a.status=="validated",onClick:U=>{S.value=a.id,D.value="Supprimer le PV",j.value="Voulez vous vraiment supprimer ce pv?",A.value=le,R.value="Supprimer",I.value=!1,c.value=!0}},{default:t(()=>[e(b,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:t(()=>[s("Supprimer")]),_:1}),e(u,{icon:"tabler-trash",color:"error"})]),_:2},1032,["disabled","onClick"])):d("",!0)])):d("",!0),l.$can("reject","deadline-postponed")||l.$can("validate","deadline-postponed")||l.$can("create","deadline-postponed")?(r(),g("div",Ue,[e($),l.$can("reject","deadline-postponed")&&a.status!="rejected"?(r(),p(v,{key:0,onClick:U=>{S.value=a.id,D.value="Rejeter le PV",j.value="Voulez vous vraiment rejeter ce PV?",A.value=O,R.value="Rejeter",I.value=!0,B.value="rejected",c.value=!0}},{default:t(()=>[e(b,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[s("Rejeter")]),_:1}),e(u,{icon:"tabler-x",color:"error"})]),_:2},1032,["onClick"])):d("",!0),a.status=="waiting"?(r(),g("span",ze,[l.$can("validate","deadline-postponed")?(r(),p(v,{key:0,onClick:U=>{S.value=a.id,D.value="Valider le PV",j.value="Voulez vous vraiment valider ce PV?",A.value=O,R.value="Valider",I.value=!1,B.value="validated",c.value=!0}},{default:t(()=>[e(b,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:t(()=>[s("Valider")]),_:1}),e(u,{icon:"tabler-check",color:"success"})]),_:2},1032,["onClick"])):d("",!0)])):d("",!0),a.status=="validated"?(r(),g("span",Me,[l.$can("create","deadline-postponed")?(r(),p(v,{key:0,to:{name:"contract-add",query:{id:a.id}}},{default:t(()=>[e(b,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:t(()=>[s("Créer le contrat")]),_:1}),e(u,{icon:"tabler-file-plus",color:"success"})]),_:2},1032,["to"])):d("",!0)])):d("",!0)])):d("",!0)]),bottom:t(()=>[e($),_("div",Ne,[_("p",Le,k(n(ue)({page:n(m),itemsPerPage:n(T)},l.totalPv)),1),e(ce,{modelValue:n(m),"onUpdate:modelValue":o[3]||(o[3]=a=>V(m)?m.value=a:null),length:n(Z),"total-visible":l.$vuetify.display.xs?1:Math.min(n(Z),5)},{prev:t(a=>[e(f,H({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[e(u,{start:"",icon:"tabler-arrow-left"}),s(" Précedent ")]),_:2},1040)]),next:t(a=>[e(f,H({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[s(" Suivant "),e(u,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(he,{modelValue:n(c),"onUpdate:modelValue":o[10]||(o[10]=a=>V(c)?c.value=a:null),class:"v-dialog-sm"},{default:t(()=>[e(oe,{onClick:o[6]||(o[6]=a=>c.value=!n(c))}),e(F,{title:n(D)},{default:t(()=>[e(h,null,{default:t(()=>[s(k(n(j))+" ",1),n(I)?(r(),p(ne,{key:0,class:"mt-3",modelValue:n(y),"onUpdate:modelValue":o[7]||(o[7]=a=>V(y)?y.value=a:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):d("",!0)]),_:1}),e(h,{class:"d-flex justify-end gap-3 flex-wrap"},{default:t(()=>[e(f,{color:"secondary",variant:"tonal",onClick:o[8]||(o[8]=a=>c.value=!1)},{default:t(()=>[s(" Annuler ")]),_:1}),e(f,{onClick:o[9]||(o[9]=a=>{n(A)(n(S)),c.value=!1})},{default:t(()=>[s(k(n(R)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}},yt=ke(Fe,[["__scopeId","data-v-37eb7382"]]);export{yt as default};
