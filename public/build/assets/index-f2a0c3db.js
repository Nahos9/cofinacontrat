import{_ as oe}from"./DialogCloseBtn-50483eba.js";import{_ as ne}from"./AppTextField-27ca1ff4.js";import{V as re,p as le,a as ie}from"./paginationMeta-d1e1cd78.js";import{J as se}from"./js-file-downloader-1ac55759.js";import{n as de,r as _,ah as ue,a1 as P,o as i,c as b,b as e,e as t,s as n,$ as V,a as ce,d as v,a3 as p,M as l,f as y,N as m,Z as d,F as M,A as O,x as E,z as J,aa as G}from"./main-b79bab7d.js";import{u as pe}from"./useApi-f36f0b4b.js";import{c as me}from"./createUrl-424af01a.js";import{$ as fe}from"./api-0630d56b.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";import{V as q}from"./VCard-ab8a42b0.js";import{V as ge}from"./VDialog-e658d4ee.js";import{V as ve}from"./VRow-aaddea0f.js";import{V as Q}from"./VCol-54e0adfb.js";import{V as ye}from"./VSpacer-86cebbd1.js";import{V as B}from"./VDivider-20e200a7.js";import{V as Z,b as h,a as k}from"./VList-4e005a62.js";import{a as H}from"./VSelect-0570748a.js";import{V as be}from"./VMenu-b01cd03b.js";import{V as K}from"./VCardText-b8528b45.js";import"./VTextField-05b92c6c.js";import"./VImg-c7f49976.js";import"./forwardRefs-6ea3df5c.js";import"./VTable-e8667096.js";import"./filter-f4e45105.js";import"./index-9c720871.js";import"./useAbility-26157080.js";import"./VAvatar-f2d16882.js";import"./VOverlay-b15ad492.js";const Ve={class:"d-flex flex-wrap gap-4 mx-5"},he={class:"d-flex align-center"},ke={class:"d-flex gap-4 flex-wrap align-center"},$e={class:"custom-loader"},xe=["onInput"],Ce={key:0},we={key:1},Te={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Be={class:"text-sm text-medium-emphasis mb-0"},De={__name:"index",async setup(Ae){let $,N;const x=de(),f=_(!1),S=_(0),C=_(""),F=_(),L=_("signed_notification"),W=[{title:"Nom",key:"full_name"},{title:"Fonction",key:"function"},{title:"Pièce didentité",key:"number_of_identity_document"},{title:"Numéro de téléphone",key:"phone_number"},{title:"Observations",key:"observations"},{title:"Actions",key:"actions",sortable:!1}],w=_([]),X=r=>{w.value[r]=!0,setTimeout(()=>{w.value[r]=!1},1e3)},T=_(8),u=_(1),Y=r=>{u.value=r.page},{data:D,execute:A}=([$,N]=ue(()=>pe(me("/guarantor",{query:{search:C,with_verbal_trial:1,notification_id:x.params.notification_id,page:u}}))),$=await $,N(),$),ee=P(()=>D.value.data),U=P(()=>D.value.total),j=P(()=>D.value.last_page),z=async(r,o)=>{const g=G("userToken").value;try{new se({url:r,headers:[{name:"Authorization",value:`Bearer ${g}`},{name:"Accept",value:"application/json"}],nameCallback:function(s){return o}})}catch(s){console.error("Erreur lors du téléchargement:",s)}},te=async(r,o)=>{const{files:g}=o.target;if(g&&g.length===1){const s=new FileReader;s.onload=async()=>{const I=s.result;try{(await fetch(`/api/guarantor/upload/${r}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${G("userToken").value}`},body:JSON.stringify({[L.value]:I})})).ok?A():console.error("Échec de l'envoi du document.")}catch(a){console.error("Erreur lors de l'envoi du document:",a)}},s.readAsDataURL(g[0])}else console.error("Veuillez sélectionner un seul fichier.")},ae=async r=>{await fe(`guarantor/${r}`,{method:"DELETE"}),A()};return(r,o)=>{const g=ne,s=ce("IconBtn"),I=oe;return i(),b("div",null,[e(q,{title:"Liste des cautions",class:"mb-6"},{default:t(()=>[v("div",Ve,[v("div",he,[e(ve,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(p,{"prepend-icon":"tabler-arrow-left",to:"../"},{default:t(()=>[l(" Notifications ")]),_:1})]),_:1}),e(Q,null,{default:t(()=>[e(g,{modelValue:n(C),"onUpdate:modelValue":o[0]||(o[0]=a=>V(C)?C.value=a:null),placeholder:"Rechercher",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),_:1})]),_:1})]),e(ye),v("div",ke,[e(p,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:t(()=>[l(" Export ")]),_:1}),r.$can("create","guarantor")?(i(),y(p,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"notification-notification_id-guarantor-add",params:{notification_id:n(x).params.notification_id}}},{default:t(()=>[l(" Ajouter ")]),_:1},8,["to"])):m("",!0),e(p,{loading:n(w)[3],disabled:n(w)[3],"prepend-icon":"tabler-refresh",onClick:o[1]||(o[1]=a=>{n(A)(),X(3)})},{loader:t(()=>[v("span",$e,[e(d,{icon:"tabler-refresh"})])]),default:t(()=>[l(" Recharger ")]),_:1},8,["loading","disabled"])])]),e(B,{class:"mt-4"}),e(n(re),{"items-per-page":n(T),"onUpdate:itemsPerPage":o[4]||(o[4]=a=>V(T)?T.value=a:null),page:n(u),"onUpdate:page":o[5]||(o[5]=a=>V(u)?u.value=a:null),headers:W,items:n(ee),"items-length":n(U),class:"text-no-wrap","onUpdate:options":Y},{"item.observations":t(({item:a})=>[e(Z,{density:"compact"},{default:t(()=>[(i(!0),b(M,null,O(a.observations,c=>(i(),y(k,null,{default:t(()=>[e(h,null,{default:t(()=>[e(H,{label:""},{default:t(()=>[l(E(c),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256)),a.observations.length==0?(i(),b(M,{key:0},O(["Dossier complet"],c=>e(k,null,{default:t(()=>[e(h,null,{default:t(()=>[e(H,{color:"success",label:""},{default:t(()=>[l(E(c),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),64)):m("",!0)]),_:2},1024)]),"item.actions":t(({item:a})=>[r.$can("read","guarantor")?(i(),y(s,{key:0,to:{name:"notification-notification_id-guarantor-id",params:{notification_id:n(x).params.notification_id,id:a.id}}},{default:t(()=>[e(d,{icon:"tabler-eye"})]),_:2},1032,["to"])):m("",!0),r.$can("update","guarantor")?(i(),y(s,{key:1,to:{name:"notification-notification_id-guarantor-edit-id",params:{notification_id:n(x).params.notification_id,id:a.id}}},{default:t(()=>[e(d,{icon:"tabler-edit"})]),_:2},1032,["to"])):m("",!0),r.$can("delete","guarantor")?(i(),y(s,{key:2,onClick:c=>{S.value=a.id,f.value=!0}},{default:t(()=>[e(d,{icon:"tabler-trash",color:"error"})]),_:2},1032,["onClick"])):m("",!0),e(p,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:t(()=>[e(d,{size:"24",icon:"tabler-dots-vertical"}),e(be,{activator:"parent"},{default:t(()=>[e(Z,null,{default:t(()=>[v("input",{ref_key:"refInputEl",ref:F,type:"file",name:"signed_notification",accept:".pdf,.png,.jpg",hidden:"",onInput:c=>te(a.id,c)},null,40,xe),r.$can("download","guarantor")?(i(),b("div",Ce,[e(k,{onClick:c=>{z(`/api/guarantor/promissory-note/download/${a.id}`,`Billet-à-ordre-Caution-${a.notification.verbal_trial.committee_id}.docx`)}},{prepend:t(()=>[e(d,{icon:"tabler-download"})]),default:t(()=>[e(h,null,{default:t(()=>[l("Télécharger Billet à ordre non signé")]),_:1})]),_:2},1032,["onClick"]),a.signed_promissory_note_path?(i(),y(k,{key:0,onClick:c=>z(a.signed_promissory_note_path,`Billet-à-ordre-Caution-${a.signed_promissory_note_path.split("/").slice(-1)[0]}`)},{prepend:t(()=>[e(d,{icon:"tabler-download"})]),default:t(()=>[e(h,null,{default:t(()=>[l("Télécharger Billet à ordre signé")]),_:1})]),_:2},1032,["onClick"])):m("",!0)])):m("",!0),r.$can("upload","guarantor")?(i(),b("div",we,[e(B),a.signed_promissory_note_path==null?(i(),y(k,{key:0,onClick:o[2]||(o[2]=c=>{var R;L.value="signed_promissory_note",(R=n(F))==null||R.click()})},{prepend:t(()=>[e(d,{icon:"tabler-cloud-upload"})]),default:t(()=>[e(h,null,{default:t(()=>[l("Ajouter billet à ordre signé")]),_:1})]),_:1})):m("",!0)])):m("",!0),e(B)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:t(()=>[e(B),v("div",Te,[v("p",Be,E(n(le)({page:n(u),itemsPerPage:n(T)},n(U))),1),e(ie,{modelValue:n(u),"onUpdate:modelValue":o[3]||(o[3]=a=>V(u)?u.value=a:null),length:n(j),"total-visible":r.$vuetify.display.xs?1:Math.min(n(j),5)},{prev:t(a=>[e(p,J({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[e(d,{start:"",icon:"tabler-arrow-left"}),l(" Précedent ")]),_:2},1040)]),next:t(a=>[e(p,J({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[l(" Suivant "),e(d,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(ge,{modelValue:n(f),"onUpdate:modelValue":o[9]||(o[9]=a=>V(f)?f.value=a:null),class:"v-dialog-sm"},{default:t(()=>[e(I,{onClick:o[6]||(o[6]=a=>f.value=!n(f))}),e(q,{title:"Suppression"},{default:t(()=>[e(K,null,{default:t(()=>[l(" Etes vous sûr de vouloir supprimer cette caution? ")]),_:1}),e(K,{class:"d-flex justify-end gap-3 flex-wrap"},{default:t(()=>[e(p,{color:"secondary",variant:"tonal",onClick:o[7]||(o[7]=a=>f.value=!1)},{default:t(()=>[l(" Annuler ")]),_:1}),e(p,{onClick:o[8]||(o[8]=a=>{ae(n(S)),f.value=!1})},{default:t(()=>[l(" Supprimer ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},rt=_e(De,[["__scopeId","data-v-cfed1982"]]);export{rt as default};
