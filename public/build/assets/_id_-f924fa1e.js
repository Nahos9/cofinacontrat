import{r as m}from"./validators-be8c4c00.js";import{r as f,ah as S,a1 as F,c as B,b as e,e as a,a2 as M,E as G,n as J,o as L,a3 as b,M as V,s as r,d as c,Z as T,x as O,C as P,D as Z,ai as z}from"./main-822cac03.js";import{_ as H}from"./AppTextarea-1bfcb04e.js";import{_ as K}from"./AppSelect-9eea07e3.js";import{_ as Q}from"./AppDateTimePicker-07d011a5.js";import{_ as W}from"./AppTextField-f2216bdc.js";import{_ as X}from"./AppAutocomplete-35c41de4.js";import{u as U}from"./useApi-dbfdbae2.js";import{c as C}from"./createUrl-aee5361a.js";import{$ as Y}from"./api-f041352e.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import{V as re}from"./VForm-f4fa28d8.js";import{V as te}from"./VSnackbar-4e86f0ba.js";import{V as k}from"./VRow-3e61a99c.js";import{V as d}from"./VCol-78b1b57e.js";import{V as ae}from"./VCard-fcaa82b6.js";import{V as le}from"./VCardText-61e00425.js";import"./VTextField-4e435eba.js";import"./VImg-3735f12f.js";import"./forwardRefs-6ea3df5c.js";import"./VSelect-cb288123.js";import"./VList-7b39dc2c.js";import"./VAvatar-a458b54c.js";import"./VDivider-e7100701.js";import"./VOverlay-9ecf3b81.js";import"./VMenu-68a89a7c.js";import"./filter-7793fd28.js";import"./index-9c720871.js";import"./useAbility-d0784979.js";const $=v=>(P("data-v-b5671719"),v=v(),Z(),v),se=$(()=>c("div",{class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},[c("div",{class:"d-flex flex-column justify-center"},[c("h4",{class:"text-h4 font-weight-medium"}," Mettre à jour un CAT ")])],-1)),oe={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},de=$(()=>c("div",{class:"d-flex flex-column justify-center"},null,-1)),ie={class:"d-flex gap-4 align-center flex-wrap"},ue={__name:"[id]",async setup(v){let _,g;const R=G(),y=J(),h=f(!1),q=f(""),x=f(),w=()=>({contract_id:"",credit_number:"",sector:"",first_deadline:"",last_deadline:"",source_of_reimbursement:"",instructions_from_the_risk_and_credit_department:"",outstanding_number_ready_to_settle:"",other_expenses:"",teg:""}),{data:A}=([_,g]=S(()=>U(C("/contract",{query:{paginate:0,with_verbal_trial:1,has_upload_completed:1,has_cat:0}}))),_=await _,g(),_),{data:N}=([_,g]=S(()=>U(C(`/cat/${y.params.id}`,{query:{with_verbal_trial:1}}))),_=await _,g(),_),j=()=>{var s;(s=x.value)==null||s.validate().then(async({valid:l})=>{if(l){const E={contract_id:t.value.contract_id,credit_number:t.value.credit_number,sector:t.value.sector,first_deadline:t.value.first_deadline,last_deadline:t.value.last_deadline,source_of_reimbursement:t.value.source_of_reimbursement,instructions_from_the_risk_and_credit_department:t.value.instructions_from_the_risk_and_credit_department,outstanding_number_ready_to_settle:t.value.outstanding_number_ready_to_settle,other_expenses:t.value.other_expenses,teg:t.value.teg},u=await Y(`cat/${y.params.id}`,{method:"PUT",body:E});if(i.value=w(),u.status==200)R.push("/cat");else if(u.status==403){h.value=!0,q.value="";for(const n in u.errors)u.errors[n].forEach(p=>{q.value+=p+`
`})}else for(const n in u.errors)u.errors[n].forEach(p=>{i.value[n]+=p+`
`});z(()=>{var n;(n=x.value)==null||n.resetValidation()})}})},i=f(w()),D=F(()=>A.value.data);var t=f(N.value.data.c_a_t);return A.value.data.push(JSON.parse(JSON.stringify(t.value.contract))),(s,l)=>{const E=X,u=W,n=Q,p=K,I=H;return L(),B("div",null,[se,e(re,{ref_key:"refForm",ref:x,onSubmit:M(j,["prevent"])},{default:a(()=>[e(k,null,{default:a(()=>[e(d,{cols:"11"},{default:a(()=>[e(b,{"prepend-icon":"tabler-arrow-left",to:{name:"cat"}},{default:a(()=>[V(" CATs ")]),_:1})]),_:1}),e(d,{cols:"1"},{default:a(()=>[e(b,{"prepend-icon":"tabler-eye",to:{name:"cat-id",params:{id:r(y).params.id}}},{default:a(()=>[V(" Voir ")]),_:1},8,["to"])]),_:1})]),_:1}),e(k,null,{default:a(()=>[e(d,{md:"12"},{default:a(()=>[e(ae,{class:"mb-6",title:"Information sur CAT"},{default:a(()=>[e(le,null,{default:a(()=>[e(k,null,{default:a(()=>[e(d,{cols:"12",md:"12",lg:"12"},{default:a(()=>[e(E,{modelValue:r(t).contract_id,"onUpdate:modelValue":l[0]||(l[0]=o=>r(t).contract_id=o),items:r(D),"error-messages":i.value.contract_id,label:"Contrat",placeholder:"Ex: CFNTG-044-13-12-23-01212",rules:["requiredValidator"in s?s.requiredValidator:r(m)],"item-title":"verbal_trial.label","item-value":"id"},null,8,["modelValue","items","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:a(()=>[e(u,{modelValue:r(t).credit_number,"onUpdate:modelValue":l[1]||(l[1]=o=>r(t).credit_number=o),"error-messages":i.value.credit_number,label:"Numéro du crédit",placeholder:"Ex: 485632",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:a(()=>[e(u,{modelValue:r(t).sector,"onUpdate:modelValue":l[2]||(l[2]=o=>r(t).sector=o),"error-messages":i.value.sector,label:"Secteur",placeholder:"Ex: Agriculture",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:a(()=>[e(n,{modelValue:r(t).first_deadline,"onUpdate:modelValue":l[3]||(l[3]=o=>r(t).first_deadline=o),"error-messages":i.value.first_deadline,label:"Date de première échéance",placeholder:"Ex: 2024-02-02",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:a(()=>[e(n,{modelValue:r(t).last_deadline,"onUpdate:modelValue":l[4]||(l[4]=o=>r(t).last_deadline=o),"error-messages":i.value.last_deadline,label:"Date de dernière échéance",placeholder:"Ex: 2024-02-02",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:a(()=>[e(p,{modelValue:r(t).source_of_reimbursement,"onUpdate:modelValue":l[5]||(l[5]=o=>r(t).source_of_reimbursement=o),items:[{value:"revenue_from_the_activity",title:"Recettes de l’activité"},{value:"final_payer_settlement",title:"Règlement du payeur final"},{value:"resale_of_goods",title:"Reventes des marchandises"}],"error-messages":i.value.source_of_reimbursement,label:"Source du remboursement",placeholder:"Ex: Recettes de l’activité",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:a(()=>[e(u,{modelValue:r(t).outstanding_number_ready_to_settle,"onUpdate:modelValue":l[6]||(l[6]=o=>r(t).outstanding_number_ready_to_settle=o),"error-messages":i.value.outstanding_number_ready_to_settle,label:"Numéro encours prêt à solder",placeholder:"Ex: ",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:a(()=>[e(u,{modelValue:r(t).other_expenses,"onUpdate:modelValue":l[7]||(l[7]=o=>r(t).other_expenses=o),"error-messages":i.value.other_expenses,label:"Autres frais",placeholder:"Ex: ",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:a(()=>[e(u,{modelValue:r(t).teg,"onUpdate:modelValue":l[8]||(l[8]=o=>r(t).teg=o),"error-messages":i.value.teg,label:"TEG",placeholder:"Ex: 15000600",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"12",lg:"12"},{default:a(()=>[e(I,{modelValue:r(t).instructions_from_the_risk_and_credit_department,"onUpdate:modelValue":l[9]||(l[9]=o=>r(t).instructions_from_the_risk_and_credit_department=o),"error-messages":i.value.instructions_from_the_risk_and_credit_department,label:"Instructions du département risque et crédit",placeholder:"Ex: ",rules:["requiredValidator"in s?s.requiredValidator:r(m)],clearable:"",counter:""},null,8,["modelValue","error-messages","rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{cols:"12"},{default:a(()=>[c("div",oe,[de,c("div",ie,[e(b,{type:"reset",variant:"tonal",color:"primary"},{default:a(()=>[e(T,{start:"",icon:"tabler-circle-minus"}),V(" Effacer ")]),_:1}),e(b,{type:"submit",class:"me-3"},{default:a(()=>[V(" Enregistrer "),e(T,{end:"",icon:"tabler-checkbox"})]),_:1})])])]),_:1})]),_:1})]),_:1},512),e(te,{modelValue:h.value,"onUpdate:modelValue":l[10]||(l[10]=o=>h.value=o),transition:"scroll-y-reverse-transition",location:"bottom end",color:"error"},{default:a(()=>[V(O(q.value),1)]),_:1},8,["modelValue"])])}}},Be=ee(ue,[["__scopeId","data-v-b5671719"]]);export{Be as default};
