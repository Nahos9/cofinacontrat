import{E as me,r,ah as X,a1 as N,o as s,c as h,b as e,e as a,s as l,$ as V,a as ve,aT as fe,d as f,a3 as g,M as n,f as p,N as d,Z as m,x as b,v as _e,aa as Z,B as Ve,z as G,C as ye,D as ge}from"./main-224c26e2.js";import{_ as be}from"./AppTextarea-b3184ca2.js";import{_ as ke}from"./DialogCloseBtn-8e0113e4.js";import{_ as he}from"./AppTextField-c43e7f3c.js";import{V as we,p as $e,a as Ce}from"./paginationMeta-07f697b7.js";import{_ as xe}from"./AppAutocomplete-4fd09899.js";import{J as Pe}from"./js-file-downloader-5d1fe9aa.js";import{$ as K}from"./api-025774a6.js";import{u as W}from"./useApi-8aa31e4b.js";import{c as Y}from"./createUrl-9e31b0a4.js";import{_ as Te}from"./_plugin-vue_export-helper-c27b6911.js";import{V as J}from"./VCard-128eca41.js";import{V as De}from"./VDialog-58d76181.js";import{V as $}from"./VCardText-76ac8f5d.js";import{V as ee}from"./VRow-931a5d53.js";import{V as te}from"./VCol-b6323a69.js";import{V as je,a as Se}from"./VSelect-7273c665.js";import{V as w}from"./VDivider-903c30f9.js";import{V as Re}from"./VSpacer-12421fd2.js";import{V as y}from"./VTooltip-128e35fe.js";import"./VTextField-5847b58e.js";import"./VImg-ee986579.js";import"./forwardRefs-6ea3df5c.js";import"./VTable-b65d1b91.js";import"./filter-dfda6de8.js";import"./VList-9fcafd51.js";import"./VAvatar-357ae3be.js";import"./VMenu-eab44f87.js";import"./VOverlay-2c72c002.js";import"./index-9c720871.js";import"./useAbility-bb61d04e.js";const Ae=C=>(ye("data-v-0511f335"),C=C(),ge(),C),Be=Ae(()=>f("h2",null," Liste des Procès verbaux sans contrat ",-1)),Ee={class:"d-flex flex-wrap gap-4 mx-5"},Ue={class:"d-flex align-center"},Ie={class:"d-flex gap-4 flex-wrap align-center"},Ne={class:"custom-loader"},ze={key:0},Me={key:1},Fe={key:0},qe={key:2},Le={key:0,class:"full-width-icon",col:"12"},Je={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},He={class:"text-sm text-medium-emphasis mb-0"},Oe={__name:"without-notification",async setup(C){let _,x;me();const P=r(),T=r(),D=r(""),j=r([]),S=r(8),v=r(1),R=r(0),u=r(!1),A=r(""),B=r(""),E=r(""),U=r(),k=r(""),I=r(!1),z=r("waiting"),ae=[{title:"Numéro comitée",key:"committee_id"},{title:"client",key:"applicant_full_name"},{title:"Type Credit",key:"type_of_credit.full_name"},{title:"Montant",key:"amount_fr"},{title:"Statut",key:"status"},{title:"Actions",key:"actions",sortable:!1}],{data:M,execute:F}=([_,x]=X(()=>W(Y("/verbal-trial",{query:{search:D,type_of_credit_id:P,status:T,page:v,has_notification:0,has_mortgage:1,with_caf:1,with_type_of_credit:1}}))),_=await _,x(),_),{data:le}=([_,x]=X(()=>W(Y("/type-of-credit",{query:{paginate:0}}))),_=await _,x(),_),oe=o=>{j.value[o]=!0,setTimeout(()=>{j.value[o]=!1},1e3)},ie=o=>{v.value=o.page},ne=async(o,i)=>{const q=Z("userToken").value;try{new Pe({url:o,headers:[{name:"Authorization",value:`Bearer ${q}`},{name:"Accept",value:"application/json"}],nameCallback:function(c){return i}})}catch(c){console.error("Erreur lors du téléchargement:",c)}},se=async o=>{await K(`verbal-trial/${o}`,{method:"DELETE"}),k.value="",F()},H=async o=>{await K(`verbal-trial/change-status/${o}`,{method:"PUT",body:{status:z.value,comment:k.value}}),k.value="",F()},re=N(()=>M.value.data),O=N(()=>M.value.total),Q=N(()=>M.value.last_page),de=N(()=>le.value.data);return(o,i)=>{const q=he,c=ve("IconBtn"),ue=ke,ce=be,pe=fe("tooltip");return s(),h("div",null,[e(J,{class:"mb-6"},{default:a(()=>[e($,null,{default:a(()=>[e(ee,null,{default:a(()=>[e($,null,{default:a(()=>[Be]),_:1})]),_:1})]),_:1})]),_:1}),e(J,{title:"Filtres",class:"mb-6"},{default:a(()=>[e($,null,{default:a(()=>[e(ee,null,{default:a(()=>[e(te,{cols:"12",sm:"4"},{default:a(()=>[e(xe,{modelValue:l(P),"onUpdate:modelValue":i[0]||(i[0]=t=>V(P)?P.value=t:null),placeholder:"Type de crédit","item-title":"full_name","item-value":"id",items:l(de),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(te,{cols:"12",sm:"4"},{default:a(()=>[e(je,{modelValue:l(T),"onUpdate:modelValue":i[1]||(i[1]=t=>V(T)?T.value=t:null),placeholder:"Statut",items:[{value:"v",title:"Validé"},{value:"w",title:"En attente"},{value:"r",title:"Rejeté"}],"clear-icon":"tabler-x",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(w,{class:"my-4"}),f("div",Ee,[f("div",Ue,[e(q,{modelValue:l(D),"onUpdate:modelValue":i[2]||(i[2]=t=>V(D)?D.value=t:null),placeholder:"Rechercher un pv",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(Re),f("div",Ie,[e(g,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:a(()=>[n(" Export ")]),_:1}),o.$can("create","pv")?(s(),p(g,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"pv-add"}},{default:a(()=>[n(" Ajouter ")]),_:1})):d("",!0),e(g,{loading:l(j)[3],disabled:l(j)[3],"prepend-icon":"tabler-refresh",onClick:i[3]||(i[3]=t=>{l(F)(),oe(3)})},{loader:a(()=>[f("span",Ne,[e(m,{icon:"tabler-refresh"})])]),default:a(()=>[n(" Recharger ")]),_:1},8,["loading","disabled"])])]),e(w,{class:"mt-4"}),e(l(we),{"items-per-page":l(S),"onUpdate:itemsPerPage":i[5]||(i[5]=t=>V(S)?S.value=t:null),page:l(v),"onUpdate:page":i[6]||(i[6]=t=>V(v)?v.value=t:null),headers:ae,items:l(re),"items-length":l(O),class:"text-no-wrap","onUpdate:options":ie},{"item.duration":a(({item:t})=>[n(b(t.duration)+" mois ",1)]),"item.status":a(({item:t})=>[e(Se,{label:"",color:{validated:"success",rejected:"error",waiting:"warning"}[t.status]},{default:a(()=>[t.comment?(s(),p(y,{key:0,activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[n("Raison: "+b(t.comment),1)]),_:2},1024)):d("",!0),n(" "+b({validated:"Validé",waiting:"En attente",rejected:"Rejeté"}[t.status])+" ("+b({dex:"DEX",head_credit:"Head Crédit",md:"MD"}[t.validation_level])+") ",1)]),_:2},1032,["color"])]),"item.actions":a(({item:t})=>[f("div",null,[o.$can("read","pv")||o.$can("historical","pv")?(s(),p(c,{key:0,to:{name:"pv-id",params:{id:t.id}}},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[n("Details")]),_:1}),e(m,{icon:" tabler-eye"})]),_:2},1032,["to"])):d("",!0),o.$can("download","pv")?(s(),p(c,{key:1,onClick:L=>ne(`/api/verbal-trial/download/${t.id}`,`PV-${t.committee_id}.docx`)},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[n("Télécharger")]),_:1}),_e(e(m,{icon:"tabler-download"},null,512),[[pe,"Ceci est une icône"]])]),_:2},1032,["onClick"])):d("",!0)]),o.$can("update","pv")||o.$can("delete","pv")?(s(),h("div",ze,[e(w),o.$can("update","pv")?(s(),p(c,{key:0,to:{name:"pv-edit-id",params:{id:t.id}},disabled:t.status=="validated"},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[n("Modifier")]),_:1}),e(m,{icon:"tabler-edit"})]),_:2},1032,["to","disabled"])):d("",!0),o.$can("delete","pv")?(s(),p(c,{key:1,disabled:t.status=="validated",onClick:L=>{R.value=t.id,A.value="Supprimer le PV",B.value="Voulez vous vraiment supprimer ce pv?",U.value=se,E.value="Supprimer",I.value=!1,u.value=!0}},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[n("Supprimer")]),_:1}),e(m,{icon:"tabler-trash",color:"error"})]),_:2},1032,["disabled","onClick"])):d("",!0)])):d("",!0),(o.$can("reject","pv")||o.$can("validate","pv"))&&("useCookie"in o?o.useCookie:l(Z))("userData").value.role==t.validation_level?(s(),h("div",Me,[e(w),f("span",{class:Ve(t.status=="validated"?"full-width-icon":"")},[o.$can("reject","pv")&&t.status!="rejected"?(s(),p(c,{key:0,onClick:L=>{R.value=t.id,A.value="Rejeter le PV",B.value="Voulez vous vraiment rejeter ce PV?",U.value=H,E.value="Rejeter",I.value=!0,z.value="rejected",u.value=!0}},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[n("Rejeter")]),_:1}),e(m,{icon:"tabler-x",color:"error"})]),_:2},1032,["onClick"])):d("",!0)],2),t.status=="waiting"?(s(),h("span",Fe,[o.$can("validate","pv")?(s(),p(c,{key:0,onClick:L=>{R.value=t.id,A.value="Valider le PV",B.value="Voulez vous vraiment valider ce PV?",U.value=H,E.value="Valider",I.value=!1,z.value="validated",u.value=!0}},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[n("Valider")]),_:1}),e(m,{icon:"tabler-check",color:"success"})]),_:2},1032,["onClick"])):d("",!0)])):d("",!0)])):d("",!0),o.$can("create","notification")&&t.status=="validated"?(s(),h("div",qe,[e(w),t.status=="validated"?(s(),h("span",Le,[o.$can("create","notification")?(s(),p(c,{key:0,to:{name:"notification-add",query:{id:t.id}}},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[n("Créer le contrat")]),_:1}),e(m,{icon:"tabler-file-plus",color:"success"})]),_:2},1032,["to"])):d("",!0)])):d("",!0)])):d("",!0)]),bottom:a(()=>[e(w),f("div",Je,[f("p",He,b(l($e)({page:l(v),itemsPerPage:l(S)},l(O))),1),e(Ce,{modelValue:l(v),"onUpdate:modelValue":i[4]||(i[4]=t=>V(v)?v.value=t:null),length:l(Q),"total-visible":o.$vuetify.display.xs?1:Math.min(l(Q),5)},{prev:a(t=>[e(g,G({variant:"tonal",color:"default"},t,{icon:!1}),{default:a(()=>[e(m,{start:"",icon:"tabler-arrow-left"}),n(" Précedent ")]),_:2},1040)]),next:a(t=>[e(g,G({variant:"tonal",color:"default"},t,{icon:!1}),{default:a(()=>[n(" Suivant "),e(m,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(De,{modelValue:l(u),"onUpdate:modelValue":i[11]||(i[11]=t=>V(u)?u.value=t:null),class:"v-dialog-sm"},{default:a(()=>[e(ue,{onClick:i[7]||(i[7]=t=>u.value=!l(u))}),e(J,{title:l(A)},{default:a(()=>[e($,null,{default:a(()=>[n(b(l(B))+" ",1),l(I)?(s(),p(ce,{key:0,class:"mt-3",modelValue:l(k),"onUpdate:modelValue":i[8]||(i[8]=t=>V(k)?k.value=t:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):d("",!0)]),_:1}),e($,{class:"d-flex justify-end gap-3 flex-wrap"},{default:a(()=>[e(g,{color:"secondary",variant:"tonal",onClick:i[9]||(i[9]=t=>u.value=!1)},{default:a(()=>[n(" Annuler ")]),_:1}),e(g,{onClick:i[10]||(i[10]=t=>{l(U)(l(R)),u.value=!1})},{default:a(()=>[n(b(l(E)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}},$t=Te(Oe,[["__scopeId","data-v-0511f335"]]);export{$t as default};
