import{_ as Y}from"./DialogCloseBtn-0c389e41.js";import{_ as ee}from"./AppTextField-cfb27a57.js";import{_ as te}from"./AppSelect-bd457cdc.js";import{V as ae,p as oe,a as le}from"./VPagination-3b0f2202.js";import{J as re}from"./js-file-downloader-1d0cf0cf.js";import{$ as ne}from"./api-6638b469.js";import{u as se}from"./useApi-7dd63682.js";import{c as ie}from"./createUrl-f896560b.js";import{r as u,ah as ce,a1 as B,c as F,b as e,e as t,s as l,$ as v,a as de,o as g,d as m,a3 as c,M as n,f as $,N as y,Z as i,x as I,z as j,aa as R,C as pe,D as ue}from"./main-e84ce0a6.js";import{_ as me}from"./_plugin-vue_export-helper-c27b6911.js";import{V as U}from"./VCard-fe1def77.js";import{V as _e}from"./VDialog-1430f233.js";import{V as b}from"./VCardText-c43c5a35.js";import{V as M}from"./VRow-d22e34f5.js";import{V as fe}from"./VCol-a817eccc.js";import{V as T}from"./VDivider-a6507b5e.js";import{V as ve}from"./VSpacer-8dff40aa.js";import{V as ge}from"./VTooltip-4dcea8b6.js";import{V as ye}from"./VMenu-4db2c15b.js";import{V as be,a as A,b as D}from"./VList-31615f1a.js";import{V as Ve}from"./VBadge-7cb2b529.js";import"./VTextField-bed2e038.js";import"./VImg-291e1ee2.js";import"./forwardRefs-6ea3df5c.js";import"./VSelect-0f27dc1c.js";import"./VOverlay-3c60a455.js";import"./VAvatar-b9338bff.js";import"./VTable-312eb4bc.js";import"./filter-7bde97a1.js";import"./index-9c720871.js";import"./useAbility-d056d777.js";const he=V=>(pe("data-v-29600ab8"),V=V(),ue(),V),we=he(()=>m("h2",null,"Liste des contrats en attente de CAT",-1)),ke={class:"d-flex flex-wrap gap-4 mx-5"},Ce={class:"d-flex align-center"},xe={class:"d-flex gap-4 flex-wrap align-center"},$e={class:"custom-loader"},Te={key:2},Ae={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},De={class:"text-sm text-medium-emphasis mb-0"},Pe={__name:"historical",async setup(V){let h,L;const d=u(!1),J=u(0),w=u(),k=u(""),O=[{title:"Numéro comitée",key:"verbal_trial.committee_id"},{title:"Admin Crédit",key:"creator.full_name"},{title:"Nom client",key:"verbal_trial.applicant_full_name"},{title:"Type de contrat",key:"type"},{title:"Montant",key:"verbal_trial.amount"},{title:"Actions",key:"actions",sortable:!1}],C=u([]),q=r=>{C.value[r]=!0,setTimeout(()=>{C.value[r]=!1},1e3)},x=u(8),s=u(1),Q=r=>{s.value=r.page},{data:P,execute:E}=([h,L]=ce(()=>se(ie("/contract",{query:{search:k,type:w,page:s,with_type_of_credit:1,with_company:1,with_individual_business:1,with_creator:1,has_upload_completed:1,has_cat:1,status:"v"}}))),h=await h,L(),h),Z=B(()=>P.value.data),N=B(()=>P.value.total),z=B(()=>P.value.last_page),G={company:"Société",individual_business:"Entreprise Individuel",particular:"Particulier"},H=async(r,o)=>{try{new re({url:r,headers:[{name:"Authorization",value:`Bearer ${R("userToken").value}`},{name:"Accept",value:"application/json"}],nameCallback:function(_){return o}}),E()}catch(_){console.error("Erreur lors du téléchargement:",_)}},K=async r=>{const o=`/api/contract/download/${r}`,_=`contracts-${r}.zip`;try{const f=await fetch(o,{headers:{Authorization:`Bearer ${R("userToken").value}`,Accept:"application/json"}});if(!f.ok)throw new Error("Erreur lors du téléchargement du fichier");const S=await f.blob(),p=document.createElement("a");p.href=URL.createObjectURL(S),p.download=_,document.body.appendChild(p),p.click(),document.body.removeChild(p)}catch(f){console.error("Erreur lors du téléchargement:",f)}},W=async r=>{await ne(`contract/${r}`,{method:"DELETE"}),E()};return(r,o)=>{const _=te,f=ee,S=de("IconBtn"),p=Y;return g(),F("div",null,[e(U,{class:"mb-6"},{default:t(()=>[e(b,null,{default:t(()=>[e(M,null,{default:t(()=>[e(b,null,{default:t(()=>[we]),_:1})]),_:1})]),_:1})]),_:1}),e(U,{title:"Filtres",class:"mb-6"},{default:t(()=>[e(b,null,{default:t(()=>[e(M,null,{default:t(()=>[e(fe,{cols:"12",sm:"4"},{default:t(()=>[e(_,{modelValue:l(w),"onUpdate:modelValue":o[0]||(o[0]=a=>v(w)?w.value=a:null),placeholder:"Type de contrat",items:[{value:"company",title:"Société"},{value:"particular",title:"Particulier"},{value:"individual_business",title:"Entreprise Individuel"}],clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(T,{class:"my-4"}),m("div",ke,[m("div",Ce,[e(f,{modelValue:l(k),"onUpdate:modelValue":o[1]||(o[1]=a=>v(k)?k.value=a:null),placeholder:"Rechercher un contrat",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(ve),m("div",xe,[e(c,{variant:"tonal",color:"secondary","prepend-icon":"tabler-download"},{default:t(()=>[n(" Export ")]),_:1}),r.$can("create","contract")?(g(),$(c,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"contract-add"}},{default:t(()=>[n(" Ajouter ")]),_:1})):y("",!0),e(c,{loading:l(C)[3],disabled:l(C)[3],"prepend-icon":"tabler-refresh",onClick:o[2]||(o[2]=a=>{l(E)(),q(3)})},{loader:t(()=>[m("span",$e,[e(i,{icon:"tabler-refresh"})])]),default:t(()=>[n(" Recharger ")]),_:1},8,["loading","disabled"])])]),e(T,{class:"mt-4"}),e(l(ae),{"items-per-page":l(x),"onUpdate:itemsPerPage":o[4]||(o[4]=a=>v(x)?x.value=a:null),page:l(s),"onUpdate:page":o[5]||(o[5]=a=>v(s)?s.value=a:null),headers:O,items:l(Z),"items-length":l(N),class:"text-no-wrap","onUpdate:options":Q},{"item.type":t(({item:a})=>[n(I(G[a.type]),1)]),"item.verbal_trial.amount":t(({item:a})=>[n(I(String(a.verbal_trial.amount).replace(/\B(?=(\d{3})+(?!\d))/g," "))+" F CFA ",1)]),"item.actions":t(({item:a})=>[e(S,{to:{name:"contract-id",params:{id:a.id}}},{default:t(()=>[e(ge,{activator:"parent",transition:"scroll-x-transition",location:"top"},{default:t(()=>[n("Details")]),_:1}),e(i,{icon:"tabler-eye"})]),_:2},1032,["to"]),e(c,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:t(()=>[e(i,{size:"24",icon:"tabler-dots-vertical"}),e(ye,{activator:"parent"},{default:t(()=>[e(be,null,{default:t(()=>[r.$can("read","guarantor")?(g(),$(Ve,{key:0,inline:"",content:a.guarantors_count},{default:t(()=>[e(A,{to:{name:"contract-contract_id-guarantor",params:{contract_id:a.id}}},{prepend:t(()=>[e(i,{icon:"tabler-users"})]),default:t(()=>[e(D,null,{default:t(()=>[n(" Voir les Cautions ")]),_:1})]),_:2},1032,["to"])]),_:2},1032,["content"])):y("",!0),r.$can("read","pv")?(g(),$(A,{key:1,to:{name:"pv-id",params:{id:a.verbal_trial.id}}},{prepend:t(()=>[e(i,{icon:"tabler-eye"})]),default:t(()=>[e(D,null,{default:t(()=>[n("Voir le Pv")]),_:1})]),_:2},1032,["to"])):y("",!0),r.$can("download","contract")?(g(),F("div",Te,[e(T),e(A,{onClick:X=>K(a.id)},{prepend:t(()=>[e(i,{icon:"tabler-download"})]),default:t(()=>[e(D,null,{default:t(()=>[n("Télécharger Contrat non-signé")]),_:1})]),_:2},1032,["onClick"]),a.signed_contract_path?(g(),$(A,{key:0,onClick:X=>H(a.signed_contract_path,`Contrat-${a.signed_contract_path.split("/").slice(-1)[0]}`)},{prepend:t(()=>[e(i,{icon:"tabler-download"})]),default:t(()=>[e(D,null,{default:t(()=>[n("Télécharger Contrat signé")]),_:1})]),_:2},1032,["onClick"])):y("",!0)])):y("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:t(()=>[e(T),m("div",Ae,[m("p",De,I(l(oe)({page:l(s),itemsPerPage:l(x)},l(N))),1),e(le,{modelValue:l(s),"onUpdate:modelValue":o[3]||(o[3]=a=>v(s)?s.value=a:null),length:l(z),"total-visible":r.$vuetify.display.xs?1:Math.min(l(z),5)},{prev:t(a=>[e(c,j({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[e(i,{start:"",icon:"tabler-arrow-left"}),n(" Précedent ")]),_:2},1040)]),next:t(a=>[e(c,j({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[n(" Suivant "),e(i,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(_e,{modelValue:l(d),"onUpdate:modelValue":o[9]||(o[9]=a=>v(d)?d.value=a:null),class:"v-dialog-sm"},{default:t(()=>[e(p,{onClick:o[6]||(o[6]=a=>d.value=!l(d))}),e(U,{title:"Suppression"},{default:t(()=>[e(b,null,{default:t(()=>[n(" Etes vous sûr de vouloir supprimer ce contrat? ")]),_:1}),e(b,{class:"d-flex justify-end gap-3 flex-wrap"},{default:t(()=>[e(c,{color:"secondary",variant:"tonal",onClick:o[7]||(o[7]=a=>d.value=!1)},{default:t(()=>[n(" Annuler ")]),_:1}),e(c,{onClick:o[8]||(o[8]=a=>{W(l(J)),d.value=!1})},{default:t(()=>[n(" Supprimer ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},it=me(Pe,[["__scopeId","data-v-29600ab8"]]);export{it as default};
