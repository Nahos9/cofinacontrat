import{r as _,e as q}from"./validators-be8c4c00.js";import{r as m,n as B,E as I,o as L,f as T,e as o,b as s,d as n,s as a,_ as h,M as c,x as R,a2 as D,a3 as N,aa as f,aj as S}from"./main-775cdf0e.js";import{_ as j}from"./AppTextField-dcc306b1.js";import{u as b,m as A,a as F}from"./misc-mask-light-63589219.js";import{V as M}from"./VNodeRenderer-7fc8a6c2.js";import{u as $}from"./useAbility-1db88a2b.js";import{$ as E}from"./api-81ecf0de.js";import{V as v}from"./VRow-96f26337.js";import{V as P}from"./VImg-1cbae8ee.js";import{V as p}from"./VCol-0f5eaa65.js";import{V as z}from"./VCard-f8b4f0b6.js";import{V as y}from"./VCardText-183f2498.js";import{V as U}from"./VForm-d6ed9dce.js";import"./VTextField-985e58a1.js";import"./forwardRefs-6ea3df5c.js";import"./index-9c720871.js";import"./VAvatar-9b1b0588.js";const G="/build/assets/auth-v2-login-illustration-bordered-dark-a595a9b7.png",O="/build/assets/auth-v2-login-illustration-bordered-light-47ee3625.png",H="/build/assets/auth-v2-login-illustration-dark-0878e8b9.png",J="/build/assets/auth-v2-login-illustration-light-d1fd488d.png",K="/build/assets/img_accueil-4a4cbbcf.png";const Q={class:"position-relative bg-background rounded-lg w-100 ma-8 me-0"},W={class:"d-flex align-center justify-center w-100 h-100"},X={class:"text-h4 mb-1"},Y={class:"text-capitalize"},Z=n("p",{class:"mb-0"},"Veuillez vous connecter",-1),he={__name:"login",setup(ee){b(J,H,O,G,!0),b(F,A);const u=m(!1),g=B(),w=I(),k=$(),l=m({email:void 0,password:void 0}),V=m(),i=m({email:"",password:""}),x=async()=>{try{const e=await E("/auth/login",{method:"POST",body:{email:i.value.email,password:i.value.password},onResponseError({response:t}){l.value=t._data.errors}});if(l.value.email=void 0,l.value.password=void 0,e.status==200){const{userToken:t,user:r}=e.data;f("userAbilityRules").value=r.ability_rules,k.update(r.ability_rules),f("userData").value={id:r.id,fullName:r.full_name,username:r.name,avatar:"/images/avatars/avatar-1.png",signatory:r.signatory_path?"http://credit.cofina.localhost"+r.signatory_path:"/images/avatars/avatar-14.png",email:r.email,role:r.profile,role_fr:r.profile_fr},f("userToken").value=t,await S(()=>{w.replace(g.query.to?String(g.query.to):"/")})}else e.status==400&&(e.errors.email&&(l.value.email=e.errors.email[0]),e.errors.password&&(l.value.password=e.errors.password[0]))}catch(e){console.error(e)}},C=()=>{var e;(e=V.value)==null||e.validate().then(({valid:t})=>{t&&x()})};return(e,t)=>{const r=j;return L(),T(v,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:o(()=>[s(p,{lg:"8",class:"d-none d-lg-flex"},{default:o(()=>[n("div",Q,[n("div",W,[s(P,{src:a(K),class:"auth-illustration w-100 h-100",cover:""},null,8,["src"])])])]),_:1}),s(p,{cols:"12",lg:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:o(()=>[s(z,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:o(()=>[s(y,null,{default:o(()=>[s(a(M),{nodes:a(h).app.logo,class:"mb-6"},null,8,["nodes"]),n("h4",X,[c(" Bienvenue sur "),n("span",Y,R(a(h).app.title),1),c("! 👋🏻 ")]),Z]),_:1}),s(y,null,{default:o(()=>[s(a(U),{ref_key:"refVForm",ref:V,onSubmit:D(C,["prevent"])},{default:o(()=>[s(v,null,{default:o(()=>[s(p,{cols:"12"},{default:o(()=>[s(r,{modelValue:a(i).email,"onUpdate:modelValue":t[0]||(t[0]=d=>a(i).email=d),label:"Email",placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in e?e.requiredValidator:a(_),"emailValidator"in e?e.emailValidator:a(q)],"error-messages":a(l).email},null,8,["modelValue","rules","error-messages"])]),_:1}),s(p,{cols:"12"},{default:o(()=>[s(r,{modelValue:a(i).password,"onUpdate:modelValue":t[1]||(t[1]=d=>a(i).password=d),label:"Password",placeholder:"············",rules:["requiredValidator"in e?e.requiredValidator:a(_)],type:a(u)?"text":"password","error-messages":a(l).password,"append-inner-icon":a(u)?"tabler-eye-off":"tabler-eye","onClick:appendInner":t[2]||(t[2]=d=>u.value=!a(u)),class:"mb-8"},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),s(N,{block:"",type:"submit"},{default:o(()=>[c(" Connexion ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{he as default};
