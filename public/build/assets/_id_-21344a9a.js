import{r as m}from"./validators-be8c4c00.js";import{r as f,ah as S,a1 as F,c as B,b as e,e as t,a2 as M,E as G,n as J,o as L,a3 as b,M as V,s as r,d as c,Z as T,x as O,C as P,D as Z,ai as z}from"./main-a1bb8d1c.js";import{_ as H}from"./AppTextarea-6d6d429f.js";import{_ as K}from"./AppSelect-ec953df4.js";import{_ as Q}from"./AppDateTimePicker-127836d3.js";import{_ as W}from"./AppTextField-6136aa1e.js";import{_ as X}from"./AppAutocomplete-5e56137d.js";import{u as U}from"./useApi-ee532938.js";import{c as C}from"./createUrl-82711664.js";import{$ as Y}from"./api-0fd30a7b.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import{V as re}from"./VForm-0ba8db0b.js";import{V as ae}from"./VSnackbar-e984fa23.js";import{V as k}from"./VRow-4fd62cc5.js";import{V as d}from"./VCol-c9fbba03.js";import{V as te}from"./VCard-0a0db0fa.js";import{V as le}from"./VCardText-ec067fb4.js";import"./VTextField-251e47e8.js";import"./VImg-c3c51305.js";import"./forwardRefs-6ea3df5c.js";import"./VSelect-00885f47.js";import"./VList-63aa9283.js";import"./VAvatar-28a02eb0.js";import"./VDivider-bdae5753.js";import"./VOverlay-5a96f554.js";import"./VMenu-e4df9f05.js";import"./filter-22cdad36.js";import"./index-9c720871.js";import"./useAbility-c9217b08.js";const $=v=>(P("data-v-fa6b93f7"),v=v(),Z(),v),se=$(()=>c("div",{class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},[c("div",{class:"d-flex flex-column justify-center"},[c("h4",{class:"text-h4 font-weight-medium"}," Mettre à jour un CAT ")])],-1)),oe={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},de=$(()=>c("div",{class:"d-flex flex-column justify-center"},null,-1)),ie={class:"d-flex gap-4 align-center flex-wrap"},ue={__name:"[id]",async setup(v){let _,g;const R=G(),y=J(),h=f(!1),q=f(""),x=f(),w=()=>({contract_id:"",credit_number:"",sector:"",first_deadline:"",last_deadline:"",source_of_reimbursement:"",instructions_from_the_risk_and_credit_department:"",outstanding_number_ready_to_settle:"",other_expenses:"",teg:""}),{data:A}=([_,g]=S(()=>U(C("/contract",{query:{paginate:0,with_verbal_trial:1,has_upload_completed:1,has_cat:0}}))),_=await _,g(),_),{data:N}=([_,g]=S(()=>U(C(`/cat/${y.params.id}`,{query:{with_verbal_trial:1}}))),_=await _,g(),_),j=()=>{var s;(s=x.value)==null||s.validate().then(async({valid:l})=>{if(l){const E={contract_id:a.value.contract_id,credit_number:a.value.credit_number,sector:a.value.sector,first_deadline:a.value.first_deadline,last_deadline:a.value.last_deadline,source_of_reimbursement:a.value.source_of_reimbursement,instructions_from_the_risk_and_credit_department:a.value.instructions_from_the_risk_and_credit_department,outstanding_number_ready_to_settle:a.value.outstanding_number_ready_to_settle,other_expenses:a.value.other_expenses,teg:a.value.teg},u=await Y(`cat/${y.params.id}`,{method:"PUT",body:E});if(i.value=w(),u.status==200)R.push("/cat");else if(u.status==403){h.value=!0,q.value="";for(const n in u.errors)u.errors[n].forEach(p=>{q.value+=p+`
`})}else for(const n in u.errors)u.errors[n].forEach(p=>{i.value[n]+=p+`
`});z(()=>{var n;(n=x.value)==null||n.resetValidation()})}})},i=f(w()),D=F(()=>A.value.data);var a=f(N.value.data.c_a_t);return A.value.data.push(JSON.parse(JSON.stringify(a.value.contract))),(s,l)=>{const E=X,u=W,n=Q,p=K,I=H;return L(),B("div",null,[se,e(re,{ref_key:"refForm",ref:x,onSubmit:M(j,["prevent"])},{default:t(()=>[e(k,null,{default:t(()=>[e(d,{cols:"11"},{default:t(()=>[e(b,{"prepend-icon":"tabler-arrow-left",to:{name:"cat"}},{default:t(()=>[V(" CATs ")]),_:1})]),_:1}),e(d,{cols:"1"},{default:t(()=>[e(b,{"prepend-icon":"tabler-eye",to:{name:"cat-id",params:{id:r(y).params.id}}},{default:t(()=>[V(" Voir ")]),_:1},8,["to"])]),_:1})]),_:1}),e(k,null,{default:t(()=>[e(d,{md:"12"},{default:t(()=>[e(te,{class:"mb-6",title:"Information sur CAT"},{default:t(()=>[e(le,null,{default:t(()=>[e(k,null,{default:t(()=>[e(d,{cols:"12",md:"12",lg:"12"},{default:t(()=>[e(E,{modelValue:r(a).contract_id,"onUpdate:modelValue":l[0]||(l[0]=o=>r(a).contract_id=o),items:r(D),"error-messages":i.value.contract_id,label:"Contrat",placeholder:"Ex: CFNTG-044-13-12-23-01212",rules:["requiredValidator"in s?s.requiredValidator:r(m)],"item-title":"verbal_trial.label","item-value":"id"},null,8,["modelValue","items","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(u,{modelValue:r(a).credit_number,"onUpdate:modelValue":l[1]||(l[1]=o=>r(a).credit_number=o),"error-messages":i.value.credit_number,label:"Numéro du crédit",placeholder:"Ex: 485632",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(u,{modelValue:r(a).sector,"onUpdate:modelValue":l[2]||(l[2]=o=>r(a).sector=o),"error-messages":i.value.sector,label:"Secteur",placeholder:"Ex: Agriculture",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(n,{modelValue:r(a).first_deadline,"onUpdate:modelValue":l[3]||(l[3]=o=>r(a).first_deadline=o),"error-messages":i.value.first_deadline,label:"Date de première échéance",placeholder:"Ex: 2024-02-02",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(n,{modelValue:r(a).last_deadline,"onUpdate:modelValue":l[4]||(l[4]=o=>r(a).last_deadline=o),"error-messages":i.value.last_deadline,label:"Date de dernière échéance",placeholder:"Ex: 2024-02-02",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(p,{modelValue:r(a).source_of_reimbursement,"onUpdate:modelValue":l[5]||(l[5]=o=>r(a).source_of_reimbursement=o),items:[{value:"revenue_from_the_activity",title:"Recettes de l’activité"},{value:"final_payer_settlement",title:"Règlement du payeur final"},{value:"resale_of_goods",title:"Reventes des marchandises"}],"error-messages":i.value.source_of_reimbursement,label:"Source du remboursement",placeholder:"Ex: Recettes de l’activité",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(u,{modelValue:r(a).outstanding_number_ready_to_settle,"onUpdate:modelValue":l[6]||(l[6]=o=>r(a).outstanding_number_ready_to_settle=o),"error-messages":i.value.outstanding_number_ready_to_settle,label:"Numéro encours prêt à solder",placeholder:"Ex: ",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(u,{modelValue:r(a).other_expenses,"onUpdate:modelValue":l[7]||(l[7]=o=>r(a).other_expenses=o),"error-messages":i.value.other_expenses,label:"Autres frais",placeholder:"Ex: ",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"6",lg:"6"},{default:t(()=>[e(u,{modelValue:r(a).teg,"onUpdate:modelValue":l[8]||(l[8]=o=>r(a).teg=o),"error-messages":i.value.teg,label:"TEG",placeholder:"Ex: 15000600",rules:["requiredValidator"in s?s.requiredValidator:r(m)]},null,8,["modelValue","error-messages","rules"])]),_:1}),e(d,{cols:"12",md:"12",lg:"12"},{default:t(()=>[e(I,{modelValue:r(a).instructions_from_the_risk_and_credit_department,"onUpdate:modelValue":l[9]||(l[9]=o=>r(a).instructions_from_the_risk_and_credit_department=o),"error-messages":i.value.instructions_from_the_risk_and_credit_department,label:"Instructions du département risque et crédit",placeholder:"Ex: ",rules:["requiredValidator"in s?s.requiredValidator:r(m)],clearable:"",counter:""},null,8,["modelValue","error-messages","rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{cols:"12"},{default:t(()=>[c("div",oe,[de,c("div",ie,[e(b,{type:"reset",variant:"tonal",color:"primary"},{default:t(()=>[e(T,{start:"",icon:"tabler-circle-minus"}),V(" Effacer ")]),_:1}),e(b,{type:"submit",class:"me-3"},{default:t(()=>[V(" Enregistrer "),e(T,{end:"",icon:"tabler-checkbox"})]),_:1})])])]),_:1})]),_:1})]),_:1},512),e(ae,{modelValue:h.value,"onUpdate:modelValue":l[10]||(l[10]=o=>h.value=o),transition:"scroll-y-reverse-transition",location:"bottom end",color:"error"},{default:t(()=>[V(O(q.value),1)]),_:1},8,["modelValue"])])}}},Be=ee(ue,[["__scopeId","data-v-fa6b93f7"]]);export{Be as default};
