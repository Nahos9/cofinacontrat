import{_ as fe}from"./ConfirmDialog-c8ac3747.js";import{ah as _e,a1 as M,ai as ve,aa as j,r as p,w as Ve,o as d,c as g,b as t,e as n,s as a,f as x,$ as U,F as B,d as i,M as u,a3 as m,N as C,x as c,A as J,Z as b,a2 as be}from"./main-f1b08e28.js";import{a as O}from"./axios-1779699b.js";import{J as ye}from"./js-file-downloader-5fe04a4d.js";import{u as he}from"./useApi-a3fc7afe.js";import{c as ge}from"./createUrl-4bc7136b.js";import{V as w,c as Q,b as xe}from"./VCard-3bc3303e.js";import{V as Ce}from"./VDialog-a722b47f.js";import{V as P}from"./VCardText-75d87fa3.js";import{V as Z}from"./VRow-cfd5c28f.js";import{V as G}from"./VCol-785143ee.js";import{V as f}from"./VTextField-f14477a0.js";import{V as ke}from"./VBadge-01ee0eac.js";import{V as H}from"./VDivider-e33bebdc.js";import{V as D}from"./VSelect-64c654bc.js";import{V as Ae}from"./VForm-1f059ba2.js";import{V as we}from"./VSpacer-4ba236ae.js";import"./index-9c720871.js";import"./VAvatar-449fc9b2.js";import"./VImg-b961b6d3.js";import"./VOverlay-d3b76df3.js";import"./forwardRefs-6ea3df5c.js";import"./VList-1035e3ce.js";import"./VMenu-aa75d60b.js";const Pe=i("h2",null,"Liste des attestations",-1),ze={class:"ms-2 d-flex gap-4 flex-wrap align-center items-end"},Te={class:"text-body-2"},$e={key:0,class:""},Me={class:"table table-bordered w-100"},Ue=i("thead",null,[i("tr",null,[i("th",null,"Nom"),i("th",null,"Prénom"),i("th",null,"Type d'attestation"),i("th",null,"Actions")])],-1),De={class:"d-flex align-center"},Le={class:"text-body-2 me-4"},Ne={class:"d-flex align-center"},Be={class:"d-flex align-center mx-2"},Ee={class:"text-center py-8"},Fe={class:"text-h6 mb-2"},Se={class:"text-body-2 text-medium-emphasis"},Re={key:1,class:"d-flex gap-2 mb-2"},qe={key:2,class:"mb-2"},Ie={class:"d-flex gap-2 mb-2"},je={class:"d-flex gap-2"},_t={__name:"index",async setup(Je){let z,E;const{data:K,execute:F}=([z,E]=_e(()=>he(ge("/attestation/"))),z=await z,E(),z),S=M(()=>K.value),R=ve.useToast(),q=j("userToken"),y=p(""),r=p(1),_=p(10),W=p(0),X=["personne physique","personne morale"],Y=["Monsieur","Madame"],ee=["main levée de gage","cloture","endettement","non endettement"],v=M(()=>{if(!y.value)return S.value||[];const o=y.value.toLowerCase();return(S.value||[]).filter(l=>l.last_name&&l.last_name.toLowerCase().includes(o)||l.first_name&&l.first_name.toLowerCase().includes(o)||l.raison_sociale&&l.raison_sociale.toLowerCase().includes(o)||l.email&&l.email.toLowerCase().includes(o)||l.phone&&l.phone.toLowerCase().includes(o)||l.city&&l.city.toLowerCase().includes(o))}),te=M(()=>{const o=(r.value-1)*_.value,l=o+_.value;return v.value.slice(o,l)}),V=M(()=>Math.ceil(v.value.length/_.value));Ve(v,o=>{W.value=o.length,r.value>V.value&&V.value>0&&(r.value=1)});const le=o=>{o>=1&&o<=V.value&&(r.value=o)},ae=()=>{r.value=1},oe=()=>{r.value=V.value},ne=()=>{r.value>1&&r.value--},se=()=>{r.value<V.value&&r.value++},k=p(!1),L=p(null),s=p({first_name:"",raison_sociale:"",phone:"",account_number:"",date_de_creation_compte:"",type:"",type_attestation:"",civilite:"",montant_endettement:"",city:""});function ie(o){L.value=o,s.value={first_name:o.first_name,civilite:o.civilite,phone:o.phone,raison_sociale:o.raison_sociale,account_number:o.account_number,date_de_creation_compte:o.date_de_creation_compte,type:o.type,type_attestation:o.type_attestation,montant_endettement:o.montant_endettement,city:o.city},k.value=!0}const I=async()=>{O.put(`/api/attestation/${L.value.id}`,{first_name:s.value.first_name,raison_sociale:s.value.raison_sociale,account_number:s.value.account_number,date_de_creation_compte:s.value.date_de_creation_compte,type:s.value.type,type_attestation:s.value.type_attestation,phone:s.value.phone,city:s.value.city},{headers:{Authorization:`Bearer ${q.value}`}}).then(o=>{o.status==200&&(R.success("Attestation modifiée!!",{position:"top-right"}),k.value=!1,F())})};function re(){k.value=!1,L.value=null}const ue=async(o,l)=>{const A=j("userToken").value;try{new ye({url:o,headers:[{name:"Authorization",value:`Bearer ${A}`},{name:"Accept",value:"application/json"}],nameCallback:function(e){return l}})}catch(e){console.error("Erreur lors du téléchargement:",e)}};async function de(o){O.delete(`/api/attestation/${o}`,{headers:{Authorization:`Bearer ${q.value}`}}).then(l=>{l.status==200&&(R.success("Attestation supprimée!!",{position:"top-right"}),F())})}const T=p(!1),$=p(null);function me(o){$.value=o,T.value=!0}function ce(o){o&&$.value&&de($.value),$.value=null}function pe(){const o=[],A=Math.floor(2.5);let e=Math.max(1,r.value-A),h=Math.min(V.value,e+5-1);h-e<5-1&&(e=Math.max(1,h-5+1));for(let N=e;N<=h;N++)o.push(N);return o}return(o,l)=>{const A=fe;return d(),g(B,null,[t(w,null,{default:n(()=>[t(P,null,{default:n(()=>[t(Z,null,{default:n(()=>[t(P,null,{default:n(()=>[Pe]),_:1}),i("div",ze,[o.$can("create","attestation")?(d(),x(m,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"attestation-add"}},{default:n(()=>[u(" Ajouter ")]),_:1})):C("",!0)])]),_:1})]),_:1})]),_:1}),t(w,{class:"mb-4 mt-2"},{default:n(()=>[t(P,null,{default:n(()=>[t(Z,null,{default:n(()=>[t(G,{cols:"12",md:"6"},{default:n(()=>[t(f,{modelValue:a(y),"onUpdate:modelValue":l[0]||(l[0]=e=>U(y)?y.value=e:null),label:"Rechercher une attestation...","prepend-inner-icon":"tabler-search",variant:"outlined",clearable:"",placeholder:"Nom, prénom, email, téléphone, ville..."},null,8,["modelValue"])]),_:1}),t(G,{cols:"12",md:"6",class:"d-flex align-center"},{default:n(()=>[t(ke,{content:a(v).length,"model-value":!0,color:"primary",class:"ms-auto"},{default:n(()=>[i("span",Te,c(a(v).length)+" attestation(s) trouvée(s) ",1)]),_:1},8,["content"])]),_:1})]),_:1})]),_:1})]),_:1}),a(v).length>0?(d(),g("div",$e,[t(w,{class:"mb-6 mt-2"},{default:n(()=>[t(H,{class:"mt-4"}),i("table",Me,[Ue,i("tbody",null,[(d(!0),g(B,null,J(a(te),e=>(d(),g("tr",{key:e.id,class:"text-center"},[i("td",null,c(e.last_name)+" "+c(e.raison_sociale),1),i("td",null,c(e.first_name),1),i("td",null,c(e.type_attestation),1),i("td",null,[o.$can("update","attestation")?(d(),x(m,{key:0,icon:"",size:"small",color:"primary",onClick:h=>ie(e),class:"me-2"},{default:n(()=>[t(b,null,{default:n(()=>[u("tabler-edit")]),_:1})]),_:2},1032,["onClick"])):C("",!0),o.$can("delete","attestation")?(d(),x(m,{key:1,icon:"",size:"small",color:"error",class:"me-2",onClick:h=>me(e.id)},{default:n(()=>[t(b,null,{default:n(()=>[u("tabler-trash")]),_:1})]),_:2},1032,["onClick"])):C("",!0),t(m,{icon:"",size:"small",class:"mR-2",color:"primary",onClick:h=>ue(`/api/attestation/download/${e.id}`,`Attestation-${e.id}.docx`)},{default:n(()=>[t(b,null,{default:n(()=>[u("tabler-download")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),t(H,{class:"mt-4"}),t(Q,{class:"d-flex justify-space-between align-center pa-4"},{default:n(()=>[i("div",De,[i("span",Le," Affichage de "+c((a(r)-1)*a(_)+1)+" à "+c(Math.min(a(r)*a(_),a(v).length))+" sur "+c(a(v).length)+" attestations ",1),t(D,{modelValue:a(_),"onUpdate:modelValue":l[1]||(l[1]=e=>U(_)?_.value=e:null),items:[5,10,20,50],label:"Par page",variant:"outlined",density:"compact",class:"me-4",style:{"max-width":"120px"}},null,8,["modelValue"])]),i("div",Ne,[t(m,{icon:"",size:"small",variant:"text",disabled:a(r)===1,onClick:ae,class:"me-2"},{default:n(()=>[t(b,null,{default:n(()=>[u("tabler-chevrons-left")]),_:1})]),_:1},8,["disabled"]),t(m,{icon:"",size:"small",variant:"text",disabled:a(r)===1,onClick:ne,class:"me-2"},{default:n(()=>[t(b,null,{default:n(()=>[u("tabler-chevron-left")]),_:1})]),_:1},8,["disabled"]),i("div",Be,[(d(!0),g(B,null,J(pe(),e=>(d(),x(m,{key:e,color:e===a(r)?"primary":"default",variant:e===a(r)?"elevated":"text",size:"small",class:"mx-1",onClick:h=>le(e)},{default:n(()=>[u(c(e),1)]),_:2},1032,["color","variant","onClick"]))),128))]),t(m,{icon:"",size:"small",variant:"text",disabled:a(r)===a(V),onClick:se,class:"me-2"},{default:n(()=>[t(b,null,{default:n(()=>[u("tabler-chevron-right")]),_:1})]),_:1},8,["disabled"]),t(m,{icon:"",size:"small",variant:"text",disabled:a(r)===a(V),onClick:oe,class:"me-2"},{default:n(()=>[t(b,null,{default:n(()=>[u("tabler-chevrons-right")]),_:1})]),_:1},8,["disabled"])])]),_:1})]),_:1})])):(d(),x(w,{key:1,class:"mt-2"},{default:n(()=>[t(P,null,{default:n(()=>[i("div",Ee,[t(b,{size:"64",color:"grey",class:"mb-4"},{default:n(()=>[u("tabler-search-off")]),_:1}),i("h3",Fe,c(a(y)?"Aucune attestation trouvée":"Aucune attestation disponible"),1),i("p",Se,c(a(y)?"Essayez de modifier vos critères de recherche":"Commencez par ajouter une attestation"),1)])]),_:1})]),_:1})),t(Ce,{modelValue:a(k),"onUpdate:modelValue":l[13]||(l[13]=e=>U(k)?k.value=e:null),"max-width":"600px"},{default:n(()=>[t(w,null,{default:n(()=>[t(xe,{class:"text-h5"},{default:n(()=>[u(" Modifier l'attestation ")]),_:1}),t(P,null,{default:n(()=>[t(Ae,{onSubmit:be(I,["prevent"])},{default:n(()=>[t(D,{class:"z-index-1000 mb-2",label:"Type",modelValue:a(s).type,"onUpdate:modelValue":l[2]||(l[2]=e=>a(s).type=e),items:X,disabled:""},null,8,["modelValue"]),t(D,{class:"z-index-40 mb-2",label:"Type d'attestation",modelValue:a(s).type_attestation,"onUpdate:modelValue":l[3]||(l[3]=e=>a(s).type_attestation=e),items:ee},null,8,["modelValue"]),a(s).type=="personne physique"?(d(),x(D,{key:0,class:"z-index-40 mb-2",label:"Civilité",modelValue:a(s).civilite,"onUpdate:modelValue":l[4]||(l[4]=e=>a(s).civilite=e),items:Y},null,8,["modelValue"])):C("",!0),a(s).type=="personne physique"?(d(),g("div",Re,[t(f,{label:"Nom",modelValue:a(s).last_name,"onUpdate:modelValue":l[5]||(l[5]=e=>a(s).last_name=e)},null,8,["modelValue"]),t(f,{label:"Prénom",modelValue:a(s).first_name,"onUpdate:modelValue":l[6]||(l[6]=e=>a(s).first_name=e)},null,8,["modelValue"])])):C("",!0),a(s).type=="personne morale"?(d(),g("div",qe,[t(f,{label:"Raison sociale",modelValue:a(s).raison_sociale,"onUpdate:modelValue":l[7]||(l[7]=e=>a(s).raison_sociale=e)},null,8,["modelValue"])])):C("",!0),i("div",Ie,[t(f,{label:"Email",modelValue:a(s).email,"onUpdate:modelValue":l[8]||(l[8]=e=>a(s).email=e)},null,8,["modelValue"]),t(f,{label:"Téléphone",modelValue:a(s).phone,"onUpdate:modelValue":l[9]||(l[9]=e=>a(s).phone=e)},null,8,["modelValue"])]),t(f,{label:"Numéro de compte",class:"mb-2",modelValue:a(s).account_number,"onUpdate:modelValue":l[10]||(l[10]=e=>a(s).account_number=e)},null,8,["modelValue"]),a(s).type_attestation=="endettement"?(d(),x(f,{key:3,label:"Montant d'endettement",class:"mb-2",modelValue:a(s).montant_endettement,"onUpdate:modelValue":l[11]||(l[11]=e=>a(s).montant_endettement=e)},null,8,["modelValue"])):C("",!0),t(f,{type:"date",class:"mb-2",label:"Date de création du compte",modelValue:a(s).date_de_creation_compte,"onUpdate:modelValue":l[12]||(l[12]=e=>a(s).date_de_creation_compte=e)},null,8,["modelValue"]),i("div",je,[t(m,{type:"submit",class:"z-index-1000 mb-2"},{default:n(()=>[u("Modifier")]),_:1}),t(m,{type:"reset",class:"z-index-1000 mb-2"},{default:n(()=>[u("Réinitialiser")]),_:1})])]),_:1})]),_:1}),t(Q,null,{default:n(()=>[t(we),t(m,{color:"grey-darken-1",variant:"text",onClick:re},{default:n(()=>[u(" Annuler ")]),_:1}),t(m,{color:"primary",onClick:I},{default:n(()=>[u(" Sauvegarder ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(A,{isDialogVisible:a(T),"onUpdate:isDialogVisible":l[14]||(l[14]=e=>U(T)?T.value=e:null),"confirmation-question":"Êtes-vous sûr de vouloir supprimer cette attestation ?","confirm-title":"Supprimé !","confirm-msg":"Attestation supprimée avec succès.","cancel-title":"Annulé","cancel-msg":"Suppression annulée.",onConfirm:ce},null,8,["isDialogVisible"])],64)}}};export{_t as default};
