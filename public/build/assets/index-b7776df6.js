import{_ as ie}from"./DialogCloseBtn-1c006895.js";import{_ as se}from"./AppTextField-f2216bdc.js";import{V as de,p as ue,a as ce}from"./VPagination-13bf9368.js";import{J as pe}from"./js-file-downloader-3f2eecf8.js";import{r as g,ah as O,a1 as E,c as h,b as e,e as t,s as n,$ as k,n as me,a as fe,o as i,d as y,a3 as p,M as l,f as b,N as m,Z as d,F as J,A as G,x as N,z as q,aa as Q}from"./main-822cac03.js";import{u as Z}from"./useApi-dbfdbae2.js";import{c as H}from"./createUrl-aee5361a.js";import{$ as _e}from"./api-f041352e.js";import{_ as ge}from"./_plugin-vue_export-helper-c27b6911.js";import{V as K}from"./VCard-fcaa82b6.js";import{V as ve}from"./VDialog-3bbfde53.js";import{V as ye}from"./VRow-3e61a99c.js";import{V as W}from"./VCol-78b1b57e.js";import{V as be}from"./VSpacer-ecc768a5.js";import{V as D}from"./VDivider-e7100701.js";import{V as X,b as $,a as x}from"./VList-7b39dc2c.js";import{V as Y}from"./VSelect-cb288123.js";import{V as Ve}from"./VMenu-68a89a7c.js";import{V as ee}from"./VCardText-61e00425.js";import"./VTextField-4e435eba.js";import"./VImg-3735f12f.js";import"./forwardRefs-6ea3df5c.js";import"./VTable-d0b73a7d.js";import"./filter-7793fd28.js";import"./index-9c720871.js";import"./useAbility-d0784979.js";import"./VAvatar-a458b54c.js";import"./VOverlay-9ecf3b81.js";const he={class:"d-flex flex-wrap gap-4 mx-5"},ke={class:"d-flex align-center"},$e={class:"d-flex gap-4 flex-wrap align-center"},xe={class:"custom-loader"},we=["onInput"],Ce={key:0},Te={key:1},Be={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},De={class:"text-sm text-medium-emphasis mb-0"},Ae={__name:"index",async setup(Ie){let f,w;const V=me(),_=g(!1),S=g(0),C=g(""),F=g(),L=g("signed_notification"),T=g([]),B=g(8),u=g(1),te=[{title:"Nom",key:"full_name"},{title:"Fonction",key:"function"},{title:"Pièce didentité",key:"number_of_identity_document"},{title:"Numéro de téléphone",key:"phone_number"},{title:"Observations",key:"observations"},{title:"Actions",key:"actions",sortable:!1}],{data:A,execute:I}=([f,w]=O(()=>Z(H("/guarantor",{query:{search:C,with_verbal_trial:1,notification_id:V.params.notification_id,page:u}}))),f=await f,w(),f),{data:U}=([f,w]=O(()=>Z(H(`/verbal-trial/${V.params.notification_id}`))),f=await f,w(),f),ae=r=>{T.value[r]=!0,setTimeout(()=>{T.value[r]=!1},1e3)},oe=r=>{u.value=r.page},j=async(r,o)=>{const v=Q("userToken").value;try{new pe({url:r,headers:[{name:"Authorization",value:`Bearer ${v}`},{name:"Accept",value:"application/json"}],nameCallback:function(s){return o}})}catch(s){console.error("Erreur lors du téléchargement:",s)}},ne=async(r,o)=>{const{files:v}=o.target;if(v&&v.length===1){const s=new FileReader;s.onload=async()=>{const P=s.result;try{(await fetch(`/api/guarantor/upload/${r}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Q("userToken").value}`},body:JSON.stringify({[L.value]:P})})).ok?I():console.error("Échec de l'envoi du document.")}catch(a){console.error("Erreur lors de l'envoi du document:",a)}},s.readAsDataURL(v[0])}else console.error("Veuillez sélectionner un seul fichier.")},re=async r=>{await _e(`guarantor/${r}`,{method:"DELETE"}),I()};U.value.data.verbalTrial.head_credit_validation=="validated"&&U.value.data.verbalTrial.status=="validated";const le=E(()=>A.value.data),z=E(()=>A.value.total),R=E(()=>A.value.last_page);return(r,o)=>{const v=se,s=fe("IconBtn"),P=ie;return i(),h("div",null,[e(K,{title:"Liste des cautions",class:"mb-6"},{default:t(()=>[y("div",he,[y("div",ke,[e(ye,null,{default:t(()=>[e(W,null,{default:t(()=>[e(p,{"prepend-icon":"tabler-arrow-left",to:"../"},{default:t(()=>[l(" Notifications ")]),_:1})]),_:1}),e(W,null,{default:t(()=>[e(v,{modelValue:n(C),"onUpdate:modelValue":o[0]||(o[0]=a=>k(C)?C.value=a:null),placeholder:"Rechercher",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),_:1})]),_:1})]),e(be),y("div",$e,[e(p,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:t(()=>[l(" Export ")]),_:1}),r.$can("create","guarantor")?(i(),b(p,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"notification-notification_id-guarantor-add",params:{notification_id:n(V).params.notification_id}}},{default:t(()=>[l(" Ajouter ")]),_:1},8,["to"])):m("",!0),e(p,{loading:n(T)[3],disabled:n(T)[3],"prepend-icon":"tabler-refresh",onClick:o[1]||(o[1]=a=>{n(I)(),ae(3)})},{loader:t(()=>[y("span",xe,[e(d,{icon:"tabler-refresh"})])]),default:t(()=>[l(" Recharger ")]),_:1},8,["loading","disabled"])])]),e(D,{class:"mt-4"}),e(n(de),{"items-per-page":n(B),"onUpdate:itemsPerPage":o[4]||(o[4]=a=>k(B)?B.value=a:null),page:n(u),"onUpdate:page":o[5]||(o[5]=a=>k(u)?u.value=a:null),headers:te,items:n(le),"items-length":n(z),class:"text-no-wrap","onUpdate:options":oe},{"item.observations":t(({item:a})=>[e(X,{density:"compact"},{default:t(()=>[(i(!0),h(J,null,G(a.observations,c=>(i(),b(x,null,{default:t(()=>[e($,null,{default:t(()=>[e(Y,{label:""},{default:t(()=>[l(N(c),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256)),a.observations.length==0?(i(),h(J,{key:0},G(["Dossier complet"],c=>e(x,null,{default:t(()=>[e($,null,{default:t(()=>[e(Y,{color:"success",label:""},{default:t(()=>[l(N(c),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),64)):m("",!0)]),_:2},1024)]),"item.actions":t(({item:a})=>[r.$can("read","guarantor")?(i(),b(s,{key:0,to:{name:"notification-notification_id-guarantor-id",params:{notification_id:n(V).params.notification_id,id:a.id}}},{default:t(()=>[e(d,{icon:"tabler-eye"})]),_:2},1032,["to"])):m("",!0),r.$can("update","guarantor")?(i(),b(s,{key:1,to:{name:"notification-notification_id-guarantor-edit-id",params:{notification_id:n(V).params.notification_id,id:a.id}}},{default:t(()=>[e(d,{icon:"tabler-edit"})]),_:2},1032,["to"])):m("",!0),r.$can("delete","guarantor")?(i(),b(s,{key:2,onClick:c=>{S.value=a.id,_.value=!0}},{default:t(()=>[e(d,{icon:"tabler-trash",color:"error"})]),_:2},1032,["onClick"])):m("",!0),e(p,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:t(()=>[e(d,{size:"24",icon:"tabler-dots-vertical"}),e(Ve,{activator:"parent"},{default:t(()=>[e(X,null,{default:t(()=>[y("input",{ref_key:"refInputEl",ref:F,type:"file",name:"signed_notification",accept:".pdf,.png,.jpg",hidden:"",onInput:c=>ne(a.id,c)},null,40,we),r.$can("download","guarantor")?(i(),h("div",Ce,[e(x,{onClick:c=>{j(`/api/guarantor/promissory-note/download/${a.id}`,`Billet-à-ordre-Caution-${a.notification.verbal_trial.committee_id}.docx`)}},{prepend:t(()=>[e(d,{icon:"tabler-download"})]),default:t(()=>[e($,null,{default:t(()=>[l("Télécharger Billet à ordre non signé")]),_:1})]),_:2},1032,["onClick"]),a.signed_promissory_note_path?(i(),b(x,{key:0,onClick:c=>j(a.signed_promissory_note_path,`Billet-à-ordre-Caution-${a.signed_promissory_note_path.split("/").slice(-1)[0]}`)},{prepend:t(()=>[e(d,{icon:"tabler-download"})]),default:t(()=>[e($,null,{default:t(()=>[l("Télécharger Billet à ordre signé")]),_:1})]),_:2},1032,["onClick"])):m("",!0)])):m("",!0),r.$can("upload","guarantor")?(i(),h("div",Te,[e(D),a.signed_promissory_note_path==null?(i(),b(x,{key:0,onClick:o[2]||(o[2]=c=>{var M;L.value="signed_promissory_note",(M=n(F))==null||M.click()})},{prepend:t(()=>[e(d,{icon:"tabler-cloud-upload"})]),default:t(()=>[e($,null,{default:t(()=>[l("Ajouter billet à ordre signé")]),_:1})]),_:1})):m("",!0)])):m("",!0),e(D)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:t(()=>[e(D),y("div",Be,[y("p",De,N(n(ue)({page:n(u),itemsPerPage:n(B)},n(z))),1),e(ce,{modelValue:n(u),"onUpdate:modelValue":o[3]||(o[3]=a=>k(u)?u.value=a:null),length:n(R),"total-visible":r.$vuetify.display.xs?1:Math.min(n(R),5)},{prev:t(a=>[e(p,q({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[e(d,{start:"",icon:"tabler-arrow-left"}),l(" Précedent ")]),_:2},1040)]),next:t(a=>[e(p,q({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[l(" Suivant "),e(d,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(ve,{modelValue:n(_),"onUpdate:modelValue":o[9]||(o[9]=a=>k(_)?_.value=a:null),class:"v-dialog-sm"},{default:t(()=>[e(P,{onClick:o[6]||(o[6]=a=>_.value=!n(_))}),e(K,{title:"Suppression"},{default:t(()=>[e(ee,null,{default:t(()=>[l(" Etes vous sûr de vouloir supprimer cette caution? ")]),_:1}),e(ee,{class:"d-flex justify-end gap-3 flex-wrap"},{default:t(()=>[e(p,{color:"secondary",variant:"tonal",onClick:o[7]||(o[7]=a=>_.value=!1)},{default:t(()=>[l(" Annuler ")]),_:1}),e(p,{onClick:o[8]||(o[8]=a=>{re(n(S)),_.value=!1})},{default:t(()=>[l(" Supprimer ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},lt=ge(Ae,[["__scopeId","data-v-1d85a054"]]);export{lt as default};
