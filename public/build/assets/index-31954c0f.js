import{_ as K}from"./DialogCloseBtn-0315bcc2.js";import{_ as W}from"./AppTextField-b4085f51.js";import{V as X,p as Y,a as ee}from"./VPagination-c1b4edbe.js";import{_ as te}from"./AppAutocomplete-8b95c36b.js";import{J as ae}from"./js-file-downloader-5b6f6396.js";import{u as E}from"./useApi-1e09ddbc.js";import{c as I}from"./createUrl-d7012835.js";import{r as p,ah as N,a1 as k,c as oe,b as e,e as t,s as l,$ as u,a as le,o as w,d as c,a3 as m,M as r,f as D,N as P,Z as _,x as se,z as F,aa as re,C as ie,D as ne}from"./main-73dad722.js";import{$ as de}from"./api-d9197f12.js";import{_ as pe}from"./_plugin-vue_export-helper-c27b6911.js";import{V as T}from"./VCard-a7257563.js";import{V as me}from"./VDialog-4eb72ad9.js";import{V as v}from"./VCardText-5fc82341.js";import{V as j}from"./VRow-fc63f4b9.js";import{V as ce}from"./VCol-e5f6f53e.js";import{V as A}from"./VDivider-e2af3062.js";import{V as ue}from"./VSpacer-1997f59b.js";import{V as M}from"./VTooltip-10561fa5.js";import"./VTextField-8fccfbcb.js";import"./VImg-3fa5dc87.js";import"./forwardRefs-6ea3df5c.js";import"./VSelect-5badf57c.js";import"./VList-7c470c0f.js";import"./VAvatar-77685594.js";import"./VOverlay-c321d54c.js";import"./VMenu-811e9018.js";import"./VTable-5a5d5390.js";import"./filter-f20a6d80.js";import"./index-9c720871.js";import"./useAbility-776e335a.js";const fe=g=>(ie("data-v-24eba9dd"),g=g(),ne(),g),_e=fe(()=>c("h2",null,"Historique des procès verbaux",-1)),ve={class:"d-flex flex-wrap gap-4 mx-5"},ge={class:"d-flex align-center"},ye={class:"d-flex gap-4 flex-wrap align-center"},Ve={class:"custom-loader"},be={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},xe={class:"text-sm text-medium-emphasis mb-0"},he={__name:"index",async setup(g){let n,y;const d=p(!1),R=p(0),V=p(),b=p(""),q=[{title:"Numéro comitée",key:"committee_id"},{title:"Prénom client",key:"applicant_first_name"},{title:"Nom client",key:"applicant_last_name"},{title:"Type Credit",key:"type_of_credit.full_name"},{title:"Montant",key:"amount_fr"},{title:"Durée",key:"duration"},{title:"CAF",key:"caf.full_name"},{title:"Actions",key:"actions",sortable:!1}],x=p([]),z=s=>{x.value[s]=!0,setTimeout(()=>{x.value[s]=!1},1e3)},h=p(8),i=p(1),J=s=>{i.value=s.page},{data:$,execute:B}=([n,y]=N(()=>E(I("/verbal-trial",{query:{search:b,type_of_credit_id:V,page:i,has_contract:1,has_mortgage:0,with_caf:1,with_type_of_credit:1}}))),n=await n,y(),n),{data:L}=([n,y]=N(()=>E(I("/type-of-credit",{query:{paginate:0}}))),n=await n,y(),n),H=async(s,o)=>{const C=re("userToken").value;try{new ae({url:s,headers:[{name:"Authorization",value:`Bearer ${C}`},{name:"Accept",value:"application/json"}],nameCallback:function(f){return o}})}catch(f){console.error("Erreur lors du téléchargement:",f)}},O=async s=>{await de(`verbal-trial/${s}`,{method:"DELETE"}),B()},Q=k(()=>$.value.data),S=k(()=>$.value.total),U=k(()=>$.value.last_page),Z=k(()=>L.value.data);return(s,o)=>{const C=W,f=le("IconBtn"),G=K;return w(),oe("div",null,[e(T,{class:"mb-6"},{default:t(()=>[e(v,null,{default:t(()=>[e(j,null,{default:t(()=>[e(v,null,{default:t(()=>[_e]),_:1})]),_:1})]),_:1})]),_:1}),e(T,{title:"Filtres",class:"mb-6"},{default:t(()=>[e(v,null,{default:t(()=>[e(j,null,{default:t(()=>[e(ce,{cols:"12",sm:"4"},{default:t(()=>[e(te,{modelValue:l(V),"onUpdate:modelValue":o[0]||(o[0]=a=>u(V)?V.value=a:null),placeholder:"Type de crédit","item-title":"full_name","item-value":"id",items:l(Z),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),e(A,{class:"my-4"}),c("div",ve,[c("div",ge,[e(C,{modelValue:l(b),"onUpdate:modelValue":o[1]||(o[1]=a=>u(b)?b.value=a:null),placeholder:"Rechercher un pv",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(ue),c("div",ye,[e(m,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:t(()=>[r(" Export ")]),_:1}),s.$can("create","pv")?(w(),D(m,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"pv-add"}},{default:t(()=>[r(" Ajouter ")]),_:1})):P("",!0),e(m,{loading:l(x)[3],disabled:l(x)[3],"prepend-icon":"tabler-refresh",onClick:o[2]||(o[2]=a=>{l(B)(),z(3)})},{loader:t(()=>[c("span",Ve,[e(_,{icon:"tabler-refresh"})])]),default:t(()=>[r(" Recharger ")]),_:1},8,["loading","disabled"])])]),e(A,{class:"mt-4"}),e(l(X),{"items-per-page":l(h),"onUpdate:itemsPerPage":o[4]||(o[4]=a=>u(h)?h.value=a:null),page:l(i),"onUpdate:page":o[5]||(o[5]=a=>u(i)?i.value=a:null),headers:q,items:l(Q),"items-length":l(S),class:"text-no-wrap","onUpdate:options":J},{"item.actions":t(({item:a})=>[s.$can("read","pv")||s.$can("historical","pv")?(w(),D(f,{key:0,to:{name:"pv-id",params:{id:a.id}}},{default:t(()=>[e(M,{activator:"parent",transition:"scroll-x-transition",location:"top"},{default:t(()=>[r("Details")]),_:1}),e(_,{icon:" tabler-eye"})]),_:2},1032,["to"])):P("",!0),s.$can("download","pv")?(w(),D(f,{key:1,onClick:ke=>H(`/api/verbal-trial/download/${a.id}`,`PV-${a.committee_id}.docx`)},{default:t(()=>[e(M,{activator:"parent",transition:"scroll-x-transition",location:"top"},{default:t(()=>[r("Télécharger")]),_:1}),e(_,{icon:"tabler-download"})]),_:2},1032,["onClick"])):P("",!0)]),bottom:t(()=>[e(A),c("div",be,[c("p",xe,se(l(Y)({page:l(i),itemsPerPage:l(h)},l(S))),1),e(ee,{modelValue:l(i),"onUpdate:modelValue":o[3]||(o[3]=a=>u(i)?i.value=a:null),length:l(U),"total-visible":s.$vuetify.display.xs?1:Math.min(l(U),5)},{prev:t(a=>[e(m,F({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[e(_,{start:"",icon:"tabler-arrow-left"}),r(" Précedent ")]),_:2},1040)]),next:t(a=>[e(m,F({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[r(" Suivant "),e(_,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(me,{modelValue:l(d),"onUpdate:modelValue":o[9]||(o[9]=a=>u(d)?d.value=a:null),class:"v-dialog-sm"},{default:t(()=>[e(G,{onClick:o[6]||(o[6]=a=>d.value=!l(d))}),e(T,{title:"Suppression"},{default:t(()=>[e(v,null,{default:t(()=>[r(" Etes vous sûr de vouloir supprimer ce pv? ")]),_:1}),e(v,{class:"d-flex justify-end gap-3 flex-wrap"},{default:t(()=>[e(m,{color:"secondary",variant:"tonal",onClick:o[7]||(o[7]=a=>d.value=!1)},{default:t(()=>[r(" Annuler ")]),_:1}),e(m,{onClick:o[8]||(o[8]=a=>{O(l(R)),d.value=!1})},{default:t(()=>[r(" Supprimer ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},et=pe(he,[["__scopeId","data-v-24eba9dd"]]);export{et as default};
