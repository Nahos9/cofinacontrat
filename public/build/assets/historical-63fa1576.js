import{_ as Z}from"./AppTextField-80dc8d03.js";import{_ as G}from"./AppSelect-b24a09f8.js";import{V as H,p as K,a as W}from"./VPagination-bb5ef146.js";import{J as X}from"./js-file-downloader-31640ac2.js";import"./api-2f5fa775.js";import{u as Y}from"./useApi-70686891.js";import{c as ee}from"./createUrl-9264a606.js";import{r as d,ah as te,a1 as P,c as F,b as e,e as t,a as ae,o as c,s as o,$ as v,d as p,a3 as u,M as n,f as g,N as m,Z as r,x as A,z as L,aa as oe,C as le,D as ne}from"./main-a8d7595f.js";import{_ as ie}from"./_plugin-vue_export-helper-c27b6911.js";import{V as z}from"./VCard-19cbb39e.js";import{V as I}from"./VCardText-ca9b002d.js";import{V as E}from"./VRow-e151ff44.js";import{V as re}from"./VCol-c2ef0fbc.js";import{V as b}from"./VDivider-9793b6d8.js";import{V as se}from"./VSpacer-ccce896a.js";import{V as de}from"./VMenu-2641fb10.js";import{V as ce,a as _,b as f}from"./VList-49f69994.js";import{V as pe}from"./VBadge-b9361173.js";import"./VTextField-71f939fd.js";import"./VImg-288f023b.js";import"./forwardRefs-6ea3df5c.js";import"./VSelect-90ee7339.js";import"./VOverlay-6a1cda30.js";import"./VAvatar-d1f1158b.js";import"./VTable-825110e3.js";import"./filter-5ae7a153.js";import"./index-9c720871.js";import"./useAbility-bbc6ecc1.js";const ue=y=>(le("data-v-2d8c6bb1"),y=y(),ne(),y),me=ue(()=>p("h2",null," Liste des contrats en attente de CAT ",-1)),_e={class:"d-flex flex-wrap gap-4 mx-5"},fe={class:"d-flex align-center"},ve={class:"d-flex gap-4 flex-wrap align-center"},ge={class:"custom-loader"},be={key:2},ye={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},he={class:"text-sm text-medium-emphasis mb-0"},Ve={__name:"historical",async setup(y){let h,S;d(!1),d(0);const V=d(),k=d(""),M=[{title:"Numéro comitée",key:"verbal_trial.committee_id"},{title:"Admin Crédit",key:"creator.full_name"},{title:"Nom client",key:"verbal_trial.applicant_full_name"},{title:"Type de contrat",key:"type"},{title:"Montant",key:"verbal_trial.amount"},{title:"Actions",key:"actions",sortable:!1}],C=d([]),R=i=>{C.value[i]=!0,setTimeout(()=>{C.value[i]=!1},1e3)},x=d(8),s=d(1),j=i=>{s.value=i.page},{data:T,execute:N}=([h,S]=te(()=>Y(ee("/notification",{query:{search:k,type:V,page:s,with_verbal_trial:1}}))),h=await h,S(),h),J=P(()=>T.value.data),U=P(()=>T.value.total),D=P(()=>T.value.last_page),q={company:"Société",individual_business:"Entreprise Individuel",particular:"Particulier"},w=async(i,l)=>{try{new X({url:i,headers:[{name:"Authorization",value:`Bearer ${oe("userToken").value}`},{name:"Accept",value:"application/json"}],nameCallback:function($){return l}}),N()}catch($){console.error("Erreur lors du téléchargement:",$)}};return(i,l)=>{const $=G,O=Z,Q=ae("IconBtn");return c(),F("div",null,[e(z,{class:"mb-6"},{default:t(()=>[e(I,null,{default:t(()=>[e(E,null,{default:t(()=>[e(I,null,{default:t(()=>[me]),_:1})]),_:1})]),_:1})]),_:1}),e(z,{title:"Filtres",class:"mb-6"},{default:t(()=>[e(I,null,{default:t(()=>[e(E,null,{default:t(()=>[e(re,{cols:"12",sm:"4"},{default:t(()=>[e($,{modelValue:o(V),"onUpdate:modelValue":l[0]||(l[0]=a=>v(V)?V.value=a:null),placeholder:"Type de contrat",items:[{value:"company",title:"Société"},{value:"particular",title:"Particulier"},{value:"individual_business",title:"Entreprise Individuel"}],clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{class:"my-4"}),p("div",_e,[p("div",fe,[e(O,{modelValue:o(k),"onUpdate:modelValue":l[1]||(l[1]=a=>v(k)?k.value=a:null),placeholder:"Rechercher un contrat",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(se),p("div",ve,[e(u,{variant:"tonal",color:"secondary","prepend-icon":"tabler-download"},{default:t(()=>[n(" Export ")]),_:1}),i.$can("create","notification")?(c(),g(u,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"notification-add"}},{default:t(()=>[n(" Ajouter ")]),_:1})):m("",!0),e(u,{loading:o(C)[3],disabled:o(C)[3],"prepend-icon":"tabler-refresh",onClick:l[2]||(l[2]=a=>{o(N)(),R(3)})},{loader:t(()=>[p("span",ge,[e(r,{icon:"tabler-refresh"})])]),default:t(()=>[n(" Recharger ")]),_:1},8,["loading","disabled"])])]),e(b,{class:"mt-4"}),e(o(H),{"items-per-page":o(x),"onUpdate:itemsPerPage":l[4]||(l[4]=a=>v(x)?x.value=a:null),page:o(s),"onUpdate:page":l[5]||(l[5]=a=>v(s)?s.value=a:null),headers:M,items:o(J),"items-length":o(U),class:"text-no-wrap","onUpdate:options":j},{"item.type":t(({item:a})=>[n(A(q[a.type]),1)]),"item.verbal_trial.amount":t(({item:a})=>[n(A(String(a.verbal_trial.amount).replace(/\B(?=(\d{3})+(?!\d))/g," "))+" F CFA ",1)]),"item.actions":t(({item:a})=>[e(Q,{to:{name:"notification-id",params:{id:a.id}}},{default:t(()=>[e(r,{icon:"tabler-eye"})]),_:2},1032,["to"]),e(u,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:t(()=>[e(r,{size:"24",icon:"tabler-dots-vertical"}),e(de,{activator:"parent"},{default:t(()=>[e(ce,null,{default:t(()=>[i.$can("read","guarantor")?(c(),g(pe,{key:0,inline:"",content:a.guarantors_count},{default:t(()=>[e(_,{to:{name:"notification-notification_id-guarantor",params:{notification_id:a.id}}},{prepend:t(()=>[e(r,{icon:"tabler-users"})]),default:t(()=>[e(f,null,{default:t(()=>[n(" Voir les Cautions ")]),_:1})]),_:2},1032,["to"])]),_:2},1032,["content"])):m("",!0),i.$can("read","pv")?(c(),g(_,{key:1,to:{name:"pv-id",params:{id:a.verbal_trial.id}}},{prepend:t(()=>[e(r,{icon:"tabler-eye"})]),default:t(()=>[e(f,null,{default:t(()=>[n("Voir le Pv")]),_:1})]),_:2},1032,["to"])):m("",!0),i.$can("download","notification")?(c(),F("div",be,[e(b),e(_,{onClick:B=>w(`/api/notification/download/${a.id}`,`Notification-${a.verbal_trial.committee_id}.docx`)},{prepend:t(()=>[e(r,{icon:"tabler-download"})]),default:t(()=>[e(f,null,{default:t(()=>[n("Télécharger Contrat non-signé")]),_:1})]),_:2},1032,["onClick"]),e(_,{onClick:B=>{w(`/api/contract/promissory-note/download/${a.id}`,`Billet-à-ordre-${a.verbal_trial.committee_id}.docx`)}},{prepend:t(()=>[e(r,{icon:"tabler-download"})]),default:t(()=>[e(f,null,{default:t(()=>[n("Télécharger Billet à ordre non signé")]),_:1})]),_:2},1032,["onClick"]),e(b),a.signed_contract_path?(c(),g(_,{key:0,onClick:B=>w(a.signed_contract_path,`Contrat-${a.signed_contract_path.split("/").slice(-1)[0]}`)},{prepend:t(()=>[e(r,{icon:"tabler-download"})]),default:t(()=>[e(f,null,{default:t(()=>[n("Télécharger Contrat signé")]),_:1})]),_:2},1032,["onClick"])):m("",!0),a.signed_promissory_note_path?(c(),g(_,{key:1,onClick:B=>w(a.signed_promissory_note_path,`Billet-à-ordre-${a.signed_promissory_note_path.split("/").slice(-1)[0]}`)},{prepend:t(()=>[e(r,{icon:"tabler-download"})]),default:t(()=>[e(f,null,{default:t(()=>[n("Télécharger Billet à ordre signé")]),_:1})]),_:2},1032,["onClick"])):m("",!0)])):m("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:t(()=>[e(b),p("div",ye,[p("p",he,A(o(K)({page:o(s),itemsPerPage:o(x)},o(U))),1),e(W,{modelValue:o(s),"onUpdate:modelValue":l[3]||(l[3]=a=>v(s)?s.value=a:null),length:o(D),"total-visible":i.$vuetify.display.xs?1:Math.min(o(D),5)},{prev:t(a=>[e(u,L({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[e(r,{start:"",icon:"tabler-arrow-left"}),n(" Précedent ")]),_:2},1040)]),next:t(a=>[e(u,L({variant:"tonal",color:"default"},a,{icon:!1}),{default:t(()=>[n(" Suivant "),e(r,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1})])}}},Ke=ie(Ve,[["__scopeId","data-v-2d8c6bb1"]]);export{Ke as default};
