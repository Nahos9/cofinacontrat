import{r as u}from"./validators-be8c4c00.js";import{ah as q,a1 as C,r as V,c as E,b as r,e as o,s as e,$ as ee,F as D,E as ae,n as re,o as w,a2 as le,a3 as g,M as c,f as te,x as N,N as ie,A as oe,d as T,Z as R,ai as se}from"./main-6a2f1544.js";import{_ as de}from"./AppSelect-1c872e0a.js";import{_ as ue}from"./AppAutocomplete-74b603bf.js";import{_ as ne}from"./AppDateTimePicker-864bad83.js";import{_ as me}from"./AppTextField-64ff589b.js";import{_ as pe}from"./GuaranteeEdit-51e1c042.js";import{u as U}from"./useApi-4c4343b8.js";import{c as A}from"./createUrl-4449bd6b.js";import{$ as fe}from"./api-dd65edb4.js";import{V as v}from"./VRow-af72bb7a.js";import{V as _e}from"./VSnackbar-0c4ac511.js";import{V as s}from"./VCol-01037d3b.js";import{V as ce}from"./VForm-04edc871.js";import{V as j}from"./VCard-1470a4aa.js";import{V as I}from"./VCardText-23bae783.js";import{V as Ve}from"./VAlert-4a6d2f65.js";import{V as $}from"./VSlider-6e2b5dfa.js";import{V as F}from"./VTextField-2bcae35b.js";import"./VSelect-97592589.js";import"./forwardRefs-6ea3df5c.js";import"./VList-937448c2.js";import"./VImg-6c5408fa.js";import"./VAvatar-2395aa1b.js";import"./VDivider-370c9e7d.js";import"./VOverlay-a9808ad2.js";import"./VMenu-e43d3d9d.js";import"./filter-a4d0dd7f.js";import"./AppTextarea-1fc1d6cb.js";import"./index-9c720871.js";import"./useAbility-dc299178.js";const ge={class:"my-4 ma-sm-4"},ve={class:"mt-4 ma-sm-4"},ye={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},be=T("div",{class:"d-flex flex-column justify-center"},null,-1),qe={class:"d-flex gap-4 align-center flex-wrap"},ea={__name:"[id]",async setup(we){let m,p;const P=ae(),k=re();let y="/pv";const B=[{value:"Mr",title:"Mr"},{value:"Mme",title:"Mme"},{value:"Mlle",title:"Mlle"}],z=[{value:"mensual",title:"Mensuelle"},{value:"quarterly",title:"Trimestrielle"},{value:"semi-annual",title:"Semestrielle"},{value:"annual",title:"Annuelle"},{value:"in-fine",title:"A la fin"}],{data:G}=([m,p]=q(()=>U(A("/type-of-credit",{query:{paginate:0}}))),m=await m,p(),m),O=C(()=>G.value.data),{data:H}=([m,p]=q(()=>U(A("/user",{query:{paginate:0,profile:"caf"}}))),m=await m,p(),m),Z=C(()=>H.value.data),{data:x}=([m,p]=q(()=>U(A("/user",{query:{paginate:0,profile:"credit_admin"}}))),m=await m,p(),m),J=C(()=>x.value.data),L=()=>({committee_id:"",committee_date:"",caf_id:"",civility:"",applicant_first_name:"",applicant_last_name:"",account_number:"",activity:"",purpose_of_financing:"",type_of_credit_id:"",amount:"",duration:"",periodicity:"",due_amount:"",insurance_premium:"",administrative_fees_percentage:"",taf:"",tax_fee_interest_rate:"",credit_admin_id:""}),d=V(L()),{data:K}=([m,p]=q(()=>U(A(`/verbal-trial/${k.params.id}`,{query:{with_caf:1,with_type_of_credit:1,with_guarantees:1}}))),m=await m,p(),m);var a=V(K.value.data.verbalTrial);const S=V(),Q=()=>{var i;(i=S.value)==null||i.validate().then(async({valid:l})=>{if(l){const n=await fe(`/verbal-trial/${k.params.id}`,{method:"PUT",body:{committee_id:a.value.committee_id,committee_date:a.value.committee_date,caf_id:a.value.caf_id,civility:a.value.civility,applicant_first_name:a.value.applicant_first_name,applicant_last_name:a.value.applicant_last_name,account_number:a.value.account_number,activity:a.value.activity,purpose_of_financing:a.value.purpose_of_financing,type_of_credit_id:a.value.type_of_credit_id,amount:a.value.amount,duration:a.value.duration,periodicity:a.value.periodicity,due_amount:a.value.due_amount,insurance_premium:a.value.insurance_premium,administrative_fees_percentage:a.value.administrative_fees_percentage,taf:a.value.taf,tax_fee_interest_rate:a.value.tax_fee_interest_rate,guarantees:a.value.guarantees,credit_admin_id:a.value.credit_admin_id}});if(d.value=L(),n.status==200)a.value.guarantees.forEach(f=>{f.type_of_guarantee_id==9&&(y="/pv/without-notification")}),P.push(y);else if(n.status==403){b.value=!0,M.value="";for(const f in n.errors)n.errors[f].forEach(_=>{M.value+=_+`
`})}else for(const f in n.errors)n.errors[f].forEach(_=>{d.value[f]+=_+`
`});se(()=>{})}})},W=i=>{a.value.guarantees.splice(i,1)},X=()=>{a.value.guarantees.push({type_of_guarantee_id:1,expiration_date:"",value:"",comment:""})};a.value.guarantees.forEach(i=>{i.type_of_guarantee_id==9&&(y="/pv/without-notification")});const b=V(!1),M=V("");return(i,l)=>{const n=me,f=ne,_=ue,h=de;return w(),E(D,null,[r(v,null,{default:o(()=>[r(s,{cols:"12",md:"12"},{default:o(()=>[r(ce,{ref_key:"refForm",ref:S,onSubmit:le(Q,["prevent"])},{default:o(()=>[r(v,null,{default:o(()=>[r(s,{cols:"11"},{default:o(()=>[r(g,{"prepend-icon":"tabler-arrow-narrow-left",to:e(y)},{default:o(()=>[c(" Procès verbaux ")]),_:1},8,["to"])]),_:1}),r(s,{cols:"1",class:"text-right"},{default:o(()=>[r(g,{"append-icon":"tabler-eye",to:{name:"pv-id",params:{id:e(k).params.id}}},{default:o(()=>[c(" Voir ")]),_:1},8,["to"])]),_:1})]),_:1}),r(v,null,{default:o(()=>[r(s,{md:"12"},{default:o(()=>[r(j,{class:"mb-6",title:"Modification du pv de comité"},{default:o(()=>[r(I,null,{default:o(()=>[r(v,null,{default:o(()=>[r(s,null,{default:o(()=>[e(a).status=="rejected"&&e(a).comment?(w(),te(Ve,{key:0,color:"warning"},{default:o(()=>[c(" Motif du refus : "+N(e(a).comment),1)]),_:1})):ie("",!0)]),_:1})]),_:1}),r(v,null,{default:o(()=>[r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(n,{modelValue:e(a).committee_id,"onUpdate:modelValue":l[0]||(l[0]=t=>e(a).committee_id=t),"error-messages":e(d).committee_id,label:"Numéro du comitée",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(f,{modelValue:e(a).committee_date,"onUpdate:modelValue":l[1]||(l[1]=t=>e(a).committee_date=t),"error-messages":e(d).committee_date,label:"Date du comitée",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(_,{modelValue:e(a).caf_id,"onUpdate:modelValue":l[2]||(l[2]=t=>e(a).caf_id=t),items:e(Z),"error-messages":e(d).caf_id,label:"Chargé d'affaire",placeholder:"","item-title":"full_name","item-value":"id",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(_,{modelValue:e(a).credit_admin_id,"onUpdate:modelValue":l[3]||(l[3]=t=>e(a).credit_admin_id=t),items:e(J),"error-messages":e(d).credit_adminœ_id,label:"Administrateur Crédit",placeholder:"","item-title":"full_name","item-value":"id",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(h,{modelValue:e(a).civility,"onUpdate:modelValue":l[4]||(l[4]=t=>e(a).civility=t),items:B,"error-messages":e(d).civility,label:"Civilité",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(n,{modelValue:e(a).applicant_first_name,"onUpdate:modelValue":l[5]||(l[5]=t=>e(a).applicant_first_name=t),"error-messages":e(d).applicant_first_name,label:"Prénom du demandeur",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(n,{modelValue:e(a).applicant_last_name,"onUpdate:modelValue":l[6]||(l[6]=t=>e(a).applicant_last_name=t),"error-messages":e(d).applicant_last_name,label:"Nom du demandeur",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(n,{modelValue:e(a).account_number,"onUpdate:modelValue":l[7]||(l[7]=t=>e(a).account_number=t),"error-messages":e(d).account_number,label:"Numéro de compte",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(n,{modelValue:e(a).activity,"onUpdate:modelValue":l[8]||(l[8]=t=>e(a).activity=t),"error-messages":e(d).activity,label:"Activé",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(n,{modelValue:e(a).purpose_of_financing,"onUpdate:modelValue":l[9]||(l[9]=t=>e(a).purpose_of_financing=t),"error-messages":e(d).purpose_of_financing,label:"Objet du financement",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(_,{modelValue:e(a).type_of_credit_id,"onUpdate:modelValue":l[10]||(l[10]=t=>e(a).type_of_credit_id=t),items:e(O),"error-messages":e(d).type_of_credit_id,label:"Type de credit",placeholder:"","item-title":"name","item-value":"id",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","items","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(n,{modelValue:e(a).amount,"onUpdate:modelValue":l[11]||(l[11]=t=>e(a).amount=t),type:"number","error-messages":e(d).amount,label:"Montant",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(n,{modelValue:e(a).due_amount,"onUpdate:modelValue":l[12]||(l[12]=t=>e(a).due_amount=t),type:"number","error-messages":e(d).due_amount,label:"Montant des interêts",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(n,{modelValue:e(a).duration,"onUpdate:modelValue":l[13]||(l[13]=t=>e(a).duration=t),type:"number","error-messages":e(d).duration,label:"Durée du crédit en mois",placeholder:"","append-inner-icon":"tabler-calendar",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"6",lg:"4"},{default:o(()=>[r(h,{modelValue:e(a).periodicity,"onUpdate:modelValue":l[14]||(l[14]=t=>e(a).periodicity=t),items:z,"error-messages":e(d).periodicity,label:"Periodicité",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12",md:"12",lg:"4"},{default:o(()=>[r(n,{modelValue:e(a).insurance_premium,"onUpdate:modelValue":l[15]||(l[15]=t=>e(a).insurance_premium=t),type:"number","error-messages":e(d).insurance_premium,label:"Prime d'assurance",placeholder:"",rules:["requiredValidator"in i?i.requiredValidator:e(u)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12"},{default:o(()=>[r($,{modelValue:e(a).taf,"onUpdate:modelValue":l[17]||(l[17]=t=>e(a).taf=t),label:"TAF(%)","error-messages":e(d).taf,"thumb-size":15,"thumb-label":"always",rules:["requiredValidator"in i?i.requiredValidator:e(u)],step:"0.1"},{append:o(()=>[r(F,{modelValue:e(a).taf,"onUpdate:modelValue":l[16]||(l[16]=t=>e(a).taf=t),"error-messages":e(d).taf,type:"number",style:{width:"80px"},density:"compact","hide-details":"",variant:"outlined",suffix:"%"},null,8,["modelValue","error-messages"])]),_:1},8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12"},{default:o(()=>[r($,{modelValue:e(a).administrative_fees_percentage,"onUpdate:modelValue":l[19]||(l[19]=t=>e(a).administrative_fees_percentage=t),label:"Frais de dossier(%)","error-messages":e(d).administrative_fees_percentage,"thumb-size":15,"thumb-label":"always",rules:["requiredValidator"in i?i.requiredValidator:e(u)],step:"0.1"},{append:o(()=>[r(F,{modelValue:e(a).administrative_fees_percentage,"onUpdate:modelValue":l[18]||(l[18]=t=>e(a).administrative_fees_percentage=t),"error-messages":e(d).administrative_fees_percentage,type:"number",style:{width:"80px"},density:"compact","hide-details":"",variant:"outlined",suffix:"%"},null,8,["modelValue","error-messages"])]),_:1},8,["modelValue","error-messages","rules"])]),_:1}),r(s,{cols:"12"},{default:o(()=>[r($,{modelValue:e(a).tax_fee_interest_rate,"onUpdate:modelValue":l[21]||(l[21]=t=>e(a).tax_fee_interest_rate=t),label:"Taux d'intérêt HT(%)","error-messages":e(d).tax_fee_interest_rate,"thumb-size":15,"thumb-label":"always",rules:["requiredValidator"in i?i.requiredValidator:e(u)],step:"0.1"},{append:o(()=>[r(F,{modelValue:e(a).tax_fee_interest_rate,"onUpdate:modelValue":l[20]||(l[20]=t=>e(a).tax_fee_interest_rate=t),"error-messages":e(d).tax_fee_interest_rate,type:"number",style:{width:"80px"},density:"compact","hide-details":"",variant:"outlined",suffix:"%"},null,8,["modelValue","error-messages"])]),_:1},8,["modelValue","error-messages","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),r(j,{class:"mb-6",title:"Information des cautionies"},{default:o(()=>[r(I,{class:"add-products-form"},{default:o(()=>[(w(!0),E(D,null,oe(e(a).guarantees,(t,Y)=>(w(),E("div",ge,[r(pe,{id:Y,data:t,onRemoveGuarantee:W},null,8,["id","data"])]))),256)),T("div",ve,[r(g,{"prepend-icon":"tabler-plus",onClick:X},{default:o(()=>[c(" Ajouter ")]),_:1})])]),_:1})]),_:1})]),_:1}),r(s,{cols:"12"},{default:o(()=>[T("div",ye,[be,T("div",qe,[r(g,{type:"reset",variant:"tonal",color:"primary"},{default:o(()=>[r(R,{start:"",icon:"tabler-circle-minus"}),c(" Effacer ")]),_:1}),r(g,{type:"submit",class:"me-3"},{default:o(()=>[c(" Enregistrer "),r(R,{end:"",icon:"tabler-checkbox"})]),_:1})])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),r(_e,{modelValue:e(b),"onUpdate:modelValue":l[22]||(l[22]=t=>ee(b)?b.value=t:null),transition:"scroll-y-reverse-transition",location:"bottom end",color:"error"},{default:o(()=>[c(N(e(M)),1)]),_:1},8,["modelValue"])],64)}}};export{ea as default};
