import{r as i}from"./validators-be8c4c00.js";import{r as v,w as j,ah as N,a1 as D,c as F,b as r,e as s,a2 as B,n as L,E as P,o as G,s as u,d as _,a3 as k,Z as A,M as U,C as M,D as O,ai as Z}from"./main-6a2f1544.js";import{_ as z}from"./AppTextarea-1fc1d6cb.js";import{_ as H}from"./AppSelect-1c872e0a.js";import{_ as J}from"./AppDateTimePicker-864bad83.js";import{_ as K}from"./AppAutocomplete-74b603bf.js";import{_ as Q}from"./AppTextField-64ff589b.js";import{u as W}from"./useApi-4c4343b8.js";import{c as X}from"./createUrl-4449bd6b.js";import{$ as Y}from"./api-dd65edb4.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import{V as h}from"./VRow-af72bb7a.js";import{V as re}from"./VForm-04edc871.js";import{V as o}from"./VCol-01037d3b.js";import{V as ae}from"./VCard-1470a4aa.js";import{V as te}from"./VCardText-23bae783.js";import"./VTextField-2bcae35b.js";import"./VImg-6c5408fa.js";import"./forwardRefs-6ea3df5c.js";import"./VSelect-97592589.js";import"./VList-937448c2.js";import"./VAvatar-2395aa1b.js";import"./VDivider-370c9e7d.js";import"./VOverlay-a9808ad2.js";import"./VMenu-e43d3d9d.js";import"./filter-a4d0dd7f.js";import"./index-9c720871.js";import"./useAbility-dc299178.js";const C=V=>(M("data-v-5c8726f3"),V=V(),O(),V),le=C(()=>_("div",{class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},[_("div",{class:"d-flex flex-column justify-center"},[_("h4",{class:"text-h4 font-weight-medium"},"Ajouter un nouveau CAT")])],-1)),se={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},oe=C(()=>_("div",{class:"d-flex flex-column justify-center"},null,-1)),de={class:"d-flex gap-4 align-center flex-wrap"},ue={__name:"add",async setup(V){let g,q;const x=L(),T=P(),e=v({contract_id:null,credit_number:"",sector:"",code_sector:"",first_deadline:"",last_deadline:"",source_of_reimbursement:"",instructions_from_the_risk_and_credit_department:"",outstanding_number_ready_to_settle:null,other_expenses:null,teg:null}),c=v(""),p=v(null),S=async()=>{if(c.value){const a=await fetch(`/api/clients/prets?search=${encodeURIComponent(c.value)}`);if(!a.ok)throw new Error("Erreur lors de la récupération des données");return await a.json()}};j(c,async a=>{a?(p.value=await S(),console.log("dans le wacth",p.value),e.value.first_deadline=p.value.data.data[0].d_prem_ech,e.value.last_deadline=p.value.data.data[0].d_der_trch,e.value.other_expenses=p.value.data.data[0].mt_fraiaut):clientsList.value=[]});const w=()=>({contract_id:"",credit_number:"",sector:"",code_sector:"",first_deadline:"",last_deadline:"",source_of_reimbursement:"",instructions_from_the_risk_and_credit_department:"",outstanding_number_ready_to_settle:"",other_expenses:"",teg:""}),d=v(w()),{data:I}=([g,q]=N(()=>W(X("/contract",{query:{paginate:0,with_verbal_trial:1,has_upload_completed:1,has_cat:0,status:"v"}}))),g=await g,q(),g),E=D(()=>I.value.data),b=v(),R=()=>{var a;(a=b.value)==null||a.validate().then(async({valid:t})=>{if(t){const n={contract_id:e.value.contract_id,credit_number:e.value.credit_number,sector:e.value.sector,code_sector:e.value.code_sector,first_deadline:e.value.first_deadline,last_deadline:e.value.last_deadline,source_of_reimbursement:e.value.source_of_reimbursement,instructions_from_the_risk_and_credit_department:e.value.instructions_from_the_risk_and_credit_department,outstanding_number_ready_to_settle:e.value.outstanding_number_ready_to_settle,other_expenses:e.value.other_expenses,teg:e.value.teg},f=await Y("/cat",{method:"POST",body:n});if(d.value=w(),f.status==201)T.push("/cat");else for(const m in f.errors)f.errors[m].forEach(y=>{d.value[m]+=y+`
`});Z(()=>{var m;(m=b.value)==null||m.resetValidation()})}})};if(x.query.id){const a=parseInt(x.query.id);E.value.find(t=>t.id==a)&&(e.value.contract_id=a)}return(a,t)=>{const n=Q,f=K,m=J,y=H,$=z;return G(),F("div",null,[le,r(h,null,{default:s(()=>[r(o,{cols:"12",md:"6",lg:"4"},{default:s(()=>[r(n,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=l=>c.value=l),label:"Numéro du prêt"},null,8,["modelValue"])]),_:1})]),_:1}),r(re,{ref_key:"refForm",ref:b,onSubmit:B(R,["prevent"])},{default:s(()=>[r(h,null,{default:s(()=>[r(o,{md:"12"},{default:s(()=>[r(ae,{class:"mb-6",title:"Information sur CAT "},{default:s(()=>[r(te,null,{default:s(()=>[r(h,null,{default:s(()=>[r(o,{cols:"12",md:"12",lg:"12"},{default:s(()=>[r(f,{modelValue:e.value.contract_id,"onUpdate:modelValue":t[1]||(t[1]=l=>e.value.contract_id=l),items:u(E),"error-messages":d.value.contract_id,label:"Contrat",placeholder:"Ex: CFNTG-044-13-12-23-01212",rules:["requiredValidator"in a?a.requiredValidator:u(i)],"item-title":"verbal_trial.label","item-value":"id"},null,8,["modelValue","items","error-messages","rules"])]),_:1}),r(o,{cols:"12",md:"6",lg:"6"},{default:s(()=>[r(n,{modelValue:e.value.credit_number,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.credit_number=l),"error-messages":d.value.credit_number,label:"Numéro du crédit",placeholder:"Ex: 485632",rules:["requiredValidator"in a?a.requiredValidator:u(i)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(o,{cols:"12",md:"6",lg:"6"},{default:s(()=>[r(n,{modelValue:e.value.sector,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.sector=l),"error-messages":d.value.sector,label:"Secteur",placeholder:"Ex: Agriculture",rules:["requiredValidator"in a?a.requiredValidator:u(i)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(o,{cols:"12",md:"6",lg:"6"},{default:s(()=>[r(n,{modelValue:e.value.code_sector,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.code_sector=l),"error-messages":d.value.sector,label:"Code secteur",placeholder:"Ex: 80967",rules:["requiredValidator"in a?a.requiredValidator:u(i)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(o,{cols:"12",md:"6",lg:"6"},{default:s(()=>[r(m,{modelValue:e.value.first_deadline,"onUpdate:modelValue":t[5]||(t[5]=l=>e.value.first_deadline=l),"error-messages":d.value.first_deadline,label:"Date de première échéance",placeholder:"Ex: 2024-02-02",rules:["requiredValidator"in a?a.requiredValidator:u(i)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(o,{cols:"12",md:"6",lg:"6"},{default:s(()=>[r(m,{modelValue:e.value.last_deadline,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.last_deadline=l),"error-messages":d.value.last_deadline,label:"Date de dernière échéance",placeholder:"Ex: 2024-02-02",rules:["requiredValidator"in a?a.requiredValidator:u(i)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(o,{cols:"12",md:"6",lg:"6"},{default:s(()=>[r(y,{modelValue:e.value.source_of_reimbursement,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.source_of_reimbursement=l),items:[{value:"revenue_from_the_activity",title:"Recettes de l’activité"},{value:"final_payer_settlement",title:"Règlement du payeur final"},{value:"resale_of_goods",title:"Reventes des marchandises"},{value:"salary",title:"Salaire"}],"error-messages":d.value.source_of_reimbursement,label:"Source du remboursement",placeholder:"Ex: Recettes de l’activité",rules:["requiredValidator"in a?a.requiredValidator:u(i)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(o,{cols:"12",md:"6",lg:"6"},{default:s(()=>[r(n,{modelValue:e.value.outstanding_number_ready_to_settle,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.outstanding_number_ready_to_settle=l),"error-messages":d.value.outstanding_number_ready_to_settle,label:"Numéro encours prêt à solder",placeholder:"Ex:24300000 ",rules:["requiredValidator"in a?a.requiredValidator:u(i)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(o,{cols:"12",md:"6",lg:"6"},{default:s(()=>[r(n,{type:"number",modelValue:e.value.other_expenses,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.other_expenses=l),"error-messages":d.value.other_expenses,label:"Autres frais",placeholder:"Ex: 554000",rules:["requiredValidator"in a?a.requiredValidator:u(i)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(o,{cols:"12",md:"6",lg:"6"},{default:s(()=>[r(n,{type:"number",modelValue:e.value.teg,"onUpdate:modelValue":t[10]||(t[10]=l=>e.value.teg=l),"error-messages":d.value.teg,label:"TEG",placeholder:"Ex: 15000600",rules:["requiredValidator"in a?a.requiredValidator:u(i)]},null,8,["modelValue","error-messages","rules"])]),_:1}),r(o,{cols:"12",md:"12",lg:"12"},{default:s(()=>[r($,{modelValue:e.value.instructions_from_the_risk_and_credit_department,"onUpdate:modelValue":t[11]||(t[11]=l=>e.value.instructions_from_the_risk_and_credit_department=l),"error-messages":d.value.instructions_from_the_risk_and_credit_department,label:"Instructions du département risque et crédit",placeholder:"Ex: ",rules:["requiredValidator"in a?a.requiredValidator:u(i)],clearable:"",counter:""},null,8,["modelValue","error-messages","rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(o,{cols:"12"},{default:s(()=>[_("div",se,[oe,_("div",de,[r(k,{type:"reset",variant:"tonal",color:"primary"},{default:s(()=>[r(A,{start:"",icon:"tabler-circle-minus"}),U(" Effacer ")]),_:1}),r(k,{type:"submit",class:"me-3"},{default:s(()=>[U(" Enregistrer "),r(A,{end:"",icon:"tabler-checkbox"})]),_:1})])])]),_:1})]),_:1})]),_:1},512)])}}},De=ee(ue,[["__scopeId","data-v-5c8726f3"]]);export{De as default};
