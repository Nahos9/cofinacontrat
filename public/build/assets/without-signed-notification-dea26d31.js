import{_ as me}from"./AppTextarea-1fc1d6cb.js";import{_ as _e}from"./DialogCloseBtn-0ca9fab8.js";import{V as ge,p as ye,a as be}from"./VPagination-0092c9d5.js";import{J as he}from"./js-file-downloader-ac243d32.js";import{$ as X}from"./api-dd65edb4.js";import{r as c,ah as Ve,a1 as M,c as h,b as a,e as t,s as n,$ as T,E as ke,a as we,o as s,d as f,a3 as y,M as l,f as d,N as r,Z as u,x as m,F as $e,A as Ce,z as Y,aa as ee,C as xe,D as Te}from"./main-6a2f1544.js";import{u as je}from"./useApi-4c4343b8.js";import{c as Se}from"./createUrl-4449bd6b.js";import{_ as Ae}from"./_plugin-vue_export-helper-c27b6911.js";import{V as O}from"./VCard-1470a4aa.js";import{V as Ie}from"./VDialog-f45cfaf5.js";import{V as z}from"./VCardText-23bae783.js";import{V as te}from"./VRow-af72bb7a.js";import{V as Pe}from"./VSpacer-7047fa05.js";import{V}from"./VDivider-370c9e7d.js";import{V as ae,b as k,a as b}from"./VList-937448c2.js";import{V as oe}from"./VSelect-97592589.js";import{V as w}from"./VTooltip-3d210fe7.js";import{V as De}from"./VMenu-e43d3d9d.js";import{V as Ne}from"./VBadge-e6c9f950.js";import{V as Be}from"./VCol-01037d3b.js";import"./VTextField-2bcae35b.js";import"./VImg-6c5408fa.js";import"./forwardRefs-6ea3df5c.js";import"./VTable-d0bad554.js";import"./filter-a4d0dd7f.js";import"./index-9c720871.js";import"./useAbility-dc299178.js";import"./VAvatar-2395aa1b.js";import"./VOverlay-a9808ad2.js";const ne=j=>(xe("data-v-c10e4476"),j=j(),Te(),j),Ee=ne(()=>f("h2",null," Liste des contrats ",-1)),Re={class:"d-flex flex-wrap gap-4 mt-4 mx-5"},Ue=ne(()=>f("div",{class:"d-flex align-center"},null,-1)),ze={class:"d-flex gap-4 flex-wrap align-center"},Fe={class:"custom-loader"},Le=["onInput"],Me={key:2},Oe={key:3},Je={key:0},qe={key:1},Qe={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Ze={class:"text-sm text-medium-emphasis mb-0"},Ge={__name:"without-signed-notification",async setup(j){let S,J;const ie=ke(),le=c(),se=c(""),q=c(),Q=c("signed_notification"),A=c([]),I=c(8),_=c(1),P=c(0),v=c(!1),D=c(""),N=c(""),B=c(""),E=c(),$=c(""),R=c(!1),U=c("waiting"),re=[{title:"Numéro comitée",key:"verbal_trial.committee_id"},{title:"Admin Crédit",key:"creator.full_name"},{title:"Nom client",key:"verbal_trial.applicant_full_name"},{title:"Téléphone",key:"representative_phone_number"},{title:"Montant",key:"verbal_trial.amount"},{title:"Observations",key:"observations"},{title:"Actions",key:"actions",sortable:!1}],{data:F,execute:C}=([S,J]=Ve(()=>je(Se("/notification",{query:{search:se,type:le,page:_,with_type_of_credit:1,with_company:1,with_individual_business:1,with_creator:1,head_credit_validation:"v",has_cat:0,is_simple:1}}))),S=await S,J(),S),ce=o=>{A.value[o]=!0,setTimeout(()=>{A.value[o]=!1},1e3)},ue=o=>{_.value=o.page},de={company:"Société",individual_business:"Entreprise Individuel",particular:"Particulier"},Z=async(o,i)=>{try{new he({url:o,headers:[{name:"Authorization",value:`Bearer ${ee("userToken").value}`},{name:"Accept",value:"application/json"}],nameCallback:function(p){return i}}),C()}catch(p){console.error("Erreur lors du téléchargement:",p)}},G=async o=>{await X(`notification/change-status/${o}`,{method:"PUT",body:{status:U.value,comment:$.value}}),$.value="",U.value=="validated"&&ie.push(`/cat/simple-notification/add?id=${o}`),C()},pe=async o=>{await X(`notification/send/${o}`,{method:"PUT"}),C()},fe=async(o,i)=>{const{files:p}=i.target;if(p&&p.length===1){const x=new FileReader;x.onload=async()=>{const L=x.result;try{(await fetch(`/api/notification/upload/${o}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ee("userToken").value}`},body:JSON.stringify({[Q.value]:L})})).ok?(console.log("Document envoyé avec succès."),C()):console.error("Échec de l'envoi du document.")}catch(e){console.error("Erreur lors de l'envoi du document:",e)}},x.readAsDataURL(p[0])}else console.error("Veuillez sélectionner un seul fichier.")},ve=M(()=>F.value.data),H=M(()=>F.value.total),K=M(()=>F.value.last_page);return(o,i)=>{const p=we("IconBtn"),x=_e,L=me;return s(),h("div",null,[a(O,{class:"mb-6"},{default:t(()=>[a(z,null,{default:t(()=>[a(te,null,{default:t(()=>[a(z,null,{default:t(()=>[Ee]),_:1})]),_:1})]),_:1})]),_:1}),a(O,{class:"mb-6"},{default:t(()=>[f("div",Re,[Ue,a(Pe),f("div",ze,[a(y,{variant:"tonal",color:"secondary","prepend-icon":"tabler-download"},{default:t(()=>[l(" Export ")]),_:1}),o.$can("create","notification")?(s(),d(y,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"simple-notification-add"}},{default:t(()=>[l(" Ajouter ")]),_:1})):r("",!0),a(y,{loading:n(A)[3],disabled:n(A)[3],"prepend-icon":"tabler-refresh",onClick:i[0]||(i[0]=e=>{n(C)(),ce(3)})},{loader:t(()=>[f("span",Fe,[a(u,{icon:"tabler-refresh"})])]),default:t(()=>[l(" Recharger ")]),_:1},8,["loading","disabled"])])]),a(V,{class:"mt-4"}),a(n(ge),{"items-per-page":n(I),"onUpdate:itemsPerPage":i[3]||(i[3]=e=>T(I)?I.value=e:null),page:n(_),"onUpdate:page":i[4]||(i[4]=e=>T(_)?_.value=e:null),headers:re,items:n(ve),"items-length":n(H),class:"text-no-wrap","onUpdate:options":ue},{"item.type":t(({item:e})=>[l(m(de[e.type]),1)]),"item.verbal_trial.amount":t(({item:e})=>[l(m(String(e.verbal_trial.amount).replace(/\B(?=(\d{3})+(?!\d))/g," "))+" F CFA ",1)]),"item.observations":t(({item:e})=>[a(ae,{density:" compact"},{default:t(()=>[e.observations.length>0?(s(!0),h($e,{key:0},Ce(e.observations,g=>(s(),d(b,null,{default:t(()=>[a(k,null,{default:t(()=>[a(oe,{label:""},{default:t(()=>[l(m(g),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256)):r("",!0),e.observations.length==0?(s(),d(b,{key:1},{default:t(()=>[a(oe,{label:"",color:{validated:"success",rejected:"error",waiting:e.sent?"warning":"success"}[e.status]},{default:t(()=>[e.status?(s(),d(w,{key:0,activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[l(" Raison: "+m(e.status_observation),1)]),_:2},1024)):r("",!0),l(" "+m(e.status=="validated"?"Dossier validé":null)+" "+m(e.status=="waiting"?e.sent?"Dossier en attente de validation":"Dossier prêt":null)+" "+m(e.status=="rejected"?"Dossier rejeté":null),1)]),_:2},1032,["color"])]),_:2},1024)):r("",!0)]),_:2},1024)]),"item.actions":t(({item:e})=>[f("span",null,[a(p,{to:{name:"simple-notification-id",params:{id:e.id}}},{default:t(()=>[a(w,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[l("Details")]),_:1}),a(u,{icon:"tabler-eye"})]),_:2},1032,["to"]),a(y,{icon:"",variant:"text",size:"small",color:"medium-emphasis"},{default:t(()=>[a(u,{size:"24",icon:"tabler-dots-vertical"}),a(De,{activator:"parent"},{default:t(()=>[a(ae,null,{default:t(()=>[f("input",{ref_key:"refInputEl",ref:q,type:"file",name:"signed_notification",accept:".pdf,.png,.jpg",hidden:"",onInput:g=>fe(e.id,g)},null,40,Le),o.$can("read","guarantor")?(s(),d(Ne,{key:0,inline:"",content:e.guarantors_count},{default:t(()=>[a(b,{to:{name:"simple-notification-notification_id-guarantor",params:{notification_id:e.id}}},{prepend:t(()=>[a(u,{icon:"tabler-users"})]),default:t(()=>[a(k,null,{default:t(()=>[l(" Voir les Cautions ")]),_:1})]),_:2},1032,["to"])]),_:2},1032,["content"])):r("",!0),o.$can("read","pv")?(s(),d(b,{key:1,to:{name:"pv-id",params:{id:e.verbal_trial.id}}},{prepend:t(()=>[a(u,{icon:"tabler-eye"})]),default:t(()=>[a(k,null,{default:t(()=>[l("Voir le Pv")]),_:1})]),_:2},1032,["to"])):r("",!0),o.$can("download","notification")?(s(),h("span",Me,[f("span",null,[a(V),a(b,{onClick:g=>{Z(`/api/notification/download/${e.id}`,`Notification-${e.verbal_trial.committee_id}.docx`)}},{prepend:t(()=>[a(u,{icon:"tabler-download"})]),default:t(()=>[a(k,null,{default:t(()=>[l("Télécharger Notification non signé")]),_:1})]),_:2},1032,["onClick"])]),f("span",null,[a(V),e.signed_notification_path?(s(),d(b,{key:0,onClick:g=>Z(e.signed_notification_path,`Notification-${e.signed_notification_path.split("/").slice(-1)[0]}`)},{prepend:t(()=>[a(u,{icon:"tabler-download"})]),default:t(()=>[a(k,null,{default:t(()=>[l("Télécharger Notification signé")]),_:1})]),_:2},1032,["onClick"])):r("",!0)])])):r("",!0),o.$can("upload","notification")?(s(),h("span",Oe,[e.signed_notification_path==null||e.status=="rejected"?(s(),d(b,{key:0,onClick:i[1]||(i[1]=g=>{var W;Q.value="signed_notification",(W=n(q))==null||W.click()})},{prepend:t(()=>[a(u,{icon:"tabler-cloud-upload"})]),default:t(()=>[a(k,{color:"error"},{default:t(()=>[l("Ajouter notification signé")]),_:1})]),_:1})):r("",!0)])):r("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),e.observations.length==0&&o.$can("send","notification")?(s(),h("span",Je,[a(V),a(te,null,{default:t(()=>[a(Be,{col:"12",class:"text-center"},{default:t(()=>[e.sent?r("",!0):(s(),d(p,{key:0,onClick:g=>{P.value=e.id,D.value="Envoyer le dossier de la notification",N.value="Voulez vous vraiment envoyer le dossier de cette notification?",E.value=pe,B.value="Envoyer",R.value=!1,v.value=!0}},{default:t(()=>[a(w,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[l("Envoyer")]),_:1}),a(u,{icon:"tabler-send",color:"success"})]),_:2},1032,["onClick"]))]),_:2},1024)]),_:2},1024)])):r("",!0),e.sent&&(o.$can("reject","pv")&&e.status!="rejected"&&e.observations.length==0||o.$can("validate","pv")&&e.status=="waiting"&&e.observations.length==0||o.$can("create","cat")&&e.status=="validated")?(s(),h("span",qe,[a(V),o.$can("reject","pv")&&e.status!="rejected"&&e.observations.length==0?(s(),d(p,{key:0,onClick:g=>{P.value=e.id,D.value="Rejeter la notification",N.value="Voulez vous vraiment rejeter cette notification?",E.value=G,B.value="Rejeter",R.value=!0,U.value="rejected",v.value=!0}},{default:t(()=>[a(w,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:t(()=>[l("Rejeter")]),_:1}),a(u,{icon:"tabler-x",color:"error"})]),_:2},1032,["onClick"])):r("",!0),o.$can("validate","pv")&&e.status=="waiting"&&e.observations.length==0?(s(),d(p,{key:1,onClick:g=>{P.value=e.id,D.value="Valider la notification",N.value="Voulez vous vraiment valider cette notification?",E.value=G,B.value="Valider",R.value=!1,U.value="validated",v.value=!0}},{default:t(()=>[a(w,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:t(()=>[l("Valider")]),_:1}),a(u,{icon:"tabler-check",color:"success"})]),_:2},1032,["onClick"])):r("",!0),o.$can("create","cat")&&e.status=="validated"?(s(),d(p,{key:2,to:{name:"cat-simple-notification-add",query:{id:e.id}}},{default:t(()=>[a(w,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:t(()=>[l("Créer le CAT")]),_:1}),a(u,{icon:"tabler-file-plus",color:"success"})]),_:2},1032,["to"])):r("",!0)])):r("",!0)]),bottom:t(()=>[a(V),f("div",Qe,[f("p",Ze,m(n(ye)({page:n(_),itemsPerPage:n(I)},n(H))),1),a(be,{modelValue:n(_),"onUpdate:modelValue":i[2]||(i[2]=e=>T(_)?_.value=e:null),length:n(K),"total-visible":o.$vuetify.display.xs?1:Math.min(n(K),5)},{prev:t(e=>[a(y,Y({variant:"tonal",color:"default"},e,{icon:!1}),{default:t(()=>[a(u,{start:"",icon:"tabler-arrow-left"}),l(" Précedent ")]),_:2},1040)]),next:t(e=>[a(y,Y({variant:"tonal",color:"default"},e,{icon:!1}),{default:t(()=>[l(" Suivant "),a(u,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),a(Ie,{modelValue:n(v),"onUpdate:modelValue":i[9]||(i[9]=e=>T(v)?v.value=e:null),class:"v-dialog-sm"},{default:t(()=>[a(x,{onClick:i[5]||(i[5]=e=>v.value=!n(v))}),a(O,{title:n(D)},{default:t(()=>[a(z,null,{default:t(()=>[l(m(n(N))+" ",1),n(R)?(s(),d(L,{key:0,class:"mt-3",modelValue:n($),"onUpdate:modelValue":i[6]||(i[6]=e=>T($)?$.value=e:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):r("",!0)]),_:1}),a(z,{class:"d-flex justify-end gap-3 flex-wrap"},{default:t(()=>[a(y,{color:"secondary",variant:"tonal",onClick:i[7]||(i[7]=e=>v.value=!1)},{default:t(()=>[l(" Annuler ")]),_:1}),a(y,{onClick:i[8]||(i[8]=e=>{n(E)(n(P)),v.value=!1})},{default:t(()=>[l(m(n(B)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}},Ct=Ae(Ge,[["__scopeId","data-v-c10e4476"]]);export{Ct as default};
