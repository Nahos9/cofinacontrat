import{_ as me}from"./AppTextarea-d5f5c9c0.js";import{_ as ve}from"./DialogCloseBtn-675f2a41.js";import{_ as fe}from"./AppTextField-a55c9046.js";import{V as _e,p as Ve,a as ye}from"./paginationMeta-07ed5d9a.js";import{_ as be}from"./AppAutocomplete-f77f60bd.js";import{J as ge}from"./js-file-downloader-a589705c.js";import{$ as G}from"./api-250e6840.js";import{E as ke,r,ah as H,a1 as F,o as i,c as h,b as e,e as a,s as l,$ as _,a as he,aT as $e,d as b,a3 as g,M as s,f as p,N as u,Z as m,x as V,v as we,z as K,aa as Ce,C as xe,D as Pe}from"./main-46a0c5a9.js";import{u as W}from"./useApi-c189fb4c.js";import{c as X}from"./createUrl-6209637a.js";import{_ as Te}from"./_plugin-vue_export-helper-c27b6911.js";import{V as J}from"./VCard-8818643c.js";import{V as je}from"./VDialog-921babe5.js";import{V as $}from"./VCardText-f76baed7.js";import{V as Y}from"./VRow-488997f5.js";import{V as ee}from"./VCol-da704454.js";import{V as Se,a as De}from"./VSelect-f97bd02e.js";import{V as w}from"./VDivider-ea070f60.js";import{V as Ae}from"./VSpacer-ebbfe3e6.js";import{V as y}from"./VTooltip-130774d8.js";import"./VTextField-1e15a30a.js";import"./VImg-1082f317.js";import"./forwardRefs-6ea3df5c.js";import"./VTable-36ef90f3.js";import"./filter-bf73ada6.js";import"./VList-139817d9.js";import"./VAvatar-de3ccc2c.js";import"./VMenu-6d187744.js";import"./VOverlay-0594322e.js";import"./index-9c720871.js";import"./useAbility-241c7a17.js";const Re=C=>(xe("data-v-9bb24407"),C=C(),Pe(),C),Ue=Re(()=>b("h2",null," Liste des Procès verbaux sans contrat ",-1)),Be={class:"d-flex flex-wrap gap-4 mx-5"},Ee={class:"d-flex align-center"},Ie={class:"d-flex gap-4 flex-wrap align-center"},ze={class:"custom-loader"},Fe={key:0},Ne={key:1},Me={key:1},qe={key:2},Le={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Je={class:"text-sm text-medium-emphasis mb-0"},Oe={__name:"historical",async setup(C){let f,x;const te=ke(),P=r(),T=r(),j=r(""),S=r([]),D=r(8),v=r(1),A=r(0),d=r(!1),R=r(""),U=r(""),B=r(""),E=r(),k=r(""),I=r(!1),z=r("waiting"),ae=[{title:"Numéro comitée",key:"committee_id"},{title:"client",key:"applicant_full_name"},{title:"Type Credit",key:"type_of_credit.full_name"},{title:"Montant",key:"amount_fr"},{title:"CAF",key:"caf.full_name"},{title:"Statut",key:"status"},{title:"Actions",key:"actions",sortable:!1}],{data:N,execute:M}=([f,x]=H(()=>W(X("/verbal-trial",{query:{search:j,type_of_credit_id:P,status:T,page:v,has_contract:0,has_notification:0,has_mortgage:0,with_caf:1,with_type_of_credit:1}}))),f=await f,x(),f),{data:le}=([f,x]=H(()=>W(X("/type-of-credit",{query:{paginate:0}}))),f=await f,x(),f),oe=o=>{S.value[o]=!0,setTimeout(()=>{S.value[o]=!1},1e3)},ne=o=>{v.value=o.page},se=async(o,n)=>{const q=Ce("userToken").value;try{new ge({url:o,headers:[{name:"Authorization",value:`Bearer ${q}`},{name:"Accept",value:"application/json"}],nameCallback:function(c){return n}})}catch(c){console.error("Erreur lors du téléchargement:",c)}},re=async o=>{await G(`verbal-trial/${o}`,{method:"DELETE"}),k.value="",M()},O=async o=>{await G(`verbal-trial/change-status/${o}`,{method:"PUT",body:{status:z.value,comment:k.value}}),k.value="",z.value=="validated"&&te.push(`/contract/add?id=${o}`),M()},ie=F(()=>N.value.data),Q=F(()=>N.value.total),Z=F(()=>N.value.last_page),ue=F(()=>le.value.data);return(o,n)=>{const q=fe,c=he("IconBtn"),de=ve,ce=me,pe=$e("tooltip");return i(),h("div",null,[e(J,{class:"mb-6"},{default:a(()=>[e($,null,{default:a(()=>[e(Y,null,{default:a(()=>[e($,null,{default:a(()=>[Ue]),_:1})]),_:1})]),_:1})]),_:1}),e(J,{title:"Filtres",class:"mb-6"},{default:a(()=>[e($,null,{default:a(()=>[e(Y,null,{default:a(()=>[e(ee,{cols:"12",sm:"4"},{default:a(()=>[e(be,{modelValue:l(P),"onUpdate:modelValue":n[0]||(n[0]=t=>_(P)?P.value=t:null),placeholder:"Type de crédit","item-title":"full_name","item-value":"id",items:l(ue),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(ee,{cols:"12",sm:"4"},{default:a(()=>[e(Se,{modelValue:l(T),"onUpdate:modelValue":n[1]||(n[1]=t=>_(T)?T.value=t:null),placeholder:"Statut",items:[{value:"v",title:"Validé"},{value:"w",title:"En attente"},{value:"r",title:"Rejeté"}],"clear-icon":"tabler-x",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(w,{class:"my-4"}),b("div",Be,[b("div",Ee,[e(q,{modelValue:l(j),"onUpdate:modelValue":n[2]||(n[2]=t=>_(j)?j.value=t:null),placeholder:"Rechercher un pv",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(Ae),b("div",Ie,[e(g,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:a(()=>[s(" Export ")]),_:1}),o.$can("create","pv")?(i(),p(g,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"pv-add"}},{default:a(()=>[s(" Ajouter ")]),_:1})):u("",!0),e(g,{loading:l(S)[3],disabled:l(S)[3],"prepend-icon":"tabler-refresh",onClick:n[3]||(n[3]=t=>{l(M)(),oe(3)})},{loader:a(()=>[b("span",ze,[e(m,{icon:"tabler-refresh"})])]),default:a(()=>[s(" Recharger ")]),_:1},8,["loading","disabled"])])]),e(w,{class:"mt-4"}),e(l(_e),{"items-per-page":l(D),"onUpdate:itemsPerPage":n[5]||(n[5]=t=>_(D)?D.value=t:null),page:l(v),"onUpdate:page":n[6]||(n[6]=t=>_(v)?v.value=t:null),headers:ae,items:l(ie),"items-length":l(Q),class:"text-no-wrap","onUpdate:options":ne},{"item.duration":a(({item:t})=>[s(V(t.duration)+" mois ",1)]),"item.status":a(({item:t})=>[e(De,{label:"",color:{validated:"success",rejected:"error",waiting:"warning"}[t.status]},{default:a(()=>[t.status_observation?(i(),p(y,{key:0,activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[s("Raison: "+V(t.status_observation),1)]),_:2},1024)):u("",!0),s(" "+V(t.status=="validated"?"Validé":null)+" "+V(t.status=="waiting"?"En attente":null)+" "+V(t.status=="rejected"?"Rejeté":null),1)]),_:2},1032,["color"])]),"item.actions":a(({item:t})=>[b("div",null,[o.$can("read","pv")||o.$can("historical","pv")?(i(),p(c,{key:0,to:{name:"pv-id",params:{id:t.id}}},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[s("Details")]),_:1}),e(m,{icon:" tabler-eye"})]),_:2},1032,["to"])):u("",!0),o.$can("download","pv")?(i(),p(c,{key:1,onClick:L=>se(`/api/verbal-trial/download/${t.id}`,`PV-${t.committee_id}.docx`)},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[s("Télécharger")]),_:1}),we(e(m,{icon:"tabler-download"},null,512),[[pe,"Ceci est une icône"]])]),_:2},1032,["onClick"])):u("",!0)]),o.$can("update","pv")||o.$can("delete","pv")?(i(),h("div",Fe,[e(w),o.$can("update","pv")?(i(),p(c,{key:0,to:{name:"pv-edit-id",params:{id:t.id}},disabled:t.status=="validated"},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[s("Modifier")]),_:1}),e(m,{icon:"tabler-edit"})]),_:2},1032,["to","disabled"])):u("",!0),o.$can("delete","pv")?(i(),p(c,{key:1,disabled:t.status=="validated",onClick:L=>{A.value=t.id,R.value="Supprimer le PV",U.value="Voulez vous vraiment supprimer ce pv?",E.value=re,B.value="Supprimer",I.value=!1,d.value=!0}},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[s("Supprimer")]),_:1}),e(m,{icon:"tabler-trash",color:"error"})]),_:2},1032,["disabled","onClick"])):u("",!0)])):u("",!0),o.$can("reject","pv")||o.$can("validate","pv")||o.$can("create","contract")?(i(),h("div",Ne,[e(w),o.$can("reject","pv")&&t.status!="rejected"?(i(),p(c,{key:0,onClick:L=>{A.value=t.id,R.value="Rejeter le PV",U.value="Voulez vous vraiment rejeter ce PV?",E.value=O,B.value="Rejeter",I.value=!0,z.value="rejected",d.value=!0}},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[s("Rejeter")]),_:1}),e(m,{icon:"tabler-x",color:"error"})]),_:2},1032,["onClick"])):u("",!0),t.status=="waiting"?(i(),h("span",Me,[o.$can("validate","pv")?(i(),p(c,{key:0,onClick:L=>{A.value=t.id,R.value="Valider le PV",U.value="Voulez vous vraiment valider ce PV?",E.value=O,B.value="Valider",I.value=!1,z.value="validated",d.value=!0}},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[s("Valider")]),_:1}),e(m,{icon:"tabler-check",color:"success"})]),_:2},1032,["onClick"])):u("",!0)])):u("",!0),t.status=="validated"?(i(),h("span",qe,[o.$can("create","contract")?(i(),p(c,{key:0,to:{name:"contract-add",query:{id:t.id}}},{default:a(()=>[e(y,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[s("Créer le contrat")]),_:1}),e(m,{icon:"tabler-file-plus",color:"success"})]),_:2},1032,["to"])):u("",!0)])):u("",!0)])):u("",!0)]),bottom:a(()=>[e(w),b("div",Le,[b("p",Je,V(l(Ve)({page:l(v),itemsPerPage:l(D)},l(Q))),1),e(ye,{modelValue:l(v),"onUpdate:modelValue":n[4]||(n[4]=t=>_(v)?v.value=t:null),length:l(Z),"total-visible":o.$vuetify.display.xs?1:Math.min(l(Z),5)},{prev:a(t=>[e(g,K({variant:"tonal",color:"default"},t,{icon:!1}),{default:a(()=>[e(m,{start:"",icon:"tabler-arrow-left"}),s(" Précedent ")]),_:2},1040)]),next:a(t=>[e(g,K({variant:"tonal",color:"default"},t,{icon:!1}),{default:a(()=>[s(" Suivant "),e(m,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(je,{modelValue:l(d),"onUpdate:modelValue":n[11]||(n[11]=t=>_(d)?d.value=t:null),class:"v-dialog-sm"},{default:a(()=>[e(de,{onClick:n[7]||(n[7]=t=>d.value=!l(d))}),e(J,{title:l(R)},{default:a(()=>[e($,null,{default:a(()=>[s(V(l(U))+" ",1),l(I)?(i(),p(ce,{key:0,class:"mt-3",modelValue:l(k),"onUpdate:modelValue":n[8]||(n[8]=t=>_(k)?k.value=t:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):u("",!0)]),_:1}),e($,{class:"d-flex justify-end gap-3 flex-wrap"},{default:a(()=>[e(g,{color:"secondary",variant:"tonal",onClick:n[9]||(n[9]=t=>d.value=!1)},{default:a(()=>[s(" Annuler ")]),_:1}),e(g,{onClick:n[10]||(n[10]=t=>{l(E)(l(A)),d.value=!1})},{default:a(()=>[s(V(l(B)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}},$t=Te(Oe,[["__scopeId","data-v-9bb24407"]]);export{$t as default};
