import{_ as G}from"./AppTextField-c43e7f3c.js";import{r as f,a1 as S,ai as j,E as L,aa as D,w as h,o as u,f as y,e as s,b as l,M as r,s as t,$ as k,a2 as W,N as p,c,d as C,F as Z,A as H,a3 as v,Z as U}from"./main-224c26e2.js";import{a as J}from"./axios-1779699b.js";import{V as K}from"./VRow-931a5d53.js";import{V as w,b as T}from"./VCard-128eca41.js";import{V as q}from"./VCol-b6323a69.js";import{V as O}from"./VCardText-76ac8f5d.js";import{V as P}from"./VForm-5be36e89.js";import{V as b}from"./VSelect-7273c665.js";import{V as m}from"./VTextField-5847b58e.js";import"./VAvatar-357ae3be.js";import"./VImg-ee986579.js";import"./forwardRefs-6ea3df5c.js";import"./VList-9fcafd51.js";import"./VDivider-903c30f9.js";import"./VOverlay-2c72c002.js";import"./VMenu-eab44f87.js";const Q={key:1,class:"mb-2"},X={key:2,class:"mb-2"},Y={class:"mb-2"},ee={key:4,class:"mb-4"},te={class:"d-flex gap-2"},ge={__name:"add",setup(ae){const e=f({last_name:"",first_name:"",email:"",phone:"",account_number:"",date_de_creation_compte:"",montant_endettement:"",type_attestation:"",type:"",gages:[]}),V=S({get(){const n=e.value.date_de_creation_compte;return n?String(n).slice(0,10):""},set(n){e.value.date_de_creation_compte=n?`${n} 00:00:00`:""}}),d=f(""),i=f(null),N=async()=>{if(d.value){const n=await fetch(`/api/clients/search?search=${encodeURIComponent(d.value)}`);if(!n.ok)throw new Error("Erreur lors de la récupération des données");return await n.json()}},B=j.useToast(),M=L(),A=["personne physique","personne morale"],E=["main levée de gage","cloture","endettement","non endettement"],$=["Monsieur","Madame"],z=D("userToken"),g=()=>{e.value.gages.push({marque:"",immatriculation:""})},R=n=>{e.value.gages.splice(n,1)};h(()=>e.value.type_attestation,n=>{n==="main levée de gage"?e.value.gages.length===0&&g():e.value.gages=[]});const F=async()=>{try{await J.post("/api/attestation",{last_name:e.value.type=="personne physique"?e.value.last_name:null,first_name:e.value.type=="personne physique"?e.value.first_name:null,civilite:e.value.civilite,raison_sociale:e.value.raison_sociale,email:e.value.email,phone:e.value.phone,account_number:e.value.account_number,date_de_creation_compte:e.value.date_de_creation_compte,type:e.value.type,type_attestation:e.value.type_attestation,montant_endettement:e.value.montant_endettement,gages:e.value.gages},{headers:{Authorization:`Bearer ${z.value}`}}).then(n=>{if(n.status==200){let o=B.success("Attestation créée!!",{position:"top-right"});M.push("/attestation"),e.value={first_name:"",civilite:"",raison_sociale:"",phone:"",account_number:"",date_de_creation_compte:"",type:"",type_attestation:"",montant_endettement:"",gages:[]}}})}catch(n){console.log(n)}};return h(d,async n=>{n?(i.value=await N(),e.value.first_name=i.value.data.data[0].nom_replegal,e.value.raison_sociale=i.value.data.data[0].raison_sociale_client,e.value.email=i.value.data.data[0].email,e.value.phone=i.value.data.data[0].tel_port,e.value.account_number=i.value.data.data[0].no_compte,e.value.date_de_creation_compte=i.value.data.data[0].d_ouverture):i.value=[]}),(n,o)=>{const I=G;return u(),y(K,null,{default:s(()=>[l(q,{cols:"12"},{default:s(()=>[l(w,null,{default:s(()=>[l(T,null,{default:s(()=>[r("Nouvelle attestation")]),_:1}),l(q,{cols:"12",md:"6",lg:"4"},{default:s(()=>[l(I,{modelValue:t(d),"onUpdate:modelValue":o[0]||(o[0]=a=>k(d)?d.value=a:null),label:"Numéro du matricule client"},null,8,["modelValue"])]),_:1}),l(O,null,{default:s(()=>[l(P,{onSubmit:W(F,["prevent"])},{default:s(()=>[l(b,{class:"z-index-1000 mb-2",label:"Type",modelValue:t(e).type,"onUpdate:modelValue":o[1]||(o[1]=a=>t(e).type=a),items:A},null,8,["modelValue"]),l(b,{class:"z-index-40 mb-2",label:"Type d'attestation",modelValue:t(e).type_attestation,"onUpdate:modelValue":o[2]||(o[2]=a=>t(e).type_attestation=a),items:E},null,8,["modelValue"]),t(e).type=="personne physique"?(u(),y(b,{key:0,class:"z-index-40 mb-2",label:"Civilité",modelValue:t(e).civilite,"onUpdate:modelValue":o[3]||(o[3]=a=>t(e).civilite=a),items:$},null,8,["modelValue"])):p("",!0),t(e).type=="personne physique"?(u(),c("div",Q,[l(m,{label:"Nom",modelValue:t(e).first_name,"onUpdate:modelValue":o[4]||(o[4]=a=>t(e).first_name=a)},null,8,["modelValue"])])):p("",!0),t(e).type=="personne morale"?(u(),c("div",X,[l(m,{label:"Raison sociale",modelValue:t(e).raison_sociale,"onUpdate:modelValue":o[5]||(o[5]=a=>t(e).raison_sociale=a)},null,8,["modelValue"])])):p("",!0),C("div",Y,[l(m,{label:"Téléphone",modelValue:t(e).phone,"onUpdate:modelValue":o[6]||(o[6]=a=>t(e).phone=a)},null,8,["modelValue"])]),l(m,{label:"Numéro de compte",class:"mb-2",modelValue:t(e).account_number,"onUpdate:modelValue":o[7]||(o[7]=a=>t(e).account_number=a)},null,8,["modelValue"]),t(e).type_attestation=="endettement"?(u(),y(m,{key:3,label:"Montant d'endettement",class:"mb-2",modelValue:t(e).montant_endettement,"onUpdate:modelValue":o[8]||(o[8]=a=>t(e).montant_endettement=a)},null,8,["modelValue"])):p("",!0),t(e).type_attestation==="main levée de gage"?(u(),c("div",ee,[l(w,{variant:"outlined",class:"pa-4"},{default:s(()=>[l(T,{class:"text-h6 mb-3"},{default:s(()=>[r("Gages")]),_:1}),(u(!0),c(Z,null,H(t(e).gages,(a,x)=>(u(),c("div",{key:x,class:"d-flex gap-2 mb-3 align-center"},[l(m,{label:"Marque",modelValue:a.marque,"onUpdate:modelValue":_=>a.marque=_,class:"flex-grow-1",placeholder:"Ex: Toyota, BMW, etc."},null,8,["modelValue","onUpdate:modelValue"]),l(m,{label:"Immatriculation",modelValue:a.immatriculation,"onUpdate:modelValue":_=>a.immatriculation=_,class:"flex-grow-1",placeholder:"Ex: 1234ABC"},null,8,["modelValue","onUpdate:modelValue"]),l(v,{icon:"",color:"error",variant:"outlined",onClick:_=>R(x),disabled:t(e).gages.length===1,class:"ml-2"},{default:s(()=>[l(U,null,{default:s(()=>[r("mdi-delete")]),_:1})]),_:2},1032,["onClick","disabled"])]))),128)),l(v,{color:"primary",variant:"outlined",onClick:g,class:"mt-2"},{default:s(()=>[l(U,{class:"mr-2"},{default:s(()=>[r("mdi-plus")]),_:1}),r(" Ajouter un gage ")]),_:1})]),_:1})])):p("",!0),l(m,{type:"date",class:"mb-2",label:"Date de création du compte",modelValue:t(V),"onUpdate:modelValue":o[9]||(o[9]=a=>k(V)?V.value=a:null)},null,8,["modelValue"]),C("div",te,[l(v,{type:"submit",class:"z-index-1000 mb-2"},{default:s(()=>[r("Créer")]),_:1}),l(v,{type:"reset",class:"z-index-1000 mb-2"},{default:s(()=>[r("Réinitialiser")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};export{ge as default};
