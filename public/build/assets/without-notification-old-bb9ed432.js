import{_ as pe}from"./AppTextarea-aba9749f.js";import{_ as me}from"./DialogCloseBtn-50483eba.js";import{_ as ve}from"./AppTextField-27ca1ff4.js";import{V as fe,p as _e,a as Ve}from"./paginationMeta-d1e1cd78.js";import{_ as ye}from"./AppAutocomplete-840baa4d.js";import{J as ge}from"./js-file-downloader-1ac55759.js";import{$ as G}from"./api-0630d56b.js";import{E as be,r as s,ah as H,a1 as I,o as r,c as L,b as e,e as a,s as l,$ as V,a as ke,aT as xe,d as f,a3 as b,M as n,f as p,N as u,Z as m,x as y,v as he,z as K,aa as we,C as Ce,D as $e}from"./main-b79bab7d.js";import{u as W}from"./useApi-f36f0b4b.js";import{c as X}from"./createUrl-424af01a.js";import{_ as Pe}from"./_plugin-vue_export-helper-c27b6911.js";import{V as O}from"./VCard-ab8a42b0.js";import{V as Te}from"./VDialog-e658d4ee.js";import{V as x}from"./VCardText-b8528b45.js";import{V as Y}from"./VRow-aaddea0f.js";import{V as ee}from"./VCol-54e0adfb.js";import{V as Se,a as je}from"./VSelect-0570748a.js";import{V as h}from"./VDivider-20e200a7.js";import{V as De}from"./VSpacer-86cebbd1.js";import{V as g}from"./VTooltip-81e77da7.js";import"./VTextField-05b92c6c.js";import"./VImg-c7f49976.js";import"./forwardRefs-6ea3df5c.js";import"./VTable-e8667096.js";import"./filter-f4e45105.js";import"./VList-4e005a62.js";import"./VAvatar-f2d16882.js";import"./VMenu-b01cd03b.js";import"./VOverlay-b15ad492.js";import"./index-9c720871.js";import"./useAbility-26157080.js";const Ae=w=>(Ce("data-v-2f75b6fb"),w=w(),$e(),w),Re=Ae(()=>f("h2",null," Liste des Procès verbaux sans notification ",-1)),Ue={class:"d-flex flex-wrap gap-4 mx-5"},Be={class:"d-flex align-center"},Ee={class:"d-flex gap-4 flex-wrap align-center"},Ie={class:"custom-loader"},Ne={key:1},ze={key:2},Fe={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},Me={class:"text-sm text-medium-emphasis mb-0"},qe={__name:"without-notification-old",async setup(w){let _,C;be();const $=s(),P=s(),T=s(""),te=[{title:"Numéro comitée",key:"committee_id"},{title:"client",key:"applicant_full_name"},{title:"Type Credit",key:"type_of_credit.full_name"},{title:"Montant",key:"amount_fr"},{title:"CAF",key:"caf.full_name"},{title:"Statut",key:"status"},{title:"Actions",key:"actions",sortable:!1}],S=s([]),ae=i=>{S.value[i]=!0,setTimeout(()=>{S.value[i]=!1},1e3)},j=s(8),v=s(1),le=i=>{v.value=i.page},{data:N,execute:z}=([_,C]=H(()=>W(X("/verbal-trial",{query:{search:T,type_of_credit_id:$,status:P,page:v,has_notification:0,has_mortgage:1,with_caf:1,with_type_of_credit:1}}))),_=await _,C(),_),{data:oe}=([_,C]=H(()=>W(X("/type-of-credit",{query:{paginate:0}}))),_=await _,C(),_),ie=async(i,o)=>{const M=we("userToken").value;try{new ge({url:i,headers:[{name:"Authorization",value:`Bearer ${M}`},{name:"Accept",value:"application/json"}],nameCallback:function(c){return o}})}catch(c){console.error("Erreur lors du téléchargement:",c)}},ne=async i=>{await G(`verbal-trial/${i}`,{method:"DELETE"}),k.value="",z()},J=async i=>{await G(`verbal-trial/change-status/${i}`,{method:"PUT",body:{status:F.value,comment:k.value}}),k.value="",z()},se=I(()=>N.value.data),Q=I(()=>N.value.total),Z=I(()=>N.value.last_page),re=I(()=>oe.value.data),D=s(0),d=s(!1),A=s(""),R=s(""),U=s(""),B=s(),k=s(""),E=s(!1),F=s("waiting");return(i,o)=>{const M=ve,c=ke("IconBtn"),ue=me,de=pe,ce=xe("tooltip");return r(),L("div",null,[e(O,{class:"mb-6"},{default:a(()=>[e(x,null,{default:a(()=>[e(Y,null,{default:a(()=>[e(x,null,{default:a(()=>[Re]),_:1})]),_:1})]),_:1})]),_:1}),e(O,{title:"Filtres",class:"mb-6"},{default:a(()=>[e(x,null,{default:a(()=>[e(Y,null,{default:a(()=>[e(ee,{cols:"12",sm:"4"},{default:a(()=>[e(ye,{modelValue:l($),"onUpdate:modelValue":o[0]||(o[0]=t=>V($)?$.value=t:null),placeholder:"Type de crédit","item-title":"full_name","item-value":"id",items:l(re),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(ee,{cols:"12",sm:"4"},{default:a(()=>[e(Se,{modelValue:l(P),"onUpdate:modelValue":o[1]||(o[1]=t=>V(P)?P.value=t:null),placeholder:"Statut",items:[{value:"v",title:"Validé"},{value:"w",title:"En attente"},{value:"r",title:"Rejeté"}],"clear-icon":"tabler-x",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(h,{class:"my-4"}),f("div",Ue,[f("div",Be,[e(M,{modelValue:l(T),"onUpdate:modelValue":o[2]||(o[2]=t=>V(T)?T.value=t:null),placeholder:"Rechercher un pv",density:"compact",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(De),f("div",Ee,[e(b,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload"},{default:a(()=>[n(" Export ")]),_:1}),i.$can("create","pv")?(r(),p(b,{key:0,color:"primary","prepend-icon":"tabler-plus",to:{name:"pv-add"}},{default:a(()=>[n(" Ajouter ")]),_:1})):u("",!0),e(b,{loading:l(S)[3],disabled:l(S)[3],"prepend-icon":"tabler-refresh",onClick:o[3]||(o[3]=t=>{l(z)(),ae(3)})},{loader:a(()=>[f("span",Ie,[e(m,{icon:"tabler-refresh"})])]),default:a(()=>[n(" Recharger ")]),_:1},8,["loading","disabled"])])]),e(h,{class:"mt-4"}),e(l(fe),{"items-per-page":l(j),"onUpdate:itemsPerPage":o[5]||(o[5]=t=>V(j)?j.value=t:null),page:l(v),"onUpdate:page":o[6]||(o[6]=t=>V(v)?v.value=t:null),headers:te,items:l(se),"items-length":l(Q),class:"text-no-wrap","onUpdate:options":le},{"item.duration":a(({item:t})=>[n(y(t.duration)+" mois ",1)]),"item.status":a(({item:t})=>[e(je,{label:"",color:{validated:"success",rejected:"error",waiting:"warning"}[t.status]},{default:a(()=>[t.comment?(r(),p(g,{key:0,activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[n("Raison: "+y(t.comment),1)]),_:2},1024)):u("",!0),n(" "+y(t.status=="validated"?"Validé":null)+" "+y(t.status=="waiting"?"En attente":null)+" "+y(t.status=="rejected"?"Rejeté":null),1)]),_:2},1032,["color"])]),"item.actions":a(({item:t})=>[f("div",null,[i.$can("read","pv")||i.$can("historical","pv")?(r(),p(c,{key:0,to:{name:"pv-id",params:{id:t.id}}},{default:a(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[n("Details")]),_:1}),e(m,{icon:" tabler-eye"})]),_:2},1032,["to"])):u("",!0),i.$can("download","pv")?(r(),p(c,{key:1,onClick:q=>ie(`/api/verbal-trial/download/${t.id}`,`PV-${t.committee_id}.docx`)},{default:a(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[n("Télécharger")]),_:1}),he(e(m,{icon:"tabler-download"},null,512),[[ce,"Ceci est une icône"]])]),_:2},1032,["onClick"])):u("",!0)]),f("div",null,[e(h),i.$can("update","pv")?(r(),p(c,{key:0,to:{name:"pv-edit-id",params:{id:t.id}},disabled:t.status=="validated"},{default:a(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[n("Modifier")]),_:1}),e(m,{icon:"tabler-edit"})]),_:2},1032,["to","disabled"])):u("",!0),i.$can("delete","pv")?(r(),p(c,{key:1,disabled:t.status=="validated",onClick:q=>{D.value=t.id,A.value="Supprimer le PV",R.value="Voulez vous vraiment supprimer ce pv?",B.value=ne,U.value="Supprimer",E.value=!1,d.value=!0}},{default:a(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[n("Supprimer")]),_:1}),e(m,{icon:"tabler-trash",color:"error"})]),_:2},1032,["disabled","onClick"])):u("",!0)]),e(h),i.$can("reject","pv")&&t.status!="rejected"?(r(),p(c,{key:0,onClick:q=>{D.value=t.id,A.value="Rejeter le PV",R.value="Voulez vous vraiment rejeter ce PV?",B.value=J,U.value="Rejeter",E.value=!0,F.value="rejected",d.value=!0}},{default:a(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"start"},{default:a(()=>[n("Rejeter")]),_:1}),e(m,{icon:"tabler-x",color:"error"})]),_:2},1032,["onClick"])):u("",!0),t.status=="waiting"?(r(),L("span",Ne,[i.$can("validate","pv")?(r(),p(c,{key:0,onClick:q=>{D.value=t.id,A.value="Valider le PV",R.value="Voulez vous vraiment valider ce PV?",B.value=J,U.value="Valider",E.value=!1,F.value="validated",d.value=!0}},{default:a(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[n("Valider")]),_:1}),e(m,{icon:"tabler-check",color:"success"})]),_:2},1032,["onClick"])):u("",!0)])):u("",!0),t.status=="validated"?(r(),L("span",ze,[i.$can("create","notification")?(r(),p(c,{key:0,to:{name:"notification-add",query:{id:t.id}}},{default:a(()=>[e(g,{activator:"parent",transition:"scroll-x-transition",location:"end"},{default:a(()=>[n("Créer la notification ")]),_:1}),e(m,{icon:"tabler-file-plus",color:"success"})]),_:2},1032,["to"])):u("",!0)])):u("",!0)]),bottom:a(()=>[e(h),f("div",Fe,[f("p",Me,y(l(_e)({page:l(v),itemsPerPage:l(j)},l(Q))),1),e(Ve,{modelValue:l(v),"onUpdate:modelValue":o[4]||(o[4]=t=>V(v)?v.value=t:null),length:l(Z),"total-visible":i.$vuetify.display.xs?1:Math.min(l(Z),5)},{prev:a(t=>[e(b,K({variant:"tonal",color:"default"},t,{icon:!1}),{default:a(()=>[e(m,{start:"",icon:"tabler-arrow-left"}),n(" Précedent ")]),_:2},1040)]),next:a(t=>[e(b,K({variant:"tonal",color:"default"},t,{icon:!1}),{default:a(()=>[n(" Suivant "),e(m,{end:"",icon:"tabler-arrow-right"})]),_:2},1040)]),_:1},8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(Te,{modelValue:l(d),"onUpdate:modelValue":o[11]||(o[11]=t=>V(d)?d.value=t:null),class:"v-dialog-sm"},{default:a(()=>[e(ue,{onClick:o[7]||(o[7]=t=>d.value=!l(d))}),e(O,{title:l(A)},{default:a(()=>[e(x,null,{default:a(()=>[n(y(l(R))+" ",1),l(E)?(r(),p(de,{key:0,class:"mt-3",modelValue:l(k),"onUpdate:modelValue":o[8]||(o[8]=t=>V(k)?k.value=t:null),label:"Commentaire",placeholder:"Ex: RAS"},null,8,["modelValue"])):u("",!0)]),_:1}),e(x,{class:"d-flex justify-end gap-3 flex-wrap"},{default:a(()=>[e(b,{color:"secondary",variant:"tonal",onClick:o[9]||(o[9]=t=>d.value=!1)},{default:a(()=>[n(" Annuler ")]),_:1}),e(b,{onClick:o[10]||(o[10]=t=>{l(B)(l(D)),d.value=!1})},{default:a(()=>[n(y(l(U)),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}},bt=Pe(qe,[["__scopeId","data-v-2f75b6fb"]]);export{bt as default};
